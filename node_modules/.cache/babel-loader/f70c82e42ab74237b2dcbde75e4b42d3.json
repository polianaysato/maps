{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\polia\\\\Desktop\\\\Overlay\\\\src\\\\pages\\\\Mapbox.tsx\",\n    _s = $RefreshSig$();\n\n// @ts-nocheck\nimport { useRef, useEffect, useState, useCallback } from \"react\";\nimport mapboxgl from \"mapbox-gl\";\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport ReactDOM from 'react-dom';\nimport { makeStyles, Box, IconButton } from '@material-ui/core';\nimport AddIcon from '@mui/icons-material/Add';\nimport RemoveIcon from '@mui/icons-material/Remove';\nimport clusterBlue from \"../assets/clusterBlue.svg\";\nimport unclusteredPoint from \"../assets/unclusteredPoint.svg\";\nimport \"../styles/App.css\";\nimport Legend from \"../components/Legend\";\nimport { mapboxStyle, states12MilesRadius, states12MilesSteps, states18MilesRadius, states18MilesSteps, states6MilesRadius, states6MilesSteps, statesHeatmapFill, statesHeatmapSteps, statesMapFilter, statesCircleStroke6, statesCircleStroke12, getPixels } from \"../helpers/Utils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(() => ({\n  chartDiv: {\n    height: '25em'\n  },\n  ctrlWrapper: {\n    zIndex: 1000,\n    position: 'absolute',\n    right: 0,\n    top: 0,\n    display: 'block',\n    width: 30,\n    margin: 10\n  },\n  plus: {\n    boxShadow: 'rgb(0, 0, 0, 0.2) 0px 3px 1px -2px, rgb(0, 0, 0, 0.14) 0px 2px 2px 0px, rgb(0, 0, 0, 0.12) 0px 1px 5px 0px',\n    background: '#FFF',\n    width: 30,\n    height: 30,\n    borderRadius: '5px 5px 0px 0px'\n  },\n  minus: {\n    boxShadow: 'rgb(0, 0, 0, 0.2) 0px 3px 1px -2px, rgb(0, 0, 0, 0.14) 0px 2px 2px 0px, rgb(0, 0, 0, 0.12) 0px 1px 5px 0px',\n    background: '#FFF',\n    width: 30,\n    height: 30,\n    borderRadius: '0px 0px 5px 5px'\n  }\n}));\nmapboxgl.accessToken = \"pk.eyJ1IjoiZW5nbWFwYm94IiwiYSI6ImNqY3M1ZXA5czM2ZGYzM283ZmhscDltcGMifQ.Za7ut_7UThGzvjWhX4ACJQ\";\nexport const Mapbox = _ref => {\n  _s();\n\n  let {\n    geoJson,\n    poi,\n    Popup\n  } = _ref;\n  const [colorScheme, setColorScheme] = useState([]);\n  const [steps, setSteps] = useState([]);\n  const [poiViews6Miles, setPoiViews6Miles] = useState([]);\n  const [poiColor6Miles, setPoiColor6Miles] = useState([]);\n  const [poiViews12Miles, setPoiViews12Miles] = useState([]);\n  const [poiColor12Miles, setPoiColor12Miles] = useState([]);\n  const [poiViews18Miles, setPoiViews18Miles] = useState([]);\n  const [poiColor18Miles, setPoiColor18Miles] = useState([]);\n  const mapContainer = useRef();\n  const map = useRef();\n  const popUpRef = useRef();\n  const geoCoder = useRef();\n  const classes = useStyles();\n  useEffect(() => {\n    setColorScheme(statesHeatmapFill);\n    setSteps(statesHeatmapSteps);\n    setPoiColor6Miles(states6MilesRadius);\n    setPoiViews6Miles(states6MilesSteps);\n    setPoiColor12Miles(states12MilesRadius);\n    setPoiViews12Miles(states12MilesSteps);\n    setPoiColor18Miles(states18MilesRadius);\n    setPoiViews18Miles(states18MilesSteps);\n  }, []);\n  useEffect(() => {\n    //initialize popup just once\n    popUpRef.current = new mapboxgl.Popup({\n      closeButton: false,\n      closeOnClick: false\n    });\n  }, []);\n  useEffect(() => {\n    map.current = new mapboxgl.Map({\n      container: mapContainer.current,\n      style: mapboxStyle,\n      center: [-97, 36],\n      zoom: 3.3\n    });\n    console.log(poi); // only want to work with the map after it has fully loaded\n    // if you try to add sources and layers before the map has loaded\n    // things will not work properly\n\n    map.current.on(\"load\", () => {\n      map.current.addSource(\"sites\", {\n        type: \"geojson\",\n        data: poi\n      });\n      map.current.addSource(\"states\", {\n        type: \"geojson\",\n        data: geoJson\n      });\n      map.current.addLayer({\n        id: \"hover\",\n        type: \"fill\",\n        source: \"states\",\n        paint: {\n          \"fill-color\": statesMapFilter,\n          \"fill-opacity\": 0.8,\n          \"fill-outline-color\": \"#000\"\n        }\n      });\n      map.current.addLayer({\n        id: 'radius',\n        type: 'circle',\n        source: 'sites',\n        paint: {\n          \"circle-color\": statesCircleStroke12,\n          \"circle-radius\": [\"interpolate\", [\"linear\"], [\"zoom\"], // zoom is 5 (or less) -> circle radius will be 1px\n          4, 6 // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n          'circle-opacity': 0.5\n        }\n      });\n      map.current.addLayer({\n        id: \"unclustered-point\",\n        type: \"circle\",\n        source: \"sites\",\n        filter: [\"!\", [\"has\", \"point_count\"]],\n        minzoom: 2,\n        'icon-allow-overlap': true,\n        paint: {\n          \"circle-color\": statesCircleStroke6,\n          \"circle-radius\": [\"interpolate\", [\"linear\"], [\"zoom\"], // zoom is 5 (or less) -> circle radius will be 1px\n          4, 6 // zoom is 10 (or greater) -> circle radius will be 5px\n          ]\n        }\n      });\n      map.current.on(\"click\", \"unclustered-point\", e => {\n        e.preventDefault();\n        let f = map.current.queryRenderedFeatures(e.point, {\n          layers: ['unclustered-point-1']\n        });\n\n        if (f.length) {\n          map.current.getCanvas().style.cursor = 'pointer';\n          let popupNode = document.createElement('div');\n\n          if (Popup) {\n            let elem = /*#__PURE__*/_jsxDEV(Popup, {\n              data: f[0]\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 182,\n              columnNumber: 28\n            }, this);\n\n            ReactDOM.render(elem, popupNode);\n            popUpRef.current.setLngLat(e.lngLat).setDOMContent(popupNode).addTo(map.current);\n          }\n\n          return;\n        }\n      });\n      map.current.on('mouseover', `hover`, () => {\n        map.current.getCanvas().style.cursor = '';\n        popUpRef.current.remove();\n      });\n      map.current.on('click', e => {\n        if (e.defaultPrevented === false) {\n          popUpRef.current.remove();\n        }\n      });\n    }); // cleanup function to remove map on unmount\n\n    return () => map.current.remove();\n  }, [Popup, geoJson, poi, poiColor12Miles, poiColor6Miles, poiViews12Miles, poiViews6Miles]);\n  const createRadiusOnZoom = useCallback(currentZoom => {\n    let stops12 = [];\n    let stops6 = [];\n    let innerRadius = {};\n    let midRadius = {};\n    let pixels = 7;\n\n    if (map.current) {\n      pixels = getPixels('US', Number(currentZoom), 12);\n    }\n\n    console.log(pixels, pixels);\n    stops12.push(['Mock', Number(pixels) >= 5 ? Number(pixels) : 5]);\n    stops6.push(['Mock', Number(pixels / 2) >= 3 ? Number(pixels / 2) : 3]);\n    innerRadius = {\n      property: 'vendor',\n      type: 'categorical',\n      stops: stops6\n    };\n    midRadius = {\n      property: 'vendor',\n      type: 'categorical',\n      stops: stops12\n    };\n    return {\n      innerRadius: innerRadius,\n      midRadius: midRadius\n    };\n  }, []);\n  const zoomIn = useCallback(() => {\n    if (map.current !== undefined) {\n      let currentZoom = map.current.getZoom();\n\n      if (currentZoom) {\n        map.current.zoomTo(Number(currentZoom) + 0.7, {\n          duration: 350\n        });\n        let radius = createRadiusOnZoom(currentZoom);\n\n        if (map.current !== undefined && map.current.isStyleLoaded()) {\n          map.current.setPaintProperty('radius', 'circle-radius', radius.midRadius);\n          map.current.setPaintProperty('unclustered-point', 'circle-radius', radius.innerRadius);\n        }\n      }\n    }\n  }, [createRadiusOnZoom]);\n  const zoomOut = useCallback(() => {\n    if (map.current !== undefined) {\n      let currentZoom = map.current.getZoom();\n\n      if (currentZoom) {\n        map.current.zoomTo(Number(currentZoom) - 0.7, {\n          duration: 350\n        });\n        let radius = createRadiusOnZoom(currentZoom);\n\n        if (map.current !== undefined && map.current.isStyleLoaded()) {\n          map.current.setPaintProperty('radius', 'circle-radius', radius.midRadius);\n          map.current.setPaintProperty('unclustered-point', 'circle-radius', radius.innerRadius);\n        }\n      }\n    }\n  }, [createRadiusOnZoom]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Legend, {\n      type: \"dots\",\n      clusters: \"Clusters\",\n      pointCount: \"Views\",\n      clusterImg: clusterBlue,\n      unclusteredImg: unclusteredPoint,\n      unclusteredPoint: \"Unclustered Points\",\n      colorScheme: colorScheme,\n      steps: steps,\n      poi: \"POI\",\n      views: \"Views\",\n      poiColor6Miles: poiColor6Miles,\n      poiViews6Miles: poiViews6Miles,\n      poiColor12Miles: poiColor12Miles,\n      poiViews12Miles: poiViews12Miles\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: mapContainer,\n      style: {\n        width: \"100%\",\n        height: \"100vh\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.ctrlWrapper,\n      children: /*#__PURE__*/_jsxDEV(Box, {\n        children: [/*#__PURE__*/_jsxDEV(IconButton, {\n          \"aria-label\": \"zoom in\",\n          onClick: zoomIn,\n          className: classes.plus,\n          children: /*#__PURE__*/_jsxDEV(AddIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 310,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(IconButton, {\n          \"aria-label\": \"zoom out\",\n          onClick: zoomOut,\n          className: classes.minus,\n          children: /*#__PURE__*/_jsxDEV(RemoveIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Mapbox, \"2V6G7dJiN9ntudwJfg1xHd9kdfo=\", false, function () {\n  return [useStyles];\n});\n\n_c = Mapbox;\n\nvar _c;\n\n$RefreshReg$(_c, \"Mapbox\");","map":{"version":3,"sources":["C:/Users/polia/Desktop/Overlay/src/pages/Mapbox.tsx"],"names":["useRef","useEffect","useState","useCallback","mapboxgl","ReactDOM","makeStyles","Box","IconButton","AddIcon","RemoveIcon","Legend","mapboxStyle","states12MilesRadius","states12MilesSteps","states18MilesRadius","states18MilesSteps","states6MilesRadius","states6MilesSteps","statesHeatmapFill","statesHeatmapSteps","statesMapFilter","statesCircleStroke6","statesCircleStroke12","getPixels","useStyles","chartDiv","height","ctrlWrapper","zIndex","position","right","top","display","width","margin","plus","boxShadow","background","borderRadius","minus","accessToken","Mapbox","geoJson","poi","Popup","colorScheme","setColorScheme","steps","setSteps","poiViews6Miles","setPoiViews6Miles","poiColor6Miles","setPoiColor6Miles","poiViews12Miles","setPoiViews12Miles","poiColor12Miles","setPoiColor12Miles","poiViews18Miles","setPoiViews18Miles","poiColor18Miles","setPoiColor18Miles","mapContainer","map","popUpRef","geoCoder","classes","current","closeButton","closeOnClick","Map","container","style","center","zoom","console","log","on","addSource","type","data","addLayer","id","source","paint","filter","minzoom","e","preventDefault","f","queryRenderedFeatures","point","layers","length","getCanvas","cursor","popupNode","document","createElement","elem","render","setLngLat","lngLat","setDOMContent","addTo","remove","defaultPrevented","createRadiusOnZoom","currentZoom","stops12","stops6","innerRadius","midRadius","pixels","Number","push","property","stops","zoomIn","undefined","getZoom","zoomTo","duration","radius","isStyleLoaded","setPaintProperty","zoomOut","clusterBlue","unclusteredPoint"],"mappings":"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","sourcesContent":["// @ts-nocheck\nimport { useRef, useEffect, useState, useCallback } from \"react\"\nimport mapboxgl from \"mapbox-gl\"\nimport \"mapbox-gl/dist/mapbox-gl.css\"\nimport MapboxGeocoder from '@mapbox/mapbox-gl-geocoder'\nimport ReactDOM from 'react-dom'\nimport { makeStyles, Box, IconButton } from '@material-ui/core'\nimport AddIcon from '@mui/icons-material/Add'\nimport RemoveIcon from '@mui/icons-material/Remove';\nimport clusterBlue from \"../assets/clusterBlue.svg\"\nimport unclusteredPoint from \"../assets/unclusteredPoint.svg\"\nimport \"../styles/App.css\"\nimport Legend from \"../components/Legend\"\nimport { mapboxStyle, states12MilesRadius, states12MilesSteps, states18MilesRadius, states18MilesSteps, states6MilesRadius, states6MilesSteps, statesHeatmapFill, statesHeatmapSteps, statesMapFilter, statesCircleStroke18, statesCircleStroke6, statesCircleStroke12, getPixels } from \"../helpers/Utils\"\n\n\nconst useStyles = makeStyles(() => ({\n  chartDiv: {\n    height: '25em'\n  },\n  ctrlWrapper: {\n    zIndex: 1000,\n    position: 'absolute',\n    right: 0,\n    top: 0,\n    display: 'block',\n    width: 30,\n    margin: 10,\n  },\n  plus: {\n    boxShadow: 'rgb(0, 0, 0, 0.2) 0px 3px 1px -2px, rgb(0, 0, 0, 0.14) 0px 2px 2px 0px, rgb(0, 0, 0, 0.12) 0px 1px 5px 0px',\n    background: '#FFF',\n    width: 30,\n    height: 30,\n    borderRadius: '5px 5px 0px 0px',\n  },\n  minus: {\n    boxShadow: 'rgb(0, 0, 0, 0.2) 0px 3px 1px -2px, rgb(0, 0, 0, 0.14) 0px 2px 2px 0px, rgb(0, 0, 0, 0.12) 0px 1px 5px 0px',\n    background: '#FFF',\n    width: 30,\n    height: 30,\n    borderRadius: '0px 0px 5px 5px',\n  }\n}))\n\nmapboxgl.accessToken =\n  \"pk.eyJ1IjoiZW5nbWFwYm94IiwiYSI6ImNqY3M1ZXA5czM2ZGYzM283ZmhscDltcGMifQ.Za7ut_7UThGzvjWhX4ACJQ\";\n\n\nexport const Mapbox = ({ geoJson, poi, Popup }) => {\n  const [colorScheme, setColorScheme] = useState<Array<string>>([])\n  const [steps, setSteps] = useState<Array<number>>([])\n\n  const [poiViews6Miles, setPoiViews6Miles] = useState<Array<number>>([])\n  const [poiColor6Miles, setPoiColor6Miles] = useState<Array<string>>([])\n\n  const [poiViews12Miles, setPoiViews12Miles] = useState<Array<number>>([])\n  const [poiColor12Miles, setPoiColor12Miles] = useState<Array<string>>([])\n\n  const [poiViews18Miles, setPoiViews18Miles] = useState<Array<number>>([])\n  const [poiColor18Miles, setPoiColor18Miles] = useState<Array<string>>([])\n\n  const mapContainer = useRef()\n  const map = useRef()\n  const popUpRef = useRef()\n  const geoCoder = useRef()\n\n\n  const classes = useStyles()\n\n\n  useEffect(() => {\n    setColorScheme(statesHeatmapFill)\n    setSteps(statesHeatmapSteps)\n\n    setPoiColor6Miles(states6MilesRadius)\n\n    setPoiViews6Miles(states6MilesSteps)\n\n    setPoiColor12Miles(states12MilesRadius)\n    setPoiViews12Miles(states12MilesSteps)\n\n    setPoiColor18Miles(states18MilesRadius)\n    setPoiViews18Miles(states18MilesSteps)\n  }, [])\n\n  useEffect(() => {\n    //initialize popup just once\n    popUpRef.current = new mapboxgl.Popup({\n        closeButton: false,\n        closeOnClick: false,\n    })\n}, [])\n\n\n  useEffect(() => {\n    map.current = new mapboxgl.Map({\n      container: mapContainer.current,\n      style: mapboxStyle,\n      center: [-97, 36],\n      zoom: 3.3,\n    })\n\n    console.log(poi)\n\n    // only want to work with the map after it has fully loaded\n    // if you try to add sources and layers before the map has loaded\n    // things will not work properly\n    map.current.on(\"load\", () => {\n      map.current.addSource(\"sites\", {\n        type: \"geojson\",\n        data: poi,\n      })\n\n      map.current.addSource(\"states\", {\n        type: \"geojson\",\n        data: geoJson,\n      })\n\n      map.current.addLayer({\n        id: \"hover\",\n        type: \"fill\",\n        source: \"states\",\n        paint: {\n          \"fill-color\": statesMapFilter,\n          \"fill-opacity\": 0.8,\n          \"fill-outline-color\": \"#000\",\n        },\n        \n      })\n\n      map.current.addLayer({\n        id: 'radius',\n        type: 'circle',\n        source: 'sites',\n        paint: {\n          \"circle-color\": statesCircleStroke12,\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"zoom\"],\n            // zoom is 5 (or less) -> circle radius will be 1px\n            4,\n            6,\n            // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n            'circle-opacity': 0.5,\n        },\n    })\n\n      map.current.addLayer({\n        id: \"unclustered-point\",\n        type: \"circle\",\n        source: \"sites\",\n        filter: [\"!\", [\"has\", \"point_count\"]],\n        minzoom: 2,\n        'icon-allow-overlap': true,\n        paint: {\n          \"circle-color\": statesCircleStroke6,\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"zoom\"],\n            // zoom is 5 (or less) -> circle radius will be 1px\n            4,\n            6,\n            // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n        },\n      })\n\n\n\n      map.current.on(\"click\", \"unclustered-point\", (e: any) => {\n        e.preventDefault()\n        let f = map.current.queryRenderedFeatures(e.point, { layers: ['unclustered-point-1'] })\n\n        if (f.length) {\n            map.current.getCanvas().style.cursor = 'pointer'\n            let popupNode = document.createElement('div')\n            if (Popup) {\n                let elem = <Popup data={f[0]} />\n                ReactDOM.render(elem, popupNode)\n                popUpRef.current\n                    .setLngLat(e.lngLat)\n                    .setDOMContent(popupNode)\n                    .addTo(map.current)\n            }\n            return\n        }\n      })\n\n        map.current.on('mouseover', `hover`, () => {\n        map.current.getCanvas().style.cursor = ''\n        popUpRef.current.remove()\n      }) \n      \n\n      map.current.on('click', (e) => {\n        if (e.defaultPrevented === false) {\n          popUpRef.current.remove()\n        }\n      });\n      \n     \n    })\n\n    // cleanup function to remove map on unmount\n    return () => map.current.remove()\n  }, [Popup, geoJson, poi, poiColor12Miles, poiColor6Miles, poiViews12Miles, poiViews6Miles])\n\n\n  const createRadiusOnZoom = useCallback((currentZoom: number) => {\n    let stops12: any = []\n    let stops6: any = []\n    let innerRadius = {}\n    let midRadius = {}\n    let pixels: number = 7\n\n    if (map.current) {\n        pixels = getPixels('US', Number(currentZoom), 12)\n    }\n\n    console.log(pixels, pixels)\n\n    stops12.push(['Mock', Number(pixels) >= 5 ?  Number(pixels) : 5])\n    stops6.push(['Mock', Number(pixels/2) >= 3 ? Number(pixels/2) : 3])\n\n    innerRadius = {\n        property: 'vendor',\n        type: 'categorical',\n        stops: stops6,\n    }\n\n    midRadius = {\n      property: 'vendor',\n        type: 'categorical',\n        stops: stops12,\n    }\n\n    return {\n        innerRadius: innerRadius,\n        midRadius: midRadius\n    }\n}, [])\n\n\nconst zoomIn = useCallback(() => {\n  if (map.current !== undefined) {\n      let currentZoom = map.current.getZoom()\n\n      if (currentZoom) {\n          map.current.zoomTo(Number(currentZoom) + 0.7, {\n              duration: 350,\n          })\n\n          let radius = createRadiusOnZoom(currentZoom)\n\n          if (map.current !== undefined && map.current.isStyleLoaded()) {\n            map.current.setPaintProperty('radius', 'circle-radius', radius.midRadius)\n            map.current.setPaintProperty('unclustered-point', 'circle-radius', radius.innerRadius)\n        } \n      }\n  }\n}, [createRadiusOnZoom])\n\n\nconst zoomOut = useCallback(() => {\n  if (map.current !== undefined) {\n      let currentZoom = map.current.getZoom()\n\n      if (currentZoom) {\n          map.current.zoomTo(Number(currentZoom) - 0.7, {\n              duration: 350,\n          })\n\n          let radius = createRadiusOnZoom(currentZoom)\n\n          if (map.current !== undefined && map.current.isStyleLoaded()) {\n            map.current.setPaintProperty('radius', 'circle-radius', radius.midRadius)\n            map.current.setPaintProperty('unclustered-point', 'circle-radius', radius.innerRadius)\n        } \n      }\n  }\n}, [createRadiusOnZoom])\n\n\n  return (\n    <>\n      <Legend\n        type=\"dots\"\n        clusters=\"Clusters\"\n        pointCount=\"Views\"\n        clusterImg={clusterBlue}\n        unclusteredImg={unclusteredPoint}\n        unclusteredPoint=\"Unclustered Points\"\n        colorScheme={colorScheme}\n        steps={steps}\n        poi=\"POI\"\n        views=\"Views\"\n        poiColor6Miles={poiColor6Miles}\n        poiViews6Miles={poiViews6Miles}\n        poiColor12Miles={poiColor12Miles}\n        poiViews12Miles={poiViews12Miles}\n      />\n      <div ref={mapContainer} style={{ width: \"100%\", height: \"100vh\" }} />\n      <div className={classes.ctrlWrapper}>\n        <Box>\n          <IconButton aria-label=\"zoom in\" onClick={zoomIn} className={classes.plus}>\n            <AddIcon />\n          </IconButton>\n          <IconButton aria-label=\"zoom out\" onClick={zoomOut} className={classes.minus}>\n            <RemoveIcon /> \n          </IconButton>\n        </Box>\n      </div>\n    </>\n  )\n}\n\n\n"]},"metadata":{},"sourceType":"module"}