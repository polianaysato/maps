{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\polia\\\\Desktop\\\\Overlay\\\\src\\\\pages\\\\Mapbox.tsx\",\n    _s = $RefreshSig$();\n\n// @ts-nocheck\nimport { useRef, useEffect, useState, useCallback } from \"react\";\nimport mapboxgl from \"mapbox-gl\";\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport ReactDOM from 'react-dom';\nimport { makeStyles, Box, IconButton } from '@material-ui/core';\nimport AddIcon from '@mui/icons-material/Add';\nimport clusterBlue from \"../assets/clusterBlue.svg\";\nimport unclusteredPoint from \"../assets/unclusteredPoint.svg\";\nimport \"../styles/App.css\";\nimport Legend from \"../components/Legend\";\nimport { mapboxStyle, states12MilesRadius, states12MilesSteps, states18MilesRadius, states18MilesSteps, states6MilesRadius, states6MilesSteps, statesHeatmapFill, statesHeatmapSteps, statesMapFilter, statesCircleStroke18, statesCircleStroke6, statesCircleStroke12, getPixels } from \"../helpers/Utils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(() => ({\n  chartDiv: {\n    height: '25em'\n  },\n  ctrlWrapper: {\n    zIndex: 1000\n  }\n}));\nmapboxgl.accessToken = \"pk.eyJ1IjoiZW5nbWFwYm94IiwiYSI6ImNqY3M1ZXA5czM2ZGYzM283ZmhscDltcGMifQ.Za7ut_7UThGzvjWhX4ACJQ\";\nexport const Mapbox = _ref => {\n  _s();\n\n  let {\n    geoJson,\n    poi,\n    Popup\n  } = _ref;\n  const [colorScheme, setColorScheme] = useState([]);\n  const [steps, setSteps] = useState([]);\n  const [poiViews6Miles, setPoiViews6Miles] = useState([]);\n  const [poiColor6Miles, setPoiColor6Miles] = useState([]);\n  const [poiViews12Miles, setPoiViews12Miles] = useState([]);\n  const [poiColor12Miles, setPoiColor12Miles] = useState([]);\n  const [poiViews18Miles, setPoiViews18Miles] = useState([]);\n  const [poiColor18Miles, setPoiColor18Miles] = useState([]);\n  const mapContainer = useRef();\n  const map = useRef();\n  const popUpRef = useRef();\n  const nav = useRef();\n  const geoCoder = useRef();\n  const classes = useStyles();\n  useEffect(() => {\n    setColorScheme(statesHeatmapFill);\n    setSteps(statesHeatmapSteps);\n    setPoiColor6Miles(states6MilesRadius);\n    setPoiViews6Miles(states6MilesSteps);\n    setPoiColor12Miles(states12MilesRadius);\n    setPoiViews12Miles(states12MilesSteps);\n    setPoiColor18Miles(states18MilesRadius);\n    setPoiViews18Miles(states18MilesSteps);\n  }, []);\n  useEffect(() => {\n    //initialize popup just once\n    popUpRef.current = new mapboxgl.Popup({\n      closeButton: false,\n      closeOnClick: false\n    });\n  }, []);\n  useEffect(() => {\n    nav.current = new mapboxgl.NavigationControl({\n      showCompass: false,\n      showZoom: true\n    });\n  }, []);\n  useEffect(() => {\n    map.current = new mapboxgl.Map({\n      container: mapContainer.current,\n      style: mapboxStyle,\n      center: [-97, 36],\n      zoom: 3.3\n    });\n    console.log(poi); // only want to work with the map after it has fully loaded\n    // if you try to add sources and layers before the map has loaded\n    // things will not work properly\n\n    map.current.on(\"load\", () => {\n      map.current.addSource(\"sites\", {\n        type: \"geojson\",\n        data: poi\n      });\n      map.current.addSource(\"states\", {\n        type: \"geojson\",\n        data: geoJson\n      });\n      map.current.addLayer({\n        id: \"hover\",\n        type: \"fill\",\n        source: \"states\",\n        paint: {\n          \"fill-color\": statesMapFilter,\n          \"fill-opacity\": 0.8,\n          \"fill-outline-color\": \"#000\"\n        }\n      });\n      map.current.addLayer({\n        id: \"unclustered-point-1\",\n        type: \"circle\",\n        source: \"sites\",\n        filter: [\"!\", [\"has\", \"point_count\"]],\n        paint: {\n          \"circle-opacity\": 0,\n          'circle-stroke-opacity': 0.5,\n          \"circle-radius\": [\"interpolate\", [\"linear\"], [\"zoom\"], // zoom is 5 (or less) -> circle radius will be 1px\n          5, 5, // zoom is 10 (or greater) -> circle radius will be 5px\n          6, 12, 7, 24, 8, 36],\n          \"circle-stroke-width\": [\"interpolate\", [\"linear\"], [\"zoom\"], // zoom is 5 (or less) -> circle radius will be 1px\n          5, 3 // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n          \"circle-stroke-color\": statesCircleStroke18\n        }\n      });\n      map.current.addLayer({\n        id: \"unclustered-point\",\n        type: \"circle\",\n        source: \"sites\",\n        filter: [\"!\", [\"has\", \"point_count\"]],\n        paint: {\n          \"circle-color\": statesCircleStroke6,\n          \"circle-radius\": [\"interpolate\", [\"linear\"], [\"zoom\"], // zoom is 5 (or less) -> circle radius will be 1px\n          5, 3 // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n          \"circle-stroke-width\": [\"interpolate\", [\"linear\"], [\"zoom\"], // zoom is 5 (or less) -> circle radius will be 1px\n          5, 1 // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n          \"circle-stroke-color\": statesCircleStroke12\n        }\n      });\n      map.current.on(\"click\", \"unclustered-point\", e => {\n        e.preventDefault();\n        let f = map.current.queryRenderedFeatures(e.point, {\n          layers: ['unclustered-point-1']\n        });\n\n        if (f.length) {\n          map.current.getCanvas().style.cursor = 'pointer';\n          let popupNode = document.createElement('div');\n\n          if (Popup) {\n            let elem = /*#__PURE__*/_jsxDEV(Popup, {\n              data: f[0]\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 196,\n              columnNumber: 28\n            }, this);\n\n            ReactDOM.render(elem, popupNode);\n            popUpRef.current.setLngLat(e.lngLat).setDOMContent(popupNode).addTo(map.current);\n          }\n\n          return;\n        }\n      });\n      map.current.on('mouseover', `hover`, () => {\n        map.current.getCanvas().style.cursor = '';\n        popUpRef.current.remove();\n      });\n      map.current.addControl(nav.current);\n      map.current.on('click', e => {\n        if (e.defaultPrevented === false) {\n          popUpRef.current.remove();\n        }\n      });\n    }); // cleanup function to remove map on unmount\n\n    return () => map.current.remove();\n  }, [Popup, geoJson, poi, poiColor12Miles, poiColor6Miles, poiViews12Miles, poiViews6Miles]);\n  const createRadiusOnZoom = useCallback(currentZoom => {\n    let stops18 = [];\n    let stops12 = [];\n    let stops6 = [];\n    let highlight = {};\n    let innerRadius = {};\n    let pixels = 7;\n\n    if (map.current) {\n      pixels = getPixels(supportedCountry, Number(currentZoom), miles);\n    }\n\n    stops18.push(['Mock', pixels]);\n    stops12.push(['Mock', Number(pixels / 2)]);\n    stops6.push([product.productId, Number(pixels / 4)]);\n    highlight = {\n      property: 'vendor',\n      type: 'categorical',\n      stops: stops18\n    };\n    innerRadius = {\n      property: 'vendor',\n      type: 'categorical',\n      stops: stops6\n    };\n    midRadius = {\n      property: 'vendor',\n      type: 'categorical',\n      stops: stops12\n    };\n    return {\n      highlight: highlight,\n      innerRadius: innerRadius,\n      midRadius: midRadius\n    };\n  }, []);\n  const zooming = useCallback(() => {\n    if (map.current !== undefined) {\n      let currentZoom = map.current.getZoom();\n\n      if (currentZoom) {\n        let radius = createRadiusOnZoom(currentZoom);\n\n        if (map.current !== undefined && map.current.isStyleLoaded()) {\n          map.current.setPaintProperty('unclustered-point-1', 'circle-radius', radius.highlight);\n          map.current.setPaintProperty('unclustered-point', 'circle-radius', radius.innerRadius);\n          map.current.setPaintProperty('unclustered-point', 'circle-stroke-width', radius.midRadius);\n        }\n      }\n    }\n  }, [createRadiusOnZoom]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Legend, {\n      type: \"dots\",\n      clusters: \"Clusters\",\n      pointCount: \"Views\",\n      clusterImg: clusterBlue,\n      unclusteredImg: unclusteredPoint,\n      unclusteredPoint: \"Unclustered Points\",\n      colorScheme: colorScheme,\n      steps: steps,\n      poi: \"POI\",\n      views: \"Views\",\n      poiColor6Miles: poiColor6Miles,\n      poiViews6Miles: poiViews6Miles,\n      poiColor12Miles: poiColor12Miles,\n      poiViews12Miles: poiViews12Miles,\n      poiColor18Miles: poiColor18Miles,\n      poiViews18Miles: poiViews18Miles\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: mapContainer,\n      style: {\n        width: \"100%\",\n        height: \"100vh\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.ctrlWrapper,\n      children: /*#__PURE__*/_jsxDEV(Box, {\n        children: /*#__PURE__*/_jsxDEV(IconButton, {\n          \"aria-label\": \"zoom in\",\n          children: [/*#__PURE__*/_jsxDEV(AddIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 11\n          }, this), \"Plus\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Mapbox, \"Blu4OdTpv4ULhCYW+cCwK4uQU2Y=\", false, function () {\n  return [useStyles];\n});\n\n_c = Mapbox;\n\nvar _c;\n\n$RefreshReg$(_c, \"Mapbox\");","map":{"version":3,"sources":["C:/Users/polia/Desktop/Overlay/src/pages/Mapbox.tsx"],"names":["useRef","useEffect","useState","useCallback","mapboxgl","ReactDOM","makeStyles","Box","IconButton","AddIcon","Legend","mapboxStyle","states12MilesRadius","states12MilesSteps","states18MilesRadius","states18MilesSteps","states6MilesRadius","states6MilesSteps","statesHeatmapFill","statesHeatmapSteps","statesMapFilter","statesCircleStroke18","statesCircleStroke6","statesCircleStroke12","getPixels","useStyles","chartDiv","height","ctrlWrapper","zIndex","accessToken","Mapbox","geoJson","poi","Popup","colorScheme","setColorScheme","steps","setSteps","poiViews6Miles","setPoiViews6Miles","poiColor6Miles","setPoiColor6Miles","poiViews12Miles","setPoiViews12Miles","poiColor12Miles","setPoiColor12Miles","poiViews18Miles","setPoiViews18Miles","poiColor18Miles","setPoiColor18Miles","mapContainer","map","popUpRef","nav","geoCoder","classes","current","closeButton","closeOnClick","NavigationControl","showCompass","showZoom","Map","container","style","center","zoom","console","log","on","addSource","type","data","addLayer","id","source","paint","filter","e","preventDefault","f","queryRenderedFeatures","point","layers","length","getCanvas","cursor","popupNode","document","createElement","elem","render","setLngLat","lngLat","setDOMContent","addTo","remove","addControl","defaultPrevented","createRadiusOnZoom","currentZoom","stops18","stops12","stops6","highlight","innerRadius","pixels","supportedCountry","Number","miles","push","product","productId","property","stops","midRadius","zooming","undefined","getZoom","radius","isStyleLoaded","setPaintProperty","clusterBlue","unclusteredPoint","width"],"mappings":"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","sourcesContent":["// @ts-nocheck\nimport { useRef, useEffect, useState, useCallback } from \"react\"\nimport mapboxgl from \"mapbox-gl\"\nimport \"mapbox-gl/dist/mapbox-gl.css\"\nimport MapboxGeocoder from '@mapbox/mapbox-gl-geocoder'\nimport ReactDOM from 'react-dom'\nimport { makeStyles, Box, IconButton } from '@material-ui/core'\nimport AddIcon from '@mui/icons-material/Add'\nimport clusterBlue from \"../assets/clusterBlue.svg\"\nimport unclusteredPoint from \"../assets/unclusteredPoint.svg\"\nimport \"../styles/App.css\"\nimport Legend from \"../components/Legend\"\nimport { mapboxStyle, states12MilesRadius, states12MilesSteps, states18MilesRadius, states18MilesSteps, states6MilesRadius, states6MilesSteps, statesHeatmapFill, statesHeatmapSteps, statesMapFilter, statesCircleStroke18, statesCircleStroke6, statesCircleStroke12, getPixels } from \"../helpers/Utils\"\n\n\nconst useStyles = makeStyles(() => ({\n  chartDiv: {\n    height: '25em'\n  },\n  ctrlWrapper: {\n    zIndex: 1000\n  }\n}))\n\nmapboxgl.accessToken =\n  \"pk.eyJ1IjoiZW5nbWFwYm94IiwiYSI6ImNqY3M1ZXA5czM2ZGYzM283ZmhscDltcGMifQ.Za7ut_7UThGzvjWhX4ACJQ\";\n\n\nexport const Mapbox = ({ geoJson, poi, Popup }) => {\n  const [colorScheme, setColorScheme] = useState<Array<string>>([])\n  const [steps, setSteps] = useState<Array<number>>([])\n\n  const [poiViews6Miles, setPoiViews6Miles] = useState<Array<number>>([])\n  const [poiColor6Miles, setPoiColor6Miles] = useState<Array<string>>([])\n\n  const [poiViews12Miles, setPoiViews12Miles] = useState<Array<number>>([])\n  const [poiColor12Miles, setPoiColor12Miles] = useState<Array<string>>([])\n\n  const [poiViews18Miles, setPoiViews18Miles] = useState<Array<number>>([])\n  const [poiColor18Miles, setPoiColor18Miles] = useState<Array<string>>([])\n\n  const mapContainer = useRef()\n  const map = useRef()\n  const popUpRef = useRef()\n  const nav = useRef()\n  const geoCoder = useRef()\n\n\n  const classes = useStyles()\n\n\n  useEffect(() => {\n    setColorScheme(statesHeatmapFill)\n    setSteps(statesHeatmapSteps)\n\n    setPoiColor6Miles(states6MilesRadius)\n\n    setPoiViews6Miles(states6MilesSteps)\n\n    setPoiColor12Miles(states12MilesRadius)\n    setPoiViews12Miles(states12MilesSteps)\n\n    setPoiColor18Miles(states18MilesRadius)\n    setPoiViews18Miles(states18MilesSteps)\n  }, [])\n\n  useEffect(() => {\n    //initialize popup just once\n    popUpRef.current = new mapboxgl.Popup({\n        closeButton: false,\n        closeOnClick: false,\n    })\n}, [])\n\nuseEffect(() => {\n  nav.current = new mapboxgl.NavigationControl({\n    showCompass: false,\n    showZoom: true\n  });\n},  [])\n\n\n\n  useEffect(() => {\n    map.current = new mapboxgl.Map({\n      container: mapContainer.current,\n      style: mapboxStyle,\n      center: [-97, 36],\n      zoom: 3.3,\n    })\n\n    console.log(poi)\n\n    // only want to work with the map after it has fully loaded\n    // if you try to add sources and layers before the map has loaded\n    // things will not work properly\n    map.current.on(\"load\", () => {\n      map.current.addSource(\"sites\", {\n        type: \"geojson\",\n        data: poi,\n      })\n\n      map.current.addSource(\"states\", {\n        type: \"geojson\",\n        data: geoJson,\n      })\n\n      map.current.addLayer({\n        id: \"hover\",\n        type: \"fill\",\n        source: \"states\",\n        paint: {\n          \"fill-color\": statesMapFilter,\n          \"fill-opacity\": 0.8,\n          \"fill-outline-color\": \"#000\",\n        },\n        \n      })\n\n\n      map.current.addLayer({\n        id: \"unclustered-point-1\",\n        type: \"circle\",\n        source: \"sites\",\n        filter: [\"!\", [\"has\", \"point_count\"]],\n        paint: {\n          \"circle-opacity\": 0,\n          'circle-stroke-opacity': 0.5,\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"zoom\"],\n\n            // zoom is 5 (or less) -> circle radius will be 1px\n            5,\n            5,\n            // zoom is 10 (or greater) -> circle radius will be 5px\n            6,\n            12,\n\n            7,\n            24,\n\n            8,\n            36\n          ],\n          \"circle-stroke-width\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"zoom\"],\n            // zoom is 5 (or less) -> circle radius will be 1px\n            5,\n            3,\n            // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n          \"circle-stroke-color\": statesCircleStroke18,\n        },\n      })\n      map.current.addLayer({\n        id: \"unclustered-point\",\n        type: \"circle\",\n        source: \"sites\",\n        filter: [\"!\", [\"has\", \"point_count\"]],\n        paint: {\n          \"circle-color\": statesCircleStroke6,\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"zoom\"],\n            // zoom is 5 (or less) -> circle radius will be 1px\n            5,\n            3,\n            // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n          \"circle-stroke-width\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"zoom\"],\n            // zoom is 5 (or less) -> circle radius will be 1px\n            5,\n            1,\n            // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n          \"circle-stroke-color\": statesCircleStroke12,\n        },\n      })\n\n      map.current.on(\"click\", \"unclustered-point\", (e: any) => {\n        e.preventDefault()\n        let f = map.current.queryRenderedFeatures(e.point, { layers: ['unclustered-point-1'] })\n\n        if (f.length) {\n            map.current.getCanvas().style.cursor = 'pointer'\n            let popupNode = document.createElement('div')\n            if (Popup) {\n                let elem = <Popup data={f[0]} />\n                ReactDOM.render(elem, popupNode)\n                popUpRef.current\n                    .setLngLat(e.lngLat)\n                    .setDOMContent(popupNode)\n                    .addTo(map.current)\n            }\n            return\n        }\n      })\n\n        map.current.on('mouseover', `hover`, () => {\n        map.current.getCanvas().style.cursor = ''\n        popUpRef.current.remove()\n      }) \n      \n      map.current.addControl(nav.current)\n      map.current.on('click', (e) => {\n        if (e.defaultPrevented === false) {\n          popUpRef.current.remove()\n        }\n      });\n      \n     \n    })\n\n    // cleanup function to remove map on unmount\n    return () => map.current.remove()\n  }, [Popup, geoJson, poi, poiColor12Miles, poiColor6Miles, poiViews12Miles, poiViews6Miles])\n\n\n  const createRadiusOnZoom = useCallback((currentZoom: number) => {\n    let stops18: any = []\n    let stops12: any = []\n    let stops6: any = []\n    let highlight = {}\n    let innerRadius = {}\n    let pixels: number = 7\n\n    if (map.current) {\n        pixels = getPixels(supportedCountry!, Number(currentZoom), miles)\n    }\n\n    stops18.push(['Mock', pixels])\n    stops12.push(['Mock', Number(pixels / 2)])\n    stops6.push([product.productId, Number(pixels / 4)])\n    highlight = {\n        property: 'vendor',\n        type: 'categorical',\n        stops: stops18,\n    }\n    innerRadius = {\n        property: 'vendor',\n        type: 'categorical',\n        stops: stops6,\n    }\n\n    midRadius = {\n      property: 'vendor',\n        type: 'categorical',\n        stops: stops12,\n    }\n\n    return {\n        highlight: highlight,\n        innerRadius: innerRadius,\n        midRadius: midRadius\n    }\n}, [])\n\nconst zooming = useCallback(() => {\n  if (map.current !== undefined) {\n      let currentZoom = map.current.getZoom()\n\n      if (currentZoom) {\n\n          let radius = createRadiusOnZoom(currentZoom)\n\n          if (map.current !== undefined && map.current.isStyleLoaded()) {\n              map.current.setPaintProperty('unclustered-point-1', 'circle-radius', radius.highlight)\n              map.current.setPaintProperty('unclustered-point', 'circle-radius', radius.innerRadius)\n              map.current.setPaintProperty('unclustered-point', 'circle-stroke-width', radius.midRadius)\n          }\n      }\n  }\n}, [createRadiusOnZoom])\n\n\n  return (\n    <>\n      <Legend\n        type=\"dots\"\n        clusters=\"Clusters\"\n        pointCount=\"Views\"\n        clusterImg={clusterBlue}\n        unclusteredImg={unclusteredPoint}\n        unclusteredPoint=\"Unclustered Points\"\n        colorScheme={colorScheme}\n        steps={steps}\n        poi=\"POI\"\n        views=\"Views\"\n        poiColor6Miles={poiColor6Miles}\n        poiViews6Miles={poiViews6Miles}\n        poiColor12Miles={poiColor12Miles}\n        poiViews12Miles={poiViews12Miles}\n        poiColor18Miles={poiColor18Miles}\n        poiViews18Miles={poiViews18Miles}\n      />\n      <div ref={mapContainer} style={{ width: \"100%\", height: \"100vh\" }} />\n      <div className={classes.ctrlWrapper}>\n        <Box>\n        <IconButton aria-label=\"zoom in\">\n          <AddIcon />\n          Plus\n        </IconButton>\n        </Box>\n      </div>\n    </>\n  )\n}\n\n\n"]},"metadata":{},"sourceType":"module"}