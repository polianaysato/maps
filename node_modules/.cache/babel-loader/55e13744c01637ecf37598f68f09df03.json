{"ast":null,"code":"/**\r\n * SankeyLink module\r\n */\nimport { __extends, __read } from \"tslib\";\nimport { FlowDiagramLink } from \"./FlowDiagramLink\";\nimport { registry } from \"../../core/Registry\";\nimport { Polyspline } from \"../../core/elements/Polyspline\";\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\nimport * as $math from \"../../core/utils/Math\";\nimport * as $type from \"../../core/utils/Type\";\nimport * as $smoothing from \"../../core/rendering/Smoothing\";\nimport * as $path from \"../../core/rendering/Path\";\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\n\n/**\r\n * This class creates a link (waved color-filled line) between two nodes in a\r\n * Sankey Diagram.\r\n *\r\n * @see {@link ISankeyLinkEvents} for a list of available events\r\n * @see {@link ISankeyLinkAdapters} for a list of available Adapters\r\n * @important\r\n */\n\nvar SankeyLink =\n/** @class */\nfunction (_super) {\n  __extends(SankeyLink, _super);\n  /**\r\n   * Constructor\r\n   */\n\n\n  function SankeyLink() {\n    var _this = _super.call(this) || this;\n\n    _this.className = \"SankeyLink\"; // TODO can this be removed ?\n\n    new InterfaceColorSet();\n    _this.tension = 0.8;\n    _this.controlPointDistance = 0.2;\n    _this.startAngle = 0;\n    _this.endAngle = 0;\n    _this.linkWidth = 0;\n    _this.startX = 0;\n    _this.endX = 0;\n    _this.startY = 0;\n    _this.endY = 0;\n    _this.middleLine = _this.createChild(Polyspline);\n    _this.middleLine.shouldClone = false;\n    _this.middleLine.strokeOpacity = 0;\n\n    _this.applyTheme();\n\n    return _this;\n  }\n\n  SankeyLink.prototype.makeBackwards = function () {\n    if (this.states.getKey(\"backwards\") != undefined) {\n      this.setState(\"backwards\");\n    }\n  };\n  /**\r\n   * (Re)validates (redraws) the link.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  SankeyLink.prototype.validate = function () {\n    var _a, _b, _c, _d;\n\n    _super.prototype.validate.call(this);\n\n    if (!this.isTemplate) {\n      var x0 = this.startX;\n      var y0 = this.startY;\n      var x1 = this.endX;\n      var y1 = this.endY;\n\n      if (this.states.getKey(\"backwards\")) {\n        this.setState(\"default\");\n      }\n\n      if (this.dataItem) {\n        var chart = this.dataItem.component;\n\n        if (chart) {\n          if (chart.orientation == \"horizontal\") {\n            if (x1 < x0) {\n              _a = __read([x1, x0], 2), x0 = _a[0], x1 = _a[1];\n              _b = __read([y1, y0], 2), y0 = _b[0], y1 = _b[1];\n              this.makeBackwards();\n            }\n          } else {\n            if (y1 < y0) {\n              _c = __read([y1, y0], 2), y0 = _c[0], y1 = _c[1];\n              _d = __read([x1, x0], 2), x0 = _d[0], x1 = _d[1];\n              this.makeBackwards();\n            }\n          }\n        }\n      }\n\n      if (!$type.isNumber(x1)) {\n        x1 = x0;\n      }\n\n      if (!$type.isNumber(y1)) {\n        y1 = y0;\n      }\n\n      var startAngle = this.startAngle;\n      var endAngle = this.endAngle;\n      var w = this.linkWidth;\n      var path = \"\";\n      var xt0 = x0;\n      var yt0 = y0;\n      var xt1 = x1;\n      var yt1 = y1;\n      var xb0 = x0 + w * $math.sin(startAngle);\n      var xb1 = x1 + w * $math.sin(endAngle);\n      var yb0 = y0 + w * $math.cos(startAngle);\n      var yb1 = y1 + w * $math.cos(endAngle);\n      var xm0 = x0 + w / 2 * $math.sin(startAngle);\n      var xm1 = x1 + w / 2 * $math.sin(endAngle);\n      var ym0 = y0 + w / 2 * $math.cos(startAngle);\n      var ym1 = y1 + w / 2 * $math.cos(endAngle);\n      this.zIndex = this.zIndex || this.dataItem.index;\n      var tensionX = this.tension + (1 - this.tension) * $math.sin(startAngle);\n      var tensionY = this.tension + (1 - this.tension) * $math.cos(startAngle);\n      this.middleLine.tensionX = tensionX;\n      this.middleLine.tensionY = tensionY;\n\n      if ($type.isNumber(w) && $type.isNumber(x0) && $type.isNumber(x1) && $type.isNumber(y0) && $type.isNumber(y1)) {\n        // solves issues with gradient fill of straight lines\n        if ($math.round(xt0, 3) == $math.round(xt1, 3)) {\n          xt1 += 0.01;\n        }\n\n        if ($math.round(yt0, 3) == $math.round(yt1, 3)) {\n          yt1 += 0.01;\n        }\n\n        if ($math.round(xb0, 3) == $math.round(xb1, 3)) {\n          xb1 += 0.01;\n        }\n\n        if ($math.round(yb0, 3) == $math.round(yb1, 3)) {\n          yb1 += 0.01;\n        }\n\n        var minX = Math.min(xb0, xb1, xt0, xt1);\n        var minY = Math.min(yb0, yb1, yt0, yt1);\n        var maxX = Math.max(xb0, xb1, xt0, xt1);\n        var maxY = Math.max(yb0, yb1, yt0, yt1);\n        this._bbox = {\n          x: minX,\n          y: minY,\n          width: maxX - minX,\n          height: maxY - minY\n        };\n        var cpd = this.controlPointDistance;\n        var kxt0 = xt0 + (xt1 - xt0) * cpd * $math.cos(startAngle);\n        var kyt0 = yt0 + (yt1 - yt0) * cpd * $math.sin(startAngle);\n        var kxt1 = xt1 - (xt1 - xt0) * cpd * $math.cos(endAngle);\n        var kyt1 = yt1 - (yt1 - yt0) * cpd * $math.sin(endAngle);\n        var kxm0 = xm0 + (xm1 - xm0) * cpd * $math.cos(startAngle);\n        var kym0 = ym0 + (ym1 - ym0) * cpd * $math.sin(startAngle);\n        var kxm1 = xm1 - (xm1 - xm0) * cpd * $math.cos(endAngle);\n        var kym1 = ym1 - (ym1 - ym0) * cpd * $math.sin(endAngle);\n        var angle = $math.getAngle({\n          x: kxt0,\n          y: kyt0\n        }, {\n          x: kxt1,\n          y: kyt1\n        });\n        var dx = (w / $math.cos(angle) - w) / $math.tan(angle) * $math.cos(startAngle);\n        var dy = (w / $math.sin(angle) - w) * $math.tan(angle) * $math.sin(startAngle);\n        var kxb0 = -dx / 2 + xb0 + (xb1 - xb0) * cpd * $math.cos(startAngle);\n        var kyb0 = -dy / 2 + yb0 + (yb1 - yb0) * cpd * $math.sin(startAngle);\n        var kxb1 = -dx / 2 + xb1 - (xb1 - xb0) * cpd * $math.cos(endAngle);\n        var kyb1 = -dy / 2 + yb1 - (yb1 - yb0) * cpd * $math.sin(endAngle);\n        this.middleLine.segments = [[{\n          x: xm0,\n          y: ym0\n        }, {\n          x: kxm0,\n          y: kym0\n        }, {\n          x: kxm1,\n          y: kym1\n        }, {\n          x: xm1,\n          y: ym1\n        }]];\n        kxt0 += dx / 2;\n        kyt0 += dy / 2;\n        kxt1 += dx / 2;\n        kyt1 += dy / 2;\n        path += $path.moveTo({\n          x: xt0,\n          y: yt0\n        });\n        path += new $smoothing.Tension(tensionX, tensionY).smooth([{\n          x: xt0,\n          y: yt0\n        }, {\n          x: kxt0,\n          y: kyt0\n        }, {\n          x: kxt1,\n          y: kyt1\n        }, {\n          x: xt1,\n          y: yt1\n        }]);\n        path += $path.lineTo({\n          x: xb1,\n          y: yb1\n        });\n        path += new $smoothing.Tension(tensionX, tensionY).smooth([{\n          x: xb1,\n          y: yb1\n        }, {\n          x: kxb1,\n          y: kyb1\n        }, {\n          x: kxb0,\n          y: kyb0\n        }, {\n          x: xb0,\n          y: yb0\n        }]);\n        path += $path.closePath();\n      }\n\n      this.link.path = path;\n\n      if (this.maskBullets) {\n        this.bulletsMask.path = path;\n        this.bulletsContainer.mask = this.bulletsMask;\n      }\n\n      this.positionBullets();\n    }\n  };\n\n  Object.defineProperty(SankeyLink.prototype, \"startX\", {\n    /**\r\n     * @return Start X\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"startX\");\n    },\n\n    /**\r\n     * [startX description]\r\n     *\r\n     * @todo Description\r\n     * @param value  Start X\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"startX\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"endX\", {\n    /**\r\n     * @return End X\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"endX\");\n    },\n\n    /**\r\n     * [endX description]\r\n     *\r\n     * @todo Description\r\n     * @param value  End X\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"endX\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"startY\", {\n    /**\r\n     * @return Start Y\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"startY\");\n    },\n\n    /**\r\n     * [startY description]\r\n     *\r\n     * @todo Description\r\n     * @param value  Start Y\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"startY\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"endY\", {\n    /**\r\n     * @return End Y\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"endY\");\n    },\n\n    /**\r\n     * [endY description]\r\n     *\r\n     * @todo Description\r\n     * @param value End Y\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"endY\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"linkWidth\", {\n    /**\r\n     * @return [description]\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"linkWidth\");\n    },\n\n    /**\r\n     * [linkWidth description]\r\n     *\r\n     * @todo Description\r\n     * @param value [description]\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"linkWidth\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"controlPointDistance\", {\n    /**\r\n     * @return relative control point distance\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"controlPointDistance\");\n    },\n\n    /**\r\n     * Distance of control point of a link, defines relative distance from a node at which linke should bend\r\n     * @default 0.2\r\n     * @param value\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"controlPointDistance\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"tension\", {\n    /**\r\n     * @return tension value\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"tension\");\n    },\n\n    /**\r\n     * Tension of a spline, 1 would make the link to have sharp edges\r\n     * @default 0.8\r\n     * @param value\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"tension\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return SankeyLink;\n}(FlowDiagramLink);\n\nexport { SankeyLink };\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\n\nregistry.registeredClasses[\"SankeyLink\"] = SankeyLink;","map":{"version":3,"mappings":"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","names":["FlowDiagramLink","registry","Polyspline","InterfaceColorSet","$math","$type","$smoothing","$path","__extends","_super","_this","className","tension","controlPointDistance","startAngle","endAngle","linkWidth","startX","endX","startY","endY","middleLine","createChild","shouldClone","strokeOpacity","applyTheme","SankeyLink","states","getKey","undefined","setState","validate","call","isTemplate","x0","y0","x1","y1","dataItem","chart","component","orientation","_a","_b","makeBackwards","_c","_d","isNumber","w","path","xt0","yt0","xt1","yt1","xb0","sin","xb1","yb0","cos","yb1","xm0","xm1","ym0","ym1","zIndex","index","tensionX","tensionY","round","minX","Math","min","minY","maxX","max","maxY","_bbox","x","y","width","height","cpd","kxt0","kyt0","kxt1","kyt1","kxm0","kym0","kxm1","kym1","angle","getAngle","dx","tan","dy","kxb0","kyb0","kxb1","kyb1","segments","moveTo","Tension","smooth","lineTo","closePath","link","maskBullets","bulletsMask","bulletsContainer","mask","positionBullets","Object","getPropertyValue","value","setPropertyValue","registeredClasses"],"sourceRoot":"","sources":["../../../../../src/.internal/charts/elements/SankeyLink.ts"],"sourcesContent":["/**\r\n * SankeyLink module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { SankeyDiagramDataItem, SankeyDiagram } from \"../types/SankeyDiagram\";\r\nimport { FlowDiagramLink, IFlowDiagramLinkAdapters, IFlowDiagramLinkEvents, IFlowDiagramLinkProperties } from \"./FlowDiagramLink\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { Polyspline } from \"../../core/elements/Polyspline\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\nimport * as $math from \"../../core/utils/Math\";\r\nimport * as $type from \"../../core/utils/Type\";\r\nimport * as $smoothing from \"../../core/rendering/Smoothing\";\r\nimport * as $path from \"../../core/rendering/Path\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[SankeyLink]].\r\n */\r\nexport interface ISankeyLinkProperties extends IFlowDiagramLinkProperties {\r\n\r\n\t/**\r\n\t * [tension description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\ttension?: number;\r\n\r\n\t/**\r\n\t * [startX description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tstartX?: number;\r\n\r\n\t/**\r\n\t * [startY description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tstartY?: number;\r\n\r\n\t/**\r\n\t * [endX description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tendX?: number;\r\n\r\n\t/**\r\n\t * [endY description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tendY?: number;\r\n\r\n\t/**\r\n\t * [linkWidth description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tlinkWidth?: number;\r\n\r\n\t/**\r\n\t * [controlPointDistance description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tcontrolPointDistance?: number;\r\n}\r\n\r\n/**\r\n * Defines events for [[SankeyLink]].\r\n */\r\nexport interface ISankeyLinkEvents extends IFlowDiagramLinkEvents { }\r\n\r\n/**\r\n * Defines adapters for [[SankeyLink]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface ISankeyLinkAdapters extends IFlowDiagramLinkAdapters, ISankeyLinkProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * This class creates a link (waved color-filled line) between two nodes in a\r\n * Sankey Diagram.\r\n *\r\n * @see {@link ISankeyLinkEvents} for a list of available events\r\n * @see {@link ISankeyLinkAdapters} for a list of available Adapters\r\n * @important\r\n */\r\nexport class SankeyLink extends FlowDiagramLink {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: ISankeyLinkProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: ISankeyLinkAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: ISankeyLinkEvents;\r\n\r\n\t/**\r\n\t * Defines a type of data item used by this class.\r\n\t */\r\n\tpublic _dataItem: SankeyDiagramDataItem;\r\n\r\n\t/**\r\n\t * Spline which goes through the middle of a link, used to calculate bullet and tooltip positions, invisible by default\r\n\t */\r\n\tpublic middleLine: Polyspline;\r\n\r\n\tpublic chart: SankeyDiagram;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"SankeyLink\";\r\n\r\n\t\t// TODO can this be removed ?\r\n\t\tnew InterfaceColorSet();\r\n\r\n\t\tthis.tension = 0.8;\r\n\t\tthis.controlPointDistance = 0.2;\r\n\r\n\t\tthis.startAngle = 0;\r\n\t\tthis.endAngle = 0;\r\n\r\n\t\tthis.linkWidth = 0;\r\n\r\n\t\tthis.startX = 0;\r\n\t\tthis.endX = 0;\r\n\r\n\t\tthis.startY = 0;\r\n\t\tthis.endY = 0;\r\n\r\n\t\tthis.middleLine = this.createChild(Polyspline);\r\n\t\tthis.middleLine.shouldClone = false;\r\n\t\tthis.middleLine.strokeOpacity = 0;\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\tprotected makeBackwards() {\r\n\t\tif (this.states.getKey(\"backwards\") != undefined) {\r\n\t\t\tthis.setState(\"backwards\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates (redraws) the link.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate() {\r\n\t\tsuper.validate();\r\n\r\n\t\tif (!this.isTemplate) {\r\n\r\n\t\t\tlet x0 = this.startX\r\n\t\t\tlet y0 = this.startY;\r\n\t\t\tlet x1 = this.endX;\r\n\t\t\tlet y1 = this.endY;\r\n\r\n\t\t\tif (this.states.getKey(\"backwards\")) {\r\n\t\t\t\tthis.setState(\"default\");\r\n\t\t\t}\r\n\r\n\t\t\tif (this.dataItem) {\r\n\t\t\t\tlet chart = this.dataItem.component;\r\n\r\n\t\t\t\tif (chart) {\r\n\t\t\t\t\tif (chart.orientation == \"horizontal\") {\r\n\t\t\t\t\t\tif (x1 < x0) {\r\n\t\t\t\t\t\t\t[x0, x1] = [x1, x0];\r\n\t\t\t\t\t\t\t[y0, y1] = [y1, y0];\r\n\t\t\t\t\t\t\tthis.makeBackwards();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (y1 < y0) {\r\n\t\t\t\t\t\t\t[y0, y1] = [y1, y0];\r\n\t\t\t\t\t\t\t[x0, x1] = [x1, x0];\r\n\t\t\t\t\t\t\tthis.makeBackwards();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!$type.isNumber(x1)) {\r\n\t\t\t\tx1 = x0;\r\n\t\t\t}\r\n\r\n\t\t\tif (!$type.isNumber(y1)) {\r\n\t\t\t\ty1 = y0;\r\n\t\t\t}\r\n\r\n\t\t\tlet startAngle = this.startAngle;\r\n\t\t\tlet endAngle = this.endAngle;\r\n\t\t\tlet w = this.linkWidth;\r\n\r\n\t\t\tlet path = \"\";\r\n\r\n\t\t\tlet xt0 = x0;\r\n\t\t\tlet yt0 = y0;\r\n\r\n\t\t\tlet xt1 = x1;\r\n\t\t\tlet yt1 = y1;\r\n\r\n\t\t\tlet xb0 = x0 + w * $math.sin(startAngle);\r\n\t\t\tlet xb1 = x1 + w * $math.sin(endAngle);\r\n\r\n\t\t\tlet yb0 = y0 + w * $math.cos(startAngle);\r\n\t\t\tlet yb1 = y1 + w * $math.cos(endAngle);\r\n\r\n\t\t\tlet xm0 = x0 + w / 2 * $math.sin(startAngle);\r\n\t\t\tlet xm1 = x1 + w / 2 * $math.sin(endAngle);\r\n\r\n\t\t\tlet ym0 = y0 + w / 2 * $math.cos(startAngle);\r\n\t\t\tlet ym1 = y1 + w / 2 * $math.cos(endAngle);\r\n\r\n\t\t\tthis.zIndex = this.zIndex || this.dataItem.index;\r\n\r\n\t\t\tlet tensionX = this.tension + (1 - this.tension) * $math.sin(startAngle);\r\n\t\t\tlet tensionY = this.tension + (1 - this.tension) * $math.cos(startAngle);\r\n\r\n\t\t\tthis.middleLine.tensionX = tensionX;\r\n\t\t\tthis.middleLine.tensionY = tensionY;\r\n\r\n\t\t\tif ($type.isNumber(w) && ($type.isNumber(x0) && $type.isNumber(x1) && $type.isNumber(y0) && $type.isNumber(y1))) {\r\n\r\n\t\t\t\t// solves issues with gradient fill of straight lines\r\n\t\t\t\tif ($math.round(xt0, 3) == $math.round(xt1, 3)) {\r\n\t\t\t\t\txt1 += 0.01;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($math.round(yt0, 3) == $math.round(yt1, 3)) {\r\n\t\t\t\t\tyt1 += 0.01;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($math.round(xb0, 3) == $math.round(xb1, 3)) {\r\n\t\t\t\t\txb1 += 0.01;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($math.round(yb0, 3) == $math.round(yb1, 3)) {\r\n\t\t\t\t\tyb1 += 0.01;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet minX = Math.min(xb0, xb1, xt0, xt1);\r\n\t\t\t\tlet minY = Math.min(yb0, yb1, yt0, yt1);\r\n\t\t\t\tlet maxX = Math.max(xb0, xb1, xt0, xt1);\r\n\t\t\t\tlet maxY = Math.max(yb0, yb1, yt0, yt1);\r\n\r\n\t\t\t\tthis._bbox = {\r\n\t\t\t\t\tx: minX,\r\n\t\t\t\t\ty: minY,\r\n\t\t\t\t\twidth: maxX - minX,\r\n\t\t\t\t\theight: maxY - minY\r\n\t\t\t\t};\r\n\r\n\t\t\t\tlet cpd = this.controlPointDistance;\r\n\r\n\t\t\t\tlet kxt0 = xt0 + (xt1 - xt0) * cpd * $math.cos(startAngle);\r\n\t\t\t\tlet kyt0 = yt0 + (yt1 - yt0) * cpd * $math.sin(startAngle);\r\n\r\n\t\t\t\tlet kxt1 = xt1 - (xt1 - xt0) * cpd * $math.cos(endAngle);\r\n\t\t\t\tlet kyt1 = yt1 - (yt1 - yt0) * cpd * $math.sin(endAngle);\r\n\r\n\t\t\t\tlet kxm0 = xm0 + (xm1 - xm0) * cpd * $math.cos(startAngle);\r\n\t\t\t\tlet kym0 = ym0 + (ym1 - ym0) * cpd * $math.sin(startAngle);\r\n\r\n\t\t\t\tlet kxm1 = xm1 - (xm1 - xm0) * cpd * $math.cos(endAngle);\r\n\t\t\t\tlet kym1 = ym1 - (ym1 - ym0) * cpd * $math.sin(endAngle);\r\n\r\n\t\t\t\tlet angle = $math.getAngle({ x: kxt0, y: kyt0 }, { x: kxt1, y: kyt1 });\r\n\r\n\t\t\t\tlet dx = (w / $math.cos(angle) - w) / $math.tan(angle) * $math.cos(startAngle);\r\n\t\t\t\tlet dy = (w / $math.sin(angle) - w) * $math.tan(angle) * $math.sin(startAngle);\r\n\r\n\t\t\t\tlet kxb0 = -dx / 2 + xb0 + (xb1 - xb0) * cpd * $math.cos(startAngle);\r\n\t\t\t\tlet kyb0 = -dy / 2 + yb0 + (yb1 - yb0) * cpd * $math.sin(startAngle);\r\n\r\n\t\t\t\tlet kxb1 = -dx / 2 + xb1 - (xb1 - xb0) * cpd * $math.cos(endAngle);\r\n\t\t\t\tlet kyb1 = -dy / 2 + yb1 - (yb1 - yb0) * cpd * $math.sin(endAngle);\r\n\r\n\r\n\t\t\t\tthis.middleLine.segments = [[{ x: xm0, y: ym0 }, { x: kxm0, y: kym0 }, { x: kxm1, y: kym1 }, { x: xm1, y: ym1 }]];\r\n\r\n\t\t\t\tkxt0 += dx / 2;\r\n\t\t\t\tkyt0 += dy / 2;\r\n\r\n\t\t\t\tkxt1 += dx / 2;\r\n\t\t\t\tkyt1 += dy / 2;\r\n\r\n\t\t\t\tpath += $path.moveTo({ x: xt0, y: yt0 });\r\n\t\t\t\tpath += new $smoothing.Tension(tensionX, tensionY).smooth([{ x: xt0, y: yt0 }, { x: kxt0, y: kyt0 }, { x: kxt1, y: kyt1 }, { x: xt1, y: yt1 }]);\r\n\t\t\t\tpath += $path.lineTo({ x: xb1, y: yb1 });\r\n\t\t\t\tpath += new $smoothing.Tension(tensionX, tensionY).smooth([{ x: xb1, y: yb1 }, { x: kxb1, y: kyb1 }, { x: kxb0, y: kyb0 }, { x: xb0, y: yb0 }]);\r\n\t\t\t\tpath += $path.closePath();\r\n\t\t\t}\r\n\r\n\t\t\tthis.link.path = path;\r\n\r\n\t\t\tif (this.maskBullets) {\r\n\t\t\t\tthis.bulletsMask.path = path;\r\n\t\t\t\tthis.bulletsContainer.mask = this.bulletsMask;\r\n\t\t\t}\r\n\t\t\tthis.positionBullets();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [startX description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param value  Start X\r\n\t */\r\n\tpublic set startX(value: number) {\r\n\t\tthis.setPropertyValue(\"startX\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Start X\r\n\t */\r\n\tpublic get startX(): number {\r\n\t\treturn this.getPropertyValue(\"startX\");\r\n\t}\r\n\r\n\t/**\r\n\t * [endX description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param value  End X\r\n\t */\r\n\tpublic set endX(value: number) {\r\n\t\tthis.setPropertyValue(\"endX\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return End X\r\n\t */\r\n\tpublic get endX(): number {\r\n\t\treturn this.getPropertyValue(\"endX\");\r\n\t}\r\n\r\n\t/**\r\n\t * [startY description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param value  Start Y\r\n\t */\r\n\tpublic set startY(value: number) {\r\n\t\tthis.setPropertyValue(\"startY\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Start Y\r\n\t */\r\n\tpublic get startY(): number {\r\n\t\treturn this.getPropertyValue(\"startY\");\r\n\t}\r\n\r\n\t/**\r\n\t * [endY description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param value End Y\r\n\t */\r\n\tpublic set endY(value: number) {\r\n\t\tthis.setPropertyValue(\"endY\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return End Y\r\n\t */\r\n\tpublic get endY(): number {\r\n\t\treturn this.getPropertyValue(\"endY\");\r\n\t}\r\n\r\n\t/**\r\n\t * [linkWidth description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param value [description]\r\n\t */\r\n\tpublic set linkWidth(value: number) {\r\n\t\tthis.setPropertyValue(\"linkWidth\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return [description]\r\n\t */\r\n\tpublic get linkWidth(): number {\r\n\t\treturn this.getPropertyValue(\"linkWidth\");\r\n\t}\r\n\r\n\t/**\r\n\t * Distance of control point of a link, defines relative distance from a node at which linke should bend\r\n\t * @default 0.2\r\n\t * @param value\r\n\t */\r\n\tpublic set controlPointDistance(value: number) {\r\n\t\tthis.setPropertyValue(\"controlPointDistance\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return relative control point distance\r\n\t */\r\n\tpublic get controlPointDistance(): number {\r\n\t\treturn this.getPropertyValue(\"controlPointDistance\");\r\n\t}\r\n\r\n\t/**\r\n\t * Tension of a spline, 1 would make the link to have sharp edges\r\n\t * @default 0.8\r\n\t * @param value\r\n\t */\r\n\tpublic set tension(value: number) {\r\n\t\tthis.setPropertyValue(\"tension\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return tension value\r\n\t */\r\n\tpublic get tension(): number {\r\n\t\treturn this.getPropertyValue(\"tension\");\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"SankeyLink\"] = SankeyLink;\r\n"]},"metadata":{},"sourceType":"module"}