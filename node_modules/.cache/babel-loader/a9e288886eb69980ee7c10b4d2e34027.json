{"ast":null,"code":"/**\r\n * ExportMenu provides functionality for building Export menu\r\n */\nimport { __extends } from \"tslib\";\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\n\nimport exportCSS from \"./ExportCSS\";\nimport { Adapter } from \"../utils/Adapter\";\nimport { List } from \"../utils/List\";\nimport { getInteraction } from \"../interaction/Interaction\";\nimport { MutableValueDisposer } from \"../utils/Disposer\";\nimport { Language } from \"../utils/Language\";\nimport { Validatable } from \"../utils/Validatable\";\nimport { keyboard } from \"../utils/Keyboard\";\nimport * as $utils from \"../utils/Utils\";\nimport * as $iter from \"../utils/Iterator\";\nimport * as $dom from \"../utils/DOM\";\nimport * as $type from \"../utils/Type\";\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\n\n/**\r\n * Creates a menu for Export operations.\r\n *\r\n * To add an export menu to a chart, set this to a new instance of\r\n * [[ExportMenu]].\r\n *\r\n * ```TypeScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JavaScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JSON\r\n * {\r\n *   // ...\r\n *   \"exporting\": {\r\n *     \"menu\": {}\r\n *   }\r\n * }\r\n * ```\r\n * @important\r\n */\n\nvar ExportMenu =\n/** @class */\nfunction (_super) {\n  __extends(ExportMenu, _super);\n  /**\r\n   * Constructor\r\n   */\n\n\n  function ExportMenu() {\n    var _this = _super.call(this) || this;\n    /**\r\n     * An [[Adapter]].\r\n     */\n\n\n    _this.adapter = new Adapter(_this);\n    /**\r\n     * How many milliseconds to hold menu/sub-menu open after it loses focus or\r\n     * hover, before auto-closing it.\r\n     *\r\n     * @default 1000\r\n     */\n\n    _this.closeDelay = 1000;\n    /**\r\n     * Close the menu automatically when some export operation is triggered.\r\n     *\r\n     * @default true\r\n     * @since 4.2.2\r\n     */\n\n    _this.closeOnClick = true;\n    /**\r\n     * An instance of [[Language]].\r\n     */\n\n    _this._language = new MutableValueDisposer();\n    /**\r\n     * What HTML tags to use to build menu.\r\n     */\n\n    _this._menuTag = \"ul\";\n    /**\r\n     * Which tag to use to enclose individual menu items.\r\n     */\n\n    _this._itemTag = \"li\";\n    /**\r\n     * Tag to wrap menu item labels in.\r\n     */\n\n    _this._labelTag = \"a\";\n    /**\r\n     * Tag to use for icons\r\n     */\n\n    _this._iconTag = \"img\";\n    /**\r\n     * Prefix for class names applied to menu elements.\r\n     */\n\n    _this._classPrefix = \"amexport\";\n    /**\r\n     * If set to `true` [[ExportMenu]] will load it's own external CSS when\r\n     * instantiated.\r\n     */\n\n    _this._defaultStyles = true;\n    /**\r\n     * Horizontal positioning.\r\n     */\n\n    _this._align = \"right\";\n    /**\r\n     * Vertical positioning.\r\n     */\n\n    _this._verticalAlign = \"top\";\n    /**\r\n     * A tabindex to apply to Export Menu.\r\n     */\n\n    _this._tabindex = 0;\n    /**\r\n     * Whether next menu close event should be ignored.\r\n     */\n\n    _this._ignoreNextClose = false;\n    /**\r\n     * Default menu items.\r\n     */\n\n    _this._items = [{\n      \"label\": \"...\",\n      \"menu\": [{\n        \"label\": \"Image\",\n        \"menu\": [{\n          \"type\": \"png\",\n          \"label\": \"PNG\"\n        }, {\n          \"type\": \"jpg\",\n          \"label\": \"JPG\"\n        }, {\n          \"type\": \"svg\",\n          \"label\": \"SVG\"\n        }, {\n          \"type\": \"pdf\",\n          \"label\": \"PDF\"\n        }]\n      }, {\n        \"label\": \"Data\",\n        \"menu\": [{\n          \"type\": \"json\",\n          \"label\": \"JSON\"\n        }, {\n          \"type\": \"csv\",\n          \"label\": \"CSV\"\n        }, {\n          \"type\": \"xlsx\",\n          \"label\": \"XLSX\"\n        }, {\n          \"type\": \"html\",\n          \"label\": \"HTML\"\n        }, {\n          \"type\": \"pdfdata\",\n          \"label\": \"PDF\"\n        }]\n      }, {\n        \"label\": \"Print\",\n        \"type\": \"print\"\n      }]\n    }];\n    _this.className = \"ExportMenu\";\n\n    _this._disposers.push(_this._language);\n\n    _this.invalidate();\n\n    _this.applyTheme();\n\n    return _this;\n  }\n  /**\r\n   * (Re)draws the Export menu.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  ExportMenu.prototype.validate = function () {\n    this.draw();\n\n    _super.prototype.validate.call(this);\n  };\n  /**\r\n   * Draws the menu based on current items.\r\n   *\r\n   * Normally, there's no need to call this explicitly. The chart, if it has\r\n   * export menu enabled, will automatically draw the menu.\r\n   */\n\n\n  ExportMenu.prototype.draw = function () {\n    var _this = this; // Create top-level menu item, or clear it\n\n\n    if (!this._element) {\n      this._element = this.createMenuElement(0);\n    } else {\n      this._element.innerHTML = \"\";\n      this._element.className = this.getMenuItemClass(0);\n    } // See if we're loading external CSS\n    // Hide it until CSS is loaded\n\n\n    if (this.defaultStyles) {\n      this._element.style.display = \"none\";\n    } // Append to container\n\n\n    $type.getValue(this._container).appendChild(this._element); // Apply adapter to menu items before processing\n\n    var items = this.adapter.apply(\"items\", {\n      items: this._items\n    }).items;\n\n    for (var len = items.length, i = 0; i < len; i++) {\n      this.drawBranch(this._element, items[i], 0);\n    } // Apply adapter to finalized menu element\n\n\n    this._element = this.adapter.apply(\"menuElement\", {\n      menuElement: this._element\n    }).menuElement; // Set up global \"down\" event\n\n    this._disposers.push(getInteraction().body.events.on(\"down\", function (ev) {\n      if (!ev.pointer.touch) {\n        _this._ignoreNextClose = false;\n      }\n\n      _this.close();\n    })); // Set up global event on ESC press to close the menu\n\n\n    this._disposers.push(getInteraction().body.events.on(\"keydown\", function (ev) {\n      var key = keyboard.getEventKey(ev.event);\n\n      switch (key) {\n        case \"esc\":\n          _this.close();\n\n          break;\n\n        case \"up\":\n        case \"down\":\n        case \"left\":\n        case \"right\":\n          if (_this._currentSelection) {\n            ev.event.preventDefault();\n          }\n\n          _this.moveSelection(key);\n\n          break;\n      }\n    }));\n\n    if (this.defaultStyles) {\n      this.loadDefaultCSS();\n    }\n  };\n  /**\r\n   * Creates a new branch in export menu. This function is recursive for\r\n   * building multi-level menus.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param container Container to put branch elements in\r\n   * @param branch    Menu item\r\n   * @param level     Current nesting level\r\n   */\n\n\n  ExportMenu.prototype.drawBranch = function (container, branch, level) {\n    var _this = this; // Apply adapter\n\n\n    branch = this.adapter.apply(\"branch\", {\n      branch: branch,\n      level: level\n    }).branch; // Unsupported?\n    // ExportMenu does not check or know for specific browser/system\n    // capabilities. It must happen in some other code and applied via Adapter.\n    // Export itself will check compatibility, but there might be other plugins\n    // that influence it or even add any specific export functionality.\n\n    if (branch.unsupported === true) {\n      return;\n    } // Init ascendants\n\n\n    if (!branch.ascendants) {\n      branch.ascendants = new List();\n    } // Get type\n\n\n    var type = branch.type; // Create an item\n\n    var element = this.createItemElement(level, type); // Create label\n\n    var label; // Create icon\n\n    if (branch.icon) {\n      label = this.createIconElement(level, type);\n      label.src = branch.icon;\n\n      if (branch.label || branch.title) {\n        label.title = branch.title || branch.label;\n      }\n    } else if (branch.svg) {\n      label = this.createSvgElement(level, type, branch.svg);\n\n      if (branch.label || branch.title) {\n        label.title = branch.title || branch.label;\n      }\n    } else {\n      label = this.createLabelElement(level, type);\n      label.innerHTML = branch.label ? this.language.translate(branch.label) : \"\";\n\n      if (branch.title) {\n        label.title = branch.title;\n      }\n    } // Apply reader text to label\n\n\n    var readerLabel = this.getReaderLabel(branch, label.innerHTML);\n    label.setAttribute(\"aria-label\", readerLabel); // Add Label\n\n    element.appendChild(label); // Create interaction object\n    // TODO clean this up when it's disposed\n\n    branch.interactions = getInteraction().getInteraction(element);\n    branch.element = element; // Create interaction manager we can set event listeners to\n\n    if (this.typeClickable(type)) {\n      //branch.interactions.clickable = true;\n      // TODO clean this up when it's disposed\n      branch.interactions.events.on(\"hit\", function (ev) {\n        if (_this.events.isEnabled(\"hit\") && !_this.isDisposed()) {\n          var event_1 = {\n            \"type\": \"hit\",\n            \"event\": ev.event,\n            \"target\": _this,\n            \"branch\": branch\n          };\n\n          _this.events.dispatchImmediately(\"hit\", event_1);\n        }\n      }); // TODO clean this up when it's disposed\n\n      branch.interactions.events.on(\"keyup\", function (ev) {\n        if (keyboard.isKey(ev.event, \"enter\")) {\n          if (_this.events.isEnabled(\"enter\")) {\n            var event_2 = {\n              \"type\": \"enter\",\n              \"event\": ev.event,\n              \"target\": _this,\n              \"branch\": branch\n            };\n\n            _this.events.dispatchImmediately(\"enter\", event_2);\n          }\n        }\n      });\n    }\n\n    {\n      var submenu_1 = this.getSubMenu(branch); // Add ENTER event to open sub-menus\n\n      if (submenu_1 != null) {\n        // TODO clean this up when it's disposed\n        branch.interactions.events.on(\"keyup\", function (ev) {\n          if (keyboard.isKey(ev.event, \"enter\")) {\n            // This is item has sub-menu, activate the first child on ENTER\n            _this.selectBranch(submenu_1[0]); // Attempt to set focus\n\n\n            _this.setFocus(submenu_1[0]);\n          }\n        });\n        branch.interactions.events.on(\"hit\", function (ev) {\n          _this.selectBranch(branch);\n        });\n      }\n    } // Add events\n    // TODO clean this up when it's disposed\n\n    branch.interactions.events.on(\"over\", function (ev) {\n      if (ev.pointer.touch) {\n        // Cancel pending menu closure\n        _this._ignoreNextClose = true;\n      }\n\n      _this.selectBranch(branch);\n\n      if (_this.events.isEnabled(\"over\")) {\n        var event_3 = {\n          \"type\": \"over\",\n          \"event\": ev.event,\n          \"target\": _this,\n          \"branch\": branch\n        };\n\n        _this.events.dispatchImmediately(\"over\", event_3);\n      }\n    }); // TODO clean this up when it's disposed\n\n    branch.interactions.events.on(\"out\", function (ev) {\n      if (_this.isDisposed()) {\n        return;\n      }\n\n      if (!ev.pointer.touch) {\n        _this.delayUnselectBranch(branch);\n      }\n\n      if (_this.events.isEnabled(\"out\")) {\n        var event_4 = {\n          \"type\": \"out\",\n          \"event\": ev.event,\n          \"target\": _this,\n          \"branch\": branch\n        };\n\n        _this.events.dispatchImmediately(\"out\", event_4);\n      }\n    }); // TODO clean this up when it's disposed\n\n    branch.interactions.events.on(\"focus\", function (ev) {\n      _this.selectBranch(branch);\n    }); // TODO clean this up when it's disposed\n\n    branch.interactions.events.on(\"blur\", function (ev) {\n      _this.delayUnselectBranch(branch);\n    }); // Increment level\n\n    var local_level = level + 1; // Has sub-menu?\n\n    if (branch.menu) {\n      var submenu = this.createMenuElement(local_level);\n      branch.submenuElement = submenu;\n\n      for (var len = branch.menu.length, i = 0; i < len; i++) {\n        var ascendants = new List();\n        branch.menu[i].ascendants = ascendants;\n\n        if (branch.ascendants.length) {\n          ascendants.copyFrom(branch.ascendants);\n        }\n\n        ascendants.push(branch);\n        this.drawBranch(submenu, branch.menu[i], local_level);\n      } // Sub-menu is empty (all items are not supported)\n      // Do not draw this menu item at all\n\n\n      if (submenu.innerHTML == \"\") {\n        return;\n      }\n\n      element.appendChild(submenu);\n    } // Should this item be hidden?\n\n\n    if (branch.hidden) {\n      this.hideBranch(branch);\n    } // Add id?\n\n\n    if (branch.id) {\n      element.setAttribute(\"id\", branch.id);\n    } // Background color?\n\n\n    if (branch.color) {\n      element.style.backgroundColor = branch.color.hex;\n    } // Append to container\n\n\n    container.appendChild(element);\n  };\n  /**\r\n   * Creates a menu element to hold its elements in. Usually it's an `<ul>`\r\n   * tag.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @return HTML element reference\r\n   */\n\n\n  ExportMenu.prototype.createMenuElement = function (level) {\n    var element = document.createElement(this.menuTag);\n    element.className = this.getMenuItemClass(level); // Accessibility\n\n    if (level === 0) {\n      element.setAttribute(\"role\", \"menubar\");\n    } else {\n      element.setAttribute(\"role\", \"menu\");\n    }\n\n    return element;\n  };\n  /**\r\n   * Generates a class name for the menu element based on its nesting level.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @return Class name(s)\r\n   */\n\n\n  ExportMenu.prototype.getMenuItemClass = function (level) {\n    var className = this.classPrefix + \"-menu \" + this.classPrefix + \"-menu-level-\" + level;\n\n    if (level === 0) {\n      className += \" \" + this.classPrefix + \"-menu-root \" + this.classPrefix + \"-\" + this.align + \" \" + this.classPrefix + \"-\" + this.verticalAlign;\n    }\n\n    return this.adapter.apply(\"menuClass\", {\n      className: className,\n      level: level\n    }).className;\n  };\n  /**\r\n   * Creates menu item. Usually `<li>` tag. Its label and sub-elements will go\r\n   * into this element.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @param type   Type of the menu item\r\n   * @return HTML element reference\r\n   */\n\n\n  ExportMenu.prototype.createItemElement = function (level, type) {\n    var element = document.createElement(this.itemTag);\n    var className = this.classPrefix + \"-item \" + this.classPrefix + \"-item-level-\" + level + \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\n    element.className = this.adapter.apply(\"itemClass\", {\n      className: className,\n      level: level,\n      type: type\n    }).className;\n    element.setAttribute(\"role\", \"menuitem\");\n    element.setAttribute(\"tabindex\", this.tabindex.toString());\n    return element;\n  };\n  /**\r\n   * Creates a \"label\" part of the menu item. It could be text or any HTML\r\n   * content.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @param type   Type of the menu item\r\n   * @return An HTML Element\r\n   */\n\n\n  ExportMenu.prototype.createLabelElement = function (level, type) {\n    var element = document.createElement(this.labelTag);\n    var className = this.classPrefix + \"-label \" + this.classPrefix + \"-label-level-\" + level + \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\n\n    if (this.typeClickable(type)) {\n      className += \" \" + this.classPrefix + \"-clickable\";\n    }\n\n    element.className = this.adapter.apply(\"labelClass\", {\n      className: className,\n      level: level,\n      type: type\n    }).className; // Accessible navigation\n    //element.setAttribute(\"tabindex\", this.tabindex.toString());\n    //element.setAttribute(\"role\", \"menuitem\");\n\n    return element;\n  };\n  /**\r\n   * Creates a \"icon\" part of the menu item.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @param type   Type of the menu item\r\n   * @return An HTML Element\r\n   */\n\n\n  ExportMenu.prototype.createIconElement = function (level, type) {\n    var element = document.createElement(this.iconTag);\n    var className = this.classPrefix + \"-icon \" + this.classPrefix + \"-icon-level-\" + level + \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\n\n    if (this.typeClickable(type)) {\n      className += \" \" + this.classPrefix + \"-clickable\";\n    }\n\n    element.className = this.adapter.apply(\"labelClass\", {\n      className: className,\n      level: level,\n      type: type\n    }).className; // Accessible navigation\n\n    element.setAttribute(\"tabindex\", this.tabindex.toString());\n    element.setAttribute(\"role\", \"menuitem\");\n    return element;\n  };\n  /**\r\n   * Creates a a custom element out of raw HTML.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param level  Current nesting level\r\n   * @param type   Type of the menu item\r\n   * @return An HTML Element\r\n   */\n\n\n  ExportMenu.prototype.createSvgElement = function (level, type, svg) {\n    var parser = new DOMParser();\n    var element = parser.parseFromString(svg, \"image/svg+xml\").documentElement;\n    var className = this.classPrefix + \"-icon \" + this.classPrefix + \"-icon-level-\" + level + \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\n\n    if (this.typeClickable(type)) {\n      className += \" \" + this.classPrefix + \"-clickable\";\n    }\n\n    element.setAttribute(\"class\", this.adapter.apply(\"labelClass\", {\n      className: className,\n      level: level,\n      type: type\n    }).className); // Accessible navigation\n\n    element.setAttribute(\"tabindex\", this.tabindex.toString());\n    element.setAttribute(\"role\", \"menuitem\");\n    return element;\n  };\n  /**\r\n   * Destroys the menu and all its elements.\r\n   */\n\n\n  ExportMenu.prototype.dispose = function () {\n    if (!this._disposed) {\n      _super.prototype.dispose.call(this);\n\n      if (this._element && this._element.parentNode) {\n        this._element.parentNode.removeChild(this._element);\n      }\n    }\n  };\n  /**\r\n   * Checks whether menu item type is supposed to be clickable.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param type  Menu item type\r\n   * @return Is clickable?\r\n   */\n\n\n  ExportMenu.prototype.typeClickable = function (type) {\n    return $type.hasValue(type);\n  };\n  /**\r\n   * Checks whether menu item has any sub-items.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  A menu item\r\n   * @return Has sub-items?\r\n   */\n\n\n  ExportMenu.prototype.hasSubMenu = function (branch) {\n    return branch.menu && branch.menu.length ? true : false;\n  };\n  /**\r\n   * Returns sub-items (if they exist).\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  A menu item\r\n   * @return Submenus\r\n   */\n\n\n  ExportMenu.prototype.getSubMenu = function (branch) {\n    if (branch.menu && branch.menu.length) {\n      return branch.menu;\n    }\n  };\n  /**\r\n   * Generates and returns an applicable label to be used for screen readers.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param item   A menu item instance\r\n   * @param label  Current label\r\n   * @return Reader text\r\n   */\n\n\n  ExportMenu.prototype.getReaderLabel = function (branch, label) {\n    // Strip any HTML from the label\n    label = $utils.stripTags(label); // Add textual note if the branch is clickable\n\n    if (branch.ascendants.length == 0) {\n      label = label == \"...\" ? this.language.translate(\"Export\") : label;\n      label += \" [\" + this.language.translate(\"Press ENTER or use arrow keys to navigate\") + \"]\";\n    } else if (this.hasSubMenu(branch)) {\n      label += \" [\" + this.language.translate(\"Click, tap or press ENTER to open\") + \"]\";\n    } else if (branch.type == \"print\") {\n      label = this.language.translate(\"Click, tap or press ENTER to print.\");\n    } else if (this.typeClickable(branch.type)) {\n      label = this.language.translate(\"Click, tap or press ENTER to export as %1.\", undefined, label);\n    }\n\n    return this.adapter.apply(\"rederLabel\", {\n      label: label,\n      branch: branch\n    }).label;\n  };\n\n  Object.defineProperty(ExportMenu.prototype, \"container\", {\n    /**\r\n     * @return Container\r\n     */\n    get: function get() {\n      return this._container;\n    },\n\n    /**\r\n     * Getters and setters\r\n     */\n\n    /**\r\n     * An HTML container to place the Menu in.\r\n     *\r\n     * A container must be an HTML element, because menu itself is HTML, and\r\n     * cannot be placed into SVG.\r\n     *\r\n     * @param container Reference to container element\r\n     * @todo Check if menu is already build. If it is, just move it to a new container\r\n     */\n    set: function set(container) {\n      this._container = container;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"items\", {\n    /**\r\n     * @return Menu items\r\n     */\n    get: function get() {\n      return this._items;\n    },\n\n    /**\r\n     * A list of menu items. Can be nested.\r\n     *\r\n     * @param items  Menu items\r\n     */\n    set: function set(items) {\n      this._items = items;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"tag\", {\n    /**\r\n     * Sets main menu tag to place menu in.\r\n     *\r\n     * This also sets up how menu items are built.\r\n     *\r\n     * If you set this to \"ul\", menu items will be wrapped into `<li>` tags.\r\n     *\r\n     * If set to \"div\", menu items will be wrapped in `<div>` tags.\r\n     *\r\n     * @default \"ul\"\r\n     * @param tag Tag to use for menu\r\n     */\n    set: function set(tag) {\n      this._menuTag = tag;\n      this._itemTag = tag == \"ul\" ? \"li\" : \"div\";\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"menuTag\", {\n    /**\r\n     * Returns current menu tag.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Menu tag (item that contains sub-items)\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"menuTag\", {\n        tag: this._menuTag\n      }).tag;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"itemTag\", {\n    /**\r\n     * Returns tag to wrap items into.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Item tag\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"itemTag\", {\n        tag: this._itemTag\n      }).tag;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"labelTag\", {\n    /**\r\n     * Returns menu label tag.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Label tag\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"labelTag\", {\n        tag: this._labelTag\n      }).tag;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"iconTag\", {\n    /**\r\n     * Returns icon tag.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Icon tag\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"iconTag\", {\n        tag: this._iconTag\n      }).tag;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"align\", {\n    /**\r\n     * @return Horizontal alignment\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"align\", {\n        align: this._align\n      }).align;\n    },\n\n    /**\r\n     * A horizontal alignment for the menu placement.\r\n     *\r\n     * @param value Horizontal alignment\r\n     */\n    set: function set(value) {\n      this._align = value;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"verticalAlign\", {\n    /**\r\n     * @return Vertical alignment\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"verticalAlign\", {\n        verticalAlign: this._verticalAlign\n      }).verticalAlign;\n    },\n\n    /**\r\n     * A vertical alignment for the menu placement.\r\n     *\r\n     * @param value Vertical alignment\r\n     */\n    set: function set(value) {\n      this._verticalAlign = value;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"classPrefix\", {\n    /**\r\n     * @return Class name prefix\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"classPrefix\", {\n        classPrefix: this._classPrefix\n      }).classPrefix;\n    },\n\n    /**\r\n     * Class name prefix.\r\n     *\r\n     * @default \"amexport\"\r\n     * @param value Class name prefix\r\n     */\n    set: function set(value) {\n      this._classPrefix = value;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"defaultStyles\", {\n    /**\r\n     * @return Should ExportMenu load its own CSS?\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"defaultStyles\", {\n        defaultStyles: this._defaultStyles\n      }).defaultStyles;\n    },\n\n    /**\r\n     * Indicates whether [[ExportMenu]] should load external CSS to style itself.\r\n     *\r\n     * If set to `false`, the menu will not be styled, and will rely on some\r\n     * external CSS.\r\n     *\r\n     * @default true\r\n     * @param Should ExportMenu load its own CSS?\r\n     */\n    set: function set(value) {\n      if (this._defaultStyles != value) {\n        this._defaultStyles = value;\n\n        if (value) {\n          this.loadDefaultCSS();\n        }\n      }\n\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Loads the default CSS.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n  ExportMenu.prototype.loadDefaultCSS = function () {\n    this._disposers.push(exportCSS($dom.getShadowRoot(this.container), this.classPrefix));\n\n    if (this._element) {\n      this._element.style.display = \"\";\n    }\n  };\n\n  Object.defineProperty(ExportMenu.prototype, \"tabindex\", {\n    /**\r\n     * @return Tab index\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"tabindex\", {\n        tabindex: this._tabindex\n      }).tabindex;\n    },\n\n    /**\r\n     * A tab index for the menu.\r\n     *\r\n     * Tab index will influence the order in which elements on the chart and\r\n     * the whole page are selected when pressing TAB key.\r\n     *\r\n     * @param value Tab index\r\n     */\n    set: function set(value) {\n      this._tabindex = value;\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExportMenu.prototype, \"language\", {\n    /**\r\n     * @return A [[Language]] instance to be used\r\n     */\n    get: function get() {\n      var _this = this;\n\n      var language = this._language.get();\n\n      if (language == null) {\n        language = new Language(); // TODO code duplication with `set language()`\n\n        this._language.set(language, language.events.on(\"localechanged\", function (ev) {\n          _this.invalidate();\n        }));\n      }\n\n      return language;\n    },\n\n    /**\r\n     * A [[Language]] instance.\r\n     *\r\n     * @param value An instance of [[Language]]\r\n     */\n    set: function set(value) {\n      var _this = this;\n\n      this._language.set(value, value.events.on(\"localechanged\", function (ev) {\n        _this.invalidate();\n      }));\n\n      this.invalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Controlling the menu\r\n   */\n\n  /**\r\n   * Removes all active classes from menu items. Useful on touch devices and\r\n   * keyboard navigation where open menu can be closed instantly by clicking or\r\n   * tapping outside it.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n  ExportMenu.prototype.close = function () {\n    var _this = this;\n\n    if (this.isDisposed()) {\n      return;\n    }\n\n    if (this._ignoreNextClose) {\n      this._ignoreNextClose = false;\n      return;\n    }\n\n    if (this.closeOnClick) {\n      this._element.style.pointerEvents = \"none\";\n      setTimeout(function () {\n        _this._element.style.pointerEvents = \"auto\";\n      }, 100);\n    }\n\n    if (this._currentSelection) {\n      this.setBlur(this._currentSelection);\n      this._currentSelection = undefined;\n    }\n\n    if (this._element) {\n      var items = this._element.getElementsByClassName(\"active\");\n\n      for (var len = items.length, i = len - 1; i >= 0; i--) {\n        if (items[i]) {\n          $dom.removeClass(items[i], \"active\");\n        }\n      }\n    }\n\n    this.events.dispatchImmediately(\"closed\", {\n      type: \"closed\",\n      target: this\n    });\n  };\n  /**\r\n   * Selects a branch in the menu.\r\n   *\r\n   * Handles closing of currently open branch.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch Branch to select\r\n   */\n\n\n  ExportMenu.prototype.selectBranch = function (branch) {\n    var _this = this;\n\n    if (this.isDisposed()) {\n      return;\n    } // Cancel previous closure\n\n\n    if (branch.closeTimeout) {\n      this.removeDispose(branch.closeTimeout);\n      branch.closeTimeout = undefined;\n    } // Add active class\n\n\n    $dom.addClass(branch.element, \"active\"); // Set expanded\n\n    if (branch.submenuElement) {\n      branch.submenuElement.setAttribute(\"aria-expanded\", \"true\");\n    } // Remove current selection\n\n\n    if (this._currentSelection && this._currentSelection !== branch && this._currentSelection.ascendants) {\n      $iter.each($iter.concat($iter.fromArray([this._currentSelection]), this._currentSelection.ascendants.iterator()), function (ascendant) {\n        if (!branch.ascendants.contains(ascendant) && branch !== ascendant) {\n          _this.unselectBranch(ascendant, true);\n        }\n      });\n    } // Select and/or cancel timeout for current ascendants\n\n\n    $iter.each(branch.ascendants.iterator(), function (ascendant) {\n      if (ascendant.closeTimeout) {\n        _this.removeDispose(ascendant.closeTimeout);\n\n        ascendant.closeTimeout = undefined;\n      }\n\n      $dom.addClass(ascendant.element, \"active\");\n    }); // Log current selection\n\n    this._currentSelection = branch; // Invoke event\n\n    if (this.events.isEnabled(\"branchselected\")) {\n      var event_5 = {\n        type: \"branchselected\",\n        target: this,\n        branch: branch\n      };\n      this.events.dispatchImmediately(\"branchselected\", event_5);\n    }\n  };\n  /**\r\n   * Unselects a branch. Also selects a branch one level up if necessary.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch Branch to unselect\r\n   * @param simple If `true`, only the branch will be unselected without selecting parent branch\r\n   */\n\n\n  ExportMenu.prototype.unselectBranch = function (branch, simple) {\n    if (this.isDisposed()) {\n      return;\n    } // Remove active class\n\n\n    $dom.removeClass(branch.element, \"active\"); // Set expanded\n\n    if (branch.submenuElement) {\n      branch.submenuElement.removeAttribute(\"aria-expanded\");\n    } // Remove current selection\n\n\n    if (this._currentSelection == branch) {\n      this._currentSelection = undefined;\n    } // Invoke event\n\n\n    if (this.events.isEnabled(\"branchunselected\")) {\n      var event_6 = {\n        type: \"branchunselected\",\n        target: this,\n        branch: branch\n      };\n      this.events.dispatchImmediately(\"branchunselected\", event_6);\n    }\n  };\n  /**\r\n   * Delay unselection of a branch. This can still be cancelled in some other\r\n   * place if the branch or its children regain focus.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch Branch to unselect\r\n   * @param simple If `true`, only the branch will be unselected without selecting parent branch\r\n   */\n\n\n  ExportMenu.prototype.delayUnselectBranch = function (branch, simple) {\n    var _this = this;\n\n    if (this.isDisposed()) {\n      return;\n    } // Schedule branch unselection\n\n\n    if (branch.closeTimeout) {\n      this.removeDispose(branch.closeTimeout);\n      branch.closeTimeout = undefined;\n    }\n\n    branch.closeTimeout = this.setTimeout(function () {\n      _this.unselectBranch(branch, simple);\n    }, this.closeDelay); // Schedule unselection of all ascendants\n    // In case focus went away from the export menu altogether, this will ensure\n    // that all items will be closed.\n    // In case we're jumping to other menu item, those delayed unselections will\n    // be cancelled by `selectBranch`\n\n    if (simple !== true && branch.ascendants) {\n      $iter.each(branch.ascendants.iterator(), function (ascendant) {\n        _this.delayUnselectBranch(ascendant, true);\n      });\n    }\n  };\n  /**\r\n   * Navigates the menu based on which direction kayboard key was pressed.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param key A key that was pressed\r\n   */\n\n\n  ExportMenu.prototype.moveSelection = function (key) {\n    if (this.isDisposed()) {\n      return;\n    } // Check if there's a current selection\n\n\n    if (!this._currentSelection) {\n      return;\n    }\n\n    var newSelection;\n\n    if (key == \"up\") {\n      // Try moving up in current menu list, or to the last item if already\n      // at the top\n      newSelection = this.getPrevSibling(this._currentSelection);\n    } else if (key == \"down\") {\n      // Try moving down in current menu list, or to the top item if already\n      // at the bottom\n      newSelection = this.getNextSibling(this._currentSelection);\n    } else if (key == \"left\" && this.align == \"right\" || key == \"right\" && this.align == \"left\") {\n      var menu = this.getSubMenu(this._currentSelection); // Go one level-deeper\n\n      if (menu != null) {\n        newSelection = menu[0];\n      }\n    } else if (key == \"right\" && this.align == \"right\" || key == \"left\" && this.align == \"left\") {\n      // Go one level-deeper\n      newSelection = this.getParentItem(this._currentSelection);\n    }\n\n    if (newSelection && newSelection !== this._currentSelection) {\n      this.selectBranch(newSelection);\n      this.setFocus(newSelection);\n      this._currentSelection = newSelection;\n    }\n  };\n  /**\r\n   * Returns all siblings of a menu item, including this same menu item.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  Menu item\r\n   * @return List of sibling menu items\r\n   */\n\n\n  ExportMenu.prototype.getSiblings = function (branch) {\n    var parent = this.getParentItem(branch);\n\n    if (parent && parent.menu) {\n      return parent.menu;\n    } else {\n      return [];\n    }\n  };\n  /**\r\n   * Returns menu items parent item.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  Menu item\r\n   * @return Parent menu item\r\n   */\n\n\n  ExportMenu.prototype.getParentItem = function (branch) {\n    if (branch.ascendants && branch.ascendants.length) {\n      return branch.ascendants.getIndex(branch.ascendants.length - 1);\n    } else {\n      return undefined;\n    }\n  };\n  /**\r\n   * Returns next sibling in the same menu branch. If there is no next sibling,\r\n   * the first one is returned. If there is just one item, that item is\r\n   * returned. Unsupported menu items are skipped.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  Menu item to search siblings for\r\n   * @return Menu item\r\n   */\n\n\n  ExportMenu.prototype.getNextSibling = function (branch) {\n    var siblings = this.getSiblings(branch);\n\n    if (siblings.length > 1) {\n      var next = siblings.indexOf(branch) + 1;\n      next = siblings.length == next ? 0 : next;\n      return siblings[next].unsupported ? this.getNextSibling(siblings[next]) : siblings[next];\n    } else {\n      return branch;\n    }\n  };\n  /**\r\n   * Returns previous sibling in the same menu branch. If there is no next\r\n   * sibling, the first one is returned. If there is just one item, that item is\r\n   * returned. Unsupported menu items are skipped.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch  Menu item to search siblings for\r\n   * @return Menu item\r\n   */\n\n\n  ExportMenu.prototype.getPrevSibling = function (branch) {\n    var siblings = this.getSiblings(branch);\n\n    if (siblings.length > 1) {\n      var prev = siblings.indexOf(branch) - 1;\n      prev = prev == -1 ? siblings.length - 1 : prev;\n      return siblings[prev].unsupported ? this.getPrevSibling(siblings[prev]) : siblings[prev];\n    } else {\n      return branch;\n    }\n  };\n  /**\r\n   * Attempts to set focus on particular menu element.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch Menu item\r\n   */\n\n\n  ExportMenu.prototype.setFocus = function (branch) {\n    if (branch.interactions) {\n      try {\n        branch.interactions.element.focus();\n      } catch (e) {// nothing\n      }\n    }\n  };\n  /**\r\n   * Attempts to remove focus from the menu element.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param branch Menu item\r\n   */\n\n\n  ExportMenu.prototype.setBlur = function (branch) {\n    if (branch.interactions) {\n      try {\n        branch.interactions.element.blur();\n      } catch (e) {// nothing\n      }\n    }\n  };\n  /**\r\n   * Hides the whole branch of menu.\r\n   *\r\n   * @param  branch  branch\r\n   */\n\n\n  ExportMenu.prototype.hideBranch = function (branch) {\n    branch.element.style.display = \"none\";\n  };\n  /**\r\n   * Show the branch of menu.\r\n   *\r\n   * @param  branch  branch\r\n   */\n\n\n  ExportMenu.prototype.showBranch = function (branch) {\n    branch.element.style.display = \"\";\n  };\n\n  Object.defineProperty(ExportMenu.prototype, \"element\", {\n    /**\r\n     * The main element o fthe menu - usually `<ul>`.\r\n     *\r\n     * @since 4.10.6\r\n     * @return Menu element\r\n     */\n    get: function get() {\n      return this._element;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return ExportMenu;\n}(Validatable);\n\nexport { ExportMenu };","map":{"version":3,"mappings":"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","names":["exportCSS","Adapter","List","getInteraction","MutableValueDisposer","Language","Validatable","keyboard","$utils","$iter","$dom","$type","__extends","_super","_this","className","_disposers","push","_language","invalidate","applyTheme","ExportMenu","draw","validate","call","_element","createMenuElement","innerHTML","getMenuItemClass","defaultStyles","style","display","getValue","_container","appendChild","items","adapter","apply","_items","len","length","i","drawBranch","menuElement","body","events","on","ev","pointer","touch","_ignoreNextClose","close","key","getEventKey","event","_currentSelection","preventDefault","moveSelection","loadDefaultCSS","container","branch","level","unsupported","ascendants","type","element","createItemElement","label","icon","createIconElement","src","title","svg","createSvgElement","createLabelElement","language","translate","readerLabel","getReaderLabel","setAttribute","interactions","typeClickable","isEnabled","isDisposed","event_1","dispatchImmediately","isKey","event_2","submenu_1","getSubMenu","selectBranch","setFocus","event_3","delayUnselectBranch","event_4","local_level","menu","submenu","submenuElement","copyFrom","hidden","hideBranch","id","color","backgroundColor","hex","document","createElement","menuTag","classPrefix","align","verticalAlign","itemTag","tabindex","toString","labelTag","iconTag","parser","DOMParser","parseFromString","documentElement","_disposed","dispose","parentNode","removeChild","hasValue","stripTags","hasSubMenu","undefined","Object","tag","_menuTag","_itemTag","_labelTag","_iconTag","_align","value","_verticalAlign","_classPrefix","_defaultStyles","getShadowRoot","_tabindex","get","set","closeOnClick","pointerEvents","setTimeout","setBlur","getElementsByClassName","removeClass","target","closeTimeout","removeDispose","addClass","each","concat","fromArray","iterator","ascendant","contains","unselectBranch","event_5","simple","removeAttribute","event_6","closeDelay","newSelection","getPrevSibling","getNextSibling","getParentItem","parent","getIndex","siblings","getSiblings","next","indexOf","prev","focus","e","blur"],"sourceRoot":"","sources":["../../../../../src/.internal/core/export/ExportMenu.ts"],"sourcesContent":["/**\r\n * ExportMenu provides functionality for building Export menu\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport exportCSS from \"./ExportCSS\";\r\nimport { IExportOptions } from \"./Export\";\r\nimport { Adapter } from \"../utils/Adapter\";\r\nimport { List } from \"../utils/List\";\r\nimport { Align } from \"../defs/Align\";\r\nimport { VerticalAlign } from \"../defs/VerticalAlign\";\r\nimport { getInteraction } from \"../interaction/Interaction\";\r\nimport { InteractionObject } from \"../interaction/InteractionObject\";\r\nimport { AMEvent } from \"../utils/EventDispatcher\";\r\nimport { IDisposer, MutableValueDisposer } from \"../utils/Disposer\";\r\nimport { Language, ILocaleProperties } from \"../utils/Language\";\r\nimport { Validatable } from \"../utils/Validatable\";\r\nimport { keyboard, KeyboardKeys } from \"../utils/Keyboard\";\r\nimport { Color } from \"../utils/Color\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $iter from \"../utils/Iterator\";\r\nimport * as $dom from \"../utils/DOM\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Export menu item interface.\r\n */\r\nexport interface IExportMenuItem {\r\n\r\n\t/**\r\n\t * Item type, usually an export format.\r\n\t */\r\n\ttype?: keyof IExportOptions;\r\n\r\n\t/**\r\n\t * Label to display in the menu.\r\n\t */\r\n\tlabel?: string;\r\n\r\n\t/**\r\n\t * Alternative title to be displayed on hover.\r\n\t *\r\n\t * @since 4.9.27\r\n\t */\r\n\ttitle?: string;\r\n\r\n\t/**\r\n\t * A `href` of the image to show instead of a label.\r\n\t */\r\n\ticon?: string;\r\n\r\n\t/**\r\n\t * Raw SVG content to add to instead of regular label.\r\n\t */\r\n\tsvg?: string;\r\n\r\n\t/**\r\n\t * Export format. (optional)\r\n\t */\r\n\tformat?: string;\r\n\r\n\t/**\r\n\t * Menu item options.\r\n\t *\r\n\t * @see {@link IExportOptions}\r\n\t */\r\n\toptions?: IExportOptions[keyof IExportOptions];\r\n\r\n\t/**\r\n\t * Priority.\r\n\t *\r\n\t * The items in Export menu will be sorted by their priority in ascending\r\n\t * order.\r\n\t *\r\n\t * @ignore Exclude from docs (this feature is not yet implemented)\r\n\t */\r\n\tpriority?: number;\r\n\r\n\t/**\r\n\t * An array of [[IExportMenuItem]] items, to construct a sub-menu out of.\r\n\t *\r\n\t * An Export menu can have any number of nesting levels.\r\n\t */\r\n\tmenu?: Array<IExportMenuItem>;\r\n\r\n\t/**\r\n\t * If this is set to true, it means that this specific menu item is not\r\n\t * supported by the current client system.\r\n\t *\r\n\t * This is usually populated by [[Export]]'s `supported` Adapter.\r\n\t *\r\n\t * @see {@link IExportAdapters}\r\n\t */\r\n\tunsupported?: boolean\r\n\r\n\t/**\r\n\t * An [[InteractionObject]] representation of the menu item label.\r\n\t */\r\n\tinteractions?: InteractionObject;\r\n\r\n\t/**\r\n\t * Actual HTML element of the menu item.\r\n\t */\r\n\telement?: HTMLElement;\r\n\r\n\t/**\r\n\t * An element that holds the sub-menu.\r\n\t *\r\n\t * @since 4.10.12\r\n\t */\r\n\tsubmenuElement?: HTMLElement;\r\n\r\n\t/**\r\n\t * Holds list of parent menu items to this item.\r\n\t */\r\n\tascendants?: List<IExportMenuItem>;\r\n\r\n\t/**\r\n\t * Holds timeout reference.\r\n\t *\r\n\t * Used to delay auto-closing of the menu when it is no longer hovered.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tcloseTimeout?: IDisposer;\r\n\r\n\t/**\r\n\t * Should this item be hidden?\r\n\t */\r\n\thidden?: boolean;\r\n\r\n\t/**\r\n\t * A unique id to attach to the menu item.\r\n\t */\r\n\tid?: string;\r\n\r\n\t/**\r\n\t * Color to use as a background.\r\n\t */\r\n\tcolor?: Color;\r\n\r\n}\r\n\r\n/**\r\n * Defines [[ExportMenu]] events.\r\n */\r\nexport interface IExportMenuEvents {\r\n\r\n\t/**\r\n\t * Invoked when menu item is clicked/tapped.\r\n\t */\r\n\thit: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when menu item is hovered.\r\n\t */\r\n\tover: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when menu item is no longer hovered.\r\n\t */\r\n\tout: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when ENTER key is pressed when certain menu item is in focus.\r\n\t */\r\n\tenter: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: KeyboardEvent;\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when menu branch is selected. (either by hover or keyboard)\r\n\t */\r\n\tbranchselected: {\r\n\t\tbranch: IExportMenuItem;\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when menu branch is unselected.\r\n\t */\r\n\tbranchunselected: {\r\n\t\tbranch: IExportMenuItem;\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when menu is closed.\r\n\t */\r\n\tclosed: {};\r\n\r\n}\r\n\r\n/**\r\n * Represents a list of available adapters for Export\r\n */\r\nexport interface IExportMenuAdapters {\r\n\r\n\titems: {\r\n\t\titems: Array<IExportMenuItem>\r\n\t},\r\n\r\n\tmenuElement: {\r\n\t\tmenuElement: HTMLElement\r\n\t},\r\n\r\n\tbranch: {\r\n\t\tbranch: IExportMenuItem,\r\n\t\tlevel: number\r\n\t},\r\n\r\n\trederLabel: {\r\n\t\tlabel: string,\r\n\t\tbranch: IExportMenuItem\r\n\t},\r\n\r\n\tmenuClass: {\r\n\t\tclassName: string,\r\n\t\tlevel: number\r\n\t},\r\n\r\n\titemClass: {\r\n\t\tclassName: string,\r\n\t\tlevel: number,\r\n\t\ttype?: keyof IExportOptions\r\n\t},\r\n\r\n\tlabelClass: {\r\n\t\tclassName: string,\r\n\t\tlevel: number,\r\n\t\ttype?: keyof IExportOptions\r\n\t},\r\n\r\n\tmenuTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\titemTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\tlabelTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\ticonTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\talign: {\r\n\t\talign: Align\r\n\t},\r\n\r\n\tverticalAlign: {\r\n\t\tverticalAlign: VerticalAlign\r\n\t},\r\n\r\n\tclassPrefix: {\r\n\t\tclassPrefix: string\r\n\t},\r\n\r\n\tdefaultStyles: {\r\n\t\tdefaultStyles: boolean\r\n\t},\r\n\r\n\ttabindex: {\r\n\t\ttabindex: number\r\n\t},\r\n\r\n\tcloseOnClick: boolean\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Creates a menu for Export operations.\r\n *\r\n * To add an export menu to a chart, set this to a new instance of\r\n * [[ExportMenu]].\r\n *\r\n * ```TypeScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JavaScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JSON\r\n * {\r\n *   // ...\r\n *   \"exporting\": {\r\n *     \"menu\": {}\r\n *   }\r\n * }\r\n * ```\r\n * @important\r\n */\r\nexport class ExportMenu extends Validatable {\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IExportMenuEvents;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IExportMenuAdapters;\r\n\r\n\t/**\r\n\t * An [[Adapter]].\r\n\t */\r\n\tpublic adapter: Adapter<ExportMenu, IExportMenuAdapters> = new Adapter<ExportMenu, IExportMenuAdapters>(this);\r\n\r\n\t/**\r\n\t * How many milliseconds to hold menu/sub-menu open after it loses focus or\r\n\t * hover, before auto-closing it.\r\n\t *\r\n\t * @default 1000\r\n\t */\r\n\tpublic closeDelay: number = 1000;\r\n\r\n\t/**\r\n\t * Close the menu automatically when some export operation is triggered.\r\n\t *\r\n\t * @default true\r\n\t * @since 4.2.2\r\n\t */\r\n\tpublic closeOnClick: boolean = true;\r\n\r\n\t/**\r\n\t * An instance of [[Language]].\r\n\t */\r\n\tprotected _language = new MutableValueDisposer<Language>();\r\n\r\n\t/**\r\n\t * Reference to DOM element that holds Export menu.\r\n\t */\r\n\tprotected _container: $type.Optional<HTMLElement>;\r\n\r\n\t/**\r\n\t * Menu element.\r\n\t */\r\n\tprotected _element: $type.Optional<HTMLElement>;\r\n\r\n\t/**\r\n\t * Currently selected menu item.\r\n\t */\r\n\tprotected _currentSelection: $type.Optional<IExportMenuItem>;\r\n\r\n\t/**\r\n\t * What HTML tags to use to build menu.\r\n\t */\r\n\tprotected _menuTag: \"ul\" | \"div\" = \"ul\";\r\n\r\n\t/**\r\n\t * Which tag to use to enclose individual menu items.\r\n\t */\r\n\tprotected _itemTag: \"li\" | \"div\" = \"li\";\r\n\r\n\t/**\r\n\t * Tag to wrap menu item labels in.\r\n\t */\r\n\tprotected _labelTag: \"a\" = \"a\";\r\n\r\n\t/**\r\n\t * Tag to use for icons\r\n\t */\r\n\tprotected _iconTag: \"img\" = \"img\";\r\n\r\n\t/**\r\n\t * Prefix for class names applied to menu elements.\r\n\t */\r\n\tprotected _classPrefix: string = \"amexport\";\r\n\r\n\t/**\r\n\t * If set to `true` [[ExportMenu]] will load it's own external CSS when\r\n\t * instantiated.\r\n\t */\r\n\tprotected _defaultStyles: boolean = true;\r\n\r\n\t/**\r\n\t * Horizontal positioning.\r\n\t */\r\n\tprotected _align: Align = \"right\";\r\n\r\n\t/**\r\n\t * Vertical positioning.\r\n\t */\r\n\tprotected _verticalAlign: VerticalAlign = \"top\";\r\n\r\n\t/**\r\n\t * A tabindex to apply to Export Menu.\r\n\t */\r\n\tprotected _tabindex: number = 0;\r\n\r\n\t/**\r\n\t * Whether next menu close event should be ignored.\r\n\t */\r\n\tprotected _ignoreNextClose: boolean = false;\r\n\r\n\t/**\r\n\t * Default menu items.\r\n\t */\r\n\tprotected _items: Array<IExportMenuItem> = [\r\n\t\t{\r\n\t\t\t\"label\": \"...\",\r\n\t\t\t\"menu\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"label\": \"Image\",\r\n\t\t\t\t\t\"menu\": [\r\n\t\t\t\t\t\t{ \"type\": \"png\", \"label\": \"PNG\" },\r\n\t\t\t\t\t\t{ \"type\": \"jpg\", \"label\": \"JPG\" },\r\n\t\t\t\t\t\t{ \"type\": \"svg\", \"label\": \"SVG\" },\r\n\t\t\t\t\t\t{ \"type\": \"pdf\", \"label\": \"PDF\" }\r\n\t\t\t\t\t]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"label\": \"Data\",\r\n\t\t\t\t\t\"menu\": [\r\n\t\t\t\t\t\t{ \"type\": \"json\", \"label\": \"JSON\" },\r\n\t\t\t\t\t\t{ \"type\": \"csv\", \"label\": \"CSV\" },\r\n\t\t\t\t\t\t{ \"type\": \"xlsx\", \"label\": \"XLSX\" },\r\n\t\t\t\t\t\t{ \"type\": \"html\", \"label\": \"HTML\" },\r\n\t\t\t\t\t\t{ \"type\": \"pdfdata\", \"label\": \"PDF\" }\r\n\t\t\t\t\t]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"label\": \"Print\", \"type\": \"print\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t];\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"ExportMenu\";\r\n\t\tthis._disposers.push(this._language);\r\n\t\tthis.invalidate();\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)draws the Export menu.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\t\tthis.draw();\r\n\t\tsuper.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the menu based on current items.\r\n\t *\r\n\t * Normally, there's no need to call this explicitly. The chart, if it has\r\n\t * export menu enabled, will automatically draw the menu.\r\n\t */\r\n\tpublic draw(): void {\r\n\r\n\t\t// Create top-level menu item, or clear it\r\n\t\tif (!this._element) {\r\n\t\t\tthis._element = this.createMenuElement(0);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._element.innerHTML = \"\";\r\n\t\t\tthis._element.className = this.getMenuItemClass(0);\r\n\t\t}\r\n\r\n\t\t// See if we're loading external CSS\r\n\t\t// Hide it until CSS is loaded\r\n\t\tif (this.defaultStyles) {\r\n\t\t\tthis._element.style.display = \"none\";\r\n\t\t}\r\n\r\n\t\t// Append to container\r\n\t\t$type.getValue(this._container).appendChild(this._element);\r\n\r\n\t\t// Apply adapter to menu items before processing\r\n\t\tlet items = this.adapter.apply(\"items\", {\r\n\t\t\titems: this._items\r\n\t\t}).items;\r\n\r\n\t\tfor (let len = items.length, i = 0; i < len; i++) {\r\n\t\t\tthis.drawBranch(this._element, items[i], 0);\r\n\t\t}\r\n\r\n\t\t// Apply adapter to finalized menu element\r\n\t\tthis._element = this.adapter.apply(\"menuElement\", {\r\n\t\t\tmenuElement: this._element\r\n\t\t}).menuElement;\r\n\r\n\t\t// Set up global \"down\" event\r\n\t\tthis._disposers.push(getInteraction().body.events.on(\"down\", (ev) => {\r\n\t\t\tif (!ev.pointer.touch) {\r\n\t\t\t\tthis._ignoreNextClose = false;\r\n\t\t\t}\r\n\t\t\tthis.close();\r\n\t\t}));\r\n\r\n\t\t// Set up global event on ESC press to close the menu\r\n\t\tthis._disposers.push(getInteraction().body.events.on(\"keydown\", (ev) => {\r\n\t\t\tlet key = keyboard.getEventKey(ev.event);\r\n\t\t\tswitch (key) {\r\n\t\t\t\tcase \"esc\":\r\n\t\t\t\t\tthis.close();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"up\":\r\n\t\t\t\tcase \"down\":\r\n\t\t\t\tcase \"left\":\r\n\t\t\t\tcase \"right\":\r\n\t\t\t\t\tif (this._currentSelection) {\r\n\t\t\t\t\t\tev.event.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.moveSelection(key);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tif (this.defaultStyles) {\r\n\t\t\tthis.loadDefaultCSS();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new branch in export menu. This function is recursive for\r\n\t * building multi-level menus.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param container Container to put branch elements in\r\n\t * @param branch    Menu item\r\n\t * @param level     Current nesting level\r\n\t */\r\n\tprotected drawBranch(container: HTMLElement, branch: IExportMenuItem, level: number): void {\r\n\r\n\t\t// Apply adapter\r\n\t\tbranch = this.adapter.apply(\"branch\", {\r\n\t\t\tbranch: branch,\r\n\t\t\tlevel: level\r\n\t\t}).branch;\r\n\r\n\t\t// Unsupported?\r\n\t\t// ExportMenu does not check or know for specific browser/system\r\n\t\t// capabilities. It must happen in some other code and applied via Adapter.\r\n\t\t// Export itself will check compatibility, but there might be other plugins\r\n\t\t// that influence it or even add any specific export functionality.\r\n\t\tif (branch.unsupported === true) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Init ascendants\r\n\t\tif (!branch.ascendants) {\r\n\t\t\tbranch.ascendants = new List<IExportMenuItem>();\r\n\t\t}\r\n\r\n\t\t// Get type\r\n\t\tlet type: keyof IExportOptions | undefined | null = branch.type;\r\n\r\n\t\t// Create an item\r\n\t\tlet element = this.createItemElement(level, type);\r\n\r\n\t\t// Create label\r\n\t\tlet label;\r\n\r\n\t\t// Create icon\r\n\t\tif (branch.icon) {\r\n\t\t\tlabel = this.createIconElement(level, type);\r\n\t\t\t(<HTMLImageElement>label).src = branch.icon;\r\n\t\t\tif (branch.label || branch.title) {\r\n\t\t\t\t(<HTMLImageElement>label).title = branch.title || branch.label;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (branch.svg) {\r\n\t\t\tlabel = this.createSvgElement(level, type, branch.svg);\r\n\t\t\tif (branch.label || branch.title) {\r\n\t\t\t\t(<HTMLElement>label).title = branch.title || branch.label;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlabel = this.createLabelElement(level, type);\r\n\t\t\tlabel.innerHTML = (branch.label ? this.language.translate(<keyof ILocaleProperties>branch.label) : \"\");\r\n\t\t\tif (branch.title) {\r\n\t\t\t\t(<HTMLElement>label).title = branch.title;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Apply reader text to label\r\n\t\tlet readerLabel = this.getReaderLabel(branch, label.innerHTML);\r\n\t\tlabel.setAttribute(\"aria-label\", readerLabel);\r\n\r\n\t\t// Add Label\r\n\t\telement.appendChild(label);\r\n\r\n\t\t// Create interaction object\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions = getInteraction().getInteraction(element);\r\n\t\tbranch.element = element;\r\n\r\n\t\t// Create interaction manager we can set event listeners to\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\t//branch.interactions.clickable = true;\r\n\t\t\t// TODO clean this up when it's disposed\r\n\t\t\tbranch.interactions.events.on(\"hit\", (ev) => {\r\n\t\t\t\tif (this.events.isEnabled(\"hit\") && !this.isDisposed()) {\r\n\t\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"hit\"] = {\r\n\t\t\t\t\t\t\"type\": \"hit\",\r\n\t\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.events.dispatchImmediately(\"hit\", event);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// TODO clean this up when it's disposed\r\n\t\t\tbranch.interactions.events.on(\"keyup\", (ev) => {\r\n\t\t\t\tif (keyboard.isKey(ev.event, \"enter\")) {\r\n\t\t\t\t\tif (this.events.isEnabled(\"enter\")) {\r\n\t\t\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"enter\"] = {\r\n\t\t\t\t\t\t\t\"type\": \"enter\",\r\n\t\t\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.events.dispatchImmediately(\"enter\", event);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t{\r\n\t\t\tconst submenu = this.getSubMenu(branch);\r\n\r\n\t\t\t// Add ENTER event to open sub-menus\r\n\t\t\tif (submenu != null) {\r\n\t\t\t\t// TODO clean this up when it's disposed\r\n\t\t\t\tbranch.interactions.events.on(\"keyup\", (ev) => {\r\n\t\t\t\t\tif (keyboard.isKey(ev.event, \"enter\")) {\r\n\t\t\t\t\t\t// This is item has sub-menu, activate the first child on ENTER\r\n\t\t\t\t\t\tthis.selectBranch(submenu[0]);\r\n\r\n\t\t\t\t\t\t// Attempt to set focus\r\n\t\t\t\t\t\tthis.setFocus(submenu[0]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbranch.interactions.events.on(\"hit\", (ev) => {\r\n\t\t\t\t\tthis.selectBranch(branch);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add events\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"over\", (ev) => {\r\n\r\n\t\t\tif (ev.pointer.touch) {\r\n\t\t\t\t// Cancel pending menu closure\r\n\t\t\t\tthis._ignoreNextClose = true;\r\n\t\t\t}\r\n\r\n\t\t\tthis.selectBranch(branch);\r\n\r\n\t\t\tif (this.events.isEnabled(\"over\")) {\r\n\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"over\"] = {\r\n\t\t\t\t\t\"type\": \"over\",\r\n\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"over\", event);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"out\", (ev) => {\r\n\t\t\tif (this.isDisposed()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!ev.pointer.touch) {\r\n\t\t\t\tthis.delayUnselectBranch(branch);\r\n\t\t\t}\r\n\t\t\tif (this.events.isEnabled(\"out\")) {\r\n\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"out\"] = {\r\n\t\t\t\t\t\"type\": \"out\",\r\n\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"out\", event);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"focus\", (ev) => {\r\n\t\t\tthis.selectBranch(branch);\r\n\t\t});\r\n\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"blur\", (ev) => {\r\n\t\t\tthis.delayUnselectBranch(branch);\r\n\t\t});\r\n\r\n\t\t// Increment level\r\n\t\tlet local_level = level + 1;\r\n\r\n\t\t// Has sub-menu?\r\n\t\tif (branch.menu) {\r\n\t\t\tlet submenu = this.createMenuElement(local_level);\r\n\t\t\tbranch.submenuElement = submenu;\r\n\t\t\tfor (let len = branch.menu.length, i = 0; i < len; i++) {\r\n\t\t\t\tlet ascendants = new List<IExportMenuItem>();\r\n\t\t\t\tbranch.menu[i].ascendants = ascendants;\r\n\t\t\t\tif (branch.ascendants.length) {\r\n\t\t\t\t\tascendants.copyFrom(branch.ascendants);\r\n\t\t\t\t}\r\n\t\t\t\tascendants.push(branch);\r\n\t\t\t\tthis.drawBranch(submenu, branch.menu[i], local_level);\r\n\t\t\t}\r\n\r\n\t\t\t// Sub-menu is empty (all items are not supported)\r\n\t\t\t// Do not draw this menu item at all\r\n\t\t\tif (submenu.innerHTML == \"\") {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telement.appendChild(submenu);\r\n\t\t}\r\n\r\n\t\t// Should this item be hidden?\r\n\t\tif (branch.hidden) {\r\n\t\t\tthis.hideBranch(branch);\r\n\t\t}\r\n\r\n\t\t// Add id?\r\n\t\tif (branch.id) {\r\n\t\t\telement.setAttribute(\"id\", branch.id);\r\n\t\t}\r\n\r\n\t\t// Background color?\r\n\t\tif (branch.color) {\r\n\t\t\telement.style.backgroundColor = branch.color.hex;\r\n\t\t}\r\n\r\n\t\t// Append to container\r\n\t\tcontainer.appendChild(element);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a menu element to hold its elements in. Usually it's an `<ul>`\r\n\t * tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @return HTML element reference\r\n\t */\r\n\tpublic createMenuElement(level: number): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.menuTag);\r\n\t\telement.className = this.getMenuItemClass(level);\r\n\r\n\t\t// Accessibility\r\n\t\tif (level === 0) {\r\n\t\t\telement.setAttribute(\"role\", \"menubar\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\telement.setAttribute(\"role\", \"menu\");\r\n\t\t}\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Generates a class name for the menu element based on its nesting level.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @return Class name(s)\r\n\t */\r\n\tpublic getMenuItemClass(level: number): string {\r\n\t\tlet className = this.classPrefix + \"-menu \" + this.classPrefix + \"-menu-level-\" + level;\r\n\t\tif (level === 0) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-menu-root \" +\r\n\t\t\t\tthis.classPrefix + \"-\" + this.align + \" \" +\r\n\t\t\t\tthis.classPrefix + \"-\" + this.verticalAlign;\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"menuClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level\r\n\t\t}).className;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates menu item. Usually `<li>` tag. Its label and sub-elements will go\r\n\t * into this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return HTML element reference\r\n\t */\r\n\tpublic createItemElement(level: number, type?: keyof IExportOptions): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.itemTag);\r\n\t\tlet className = this.classPrefix + \"-item \" + this.classPrefix\r\n\t\t\t+ \"-item-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\telement.className = this.adapter.apply(\"itemClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className;\r\n\t\telement.setAttribute(\"role\", \"menuitem\");\r\n\t\telement.setAttribute(\"tabindex\", this.tabindex.toString());\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a \"label\" part of the menu item. It could be text or any HTML\r\n\t * content.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return An HTML Element\r\n\t */\r\n\tpublic createLabelElement(level: number, type?: keyof IExportOptions): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.labelTag);\r\n\t\tlet className = this.classPrefix + \"-label \" + this.classPrefix\r\n\t\t\t+ \"-label-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-clickable\";\r\n\t\t}\r\n\t\telement.className = this.adapter.apply(\"labelClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className;\r\n\r\n\t\t// Accessible navigation\r\n\t\t//element.setAttribute(\"tabindex\", this.tabindex.toString());\r\n\t\t//element.setAttribute(\"role\", \"menuitem\");\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a \"icon\" part of the menu item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return An HTML Element\r\n\t */\r\n\tpublic createIconElement(level: number, type?: keyof IExportOptions): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.iconTag);\r\n\t\tlet className = this.classPrefix + \"-icon \" + this.classPrefix\r\n\t\t\t+ \"-icon-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-clickable\";\r\n\t\t}\r\n\t\telement.className = this.adapter.apply(\"labelClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className;\r\n\r\n\t\t// Accessible navigation\r\n\t\telement.setAttribute(\"tabindex\", this.tabindex.toString());\r\n\t\telement.setAttribute(\"role\", \"menuitem\");\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a a custom element out of raw HTML.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return An HTML Element\r\n\t */\r\n\tpublic createSvgElement(level: number, type?: keyof IExportOptions, svg?: string): HTMLElement {\r\n\t\tlet parser = new DOMParser();\r\n\t\tlet element = parser.parseFromString(svg, \"image/svg+xml\").documentElement;\r\n\t\tlet className = this.classPrefix + \"-icon \" + this.classPrefix\r\n\t\t\t+ \"-icon-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-clickable\";\r\n\t\t}\r\n\t\telement.setAttribute(\"class\", this.adapter.apply(\"labelClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className);\r\n\r\n\t\t// Accessible navigation\r\n\t\telement.setAttribute(\"tabindex\", this.tabindex.toString());\r\n\t\telement.setAttribute(\"role\", \"menuitem\");\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys the menu and all its elements.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tif (!this._disposed) {\r\n\t\t\tsuper.dispose();\r\n\r\n\t\t\tif (this._element && this._element.parentNode) {\r\n\t\t\t\tthis._element.parentNode.removeChild(this._element);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether menu item type is supposed to be clickable.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param type  Menu item type\r\n\t * @return Is clickable?\r\n\t */\r\n\tpublic typeClickable(type: keyof IExportOptions | undefined | null): type is keyof IExportOptions {\r\n\t\treturn $type.hasValue(type);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether menu item has any sub-items.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  A menu item\r\n\t * @return Has sub-items?\r\n\t */\r\n\tpublic hasSubMenu(branch: IExportMenuItem): boolean {\r\n\t\treturn (branch.menu && branch.menu.length) ? true : false;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns sub-items (if they exist).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  A menu item\r\n\t * @return Submenus\r\n\t */\r\n\tpublic getSubMenu(branch: IExportMenuItem): $type.Optional<Array<IExportMenuItem>> {\r\n\t\tif (branch.menu && branch.menu.length) {\r\n\t\t\treturn branch.menu;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Generates and returns an applicable label to be used for screen readers.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param item   A menu item instance\r\n\t * @param label  Current label\r\n\t * @return Reader text\r\n\t */\r\n\tpublic getReaderLabel(branch: IExportMenuItem, label: string): string {\r\n\r\n\t\t// Strip any HTML from the label\r\n\t\tlabel = $utils.stripTags(label);\r\n\r\n\t\t// Add textual note if the branch is clickable\r\n\t\tif (branch.ascendants.length == 0) {\r\n\t\t\tlabel = label == \"...\" ? this.language.translate(\"Export\") : label;\r\n\t\t\tlabel += \" [\" + this.language.translate(\"Press ENTER or use arrow keys to navigate\") + \"]\";\r\n\t\t}\r\n\t\telse if (this.hasSubMenu(branch)) {\r\n\t\t\tlabel += \" [\" + this.language.translate(\"Click, tap or press ENTER to open\") + \"]\";\r\n\t\t}\r\n\t\telse if (branch.type == \"print\") {\r\n\t\t\tlabel = this.language.translate(\"Click, tap or press ENTER to print.\");\r\n\t\t}\r\n\t\telse if (this.typeClickable(branch.type)) {\r\n\t\t\tlabel = this.language.translate(\"Click, tap or press ENTER to export as %1.\", undefined, label);\r\n\t\t}\r\n\r\n\t\treturn this.adapter.apply(\"rederLabel\", {\r\n\t\t\tlabel: label,\r\n\t\t\tbranch: branch\r\n\t\t}).label;\r\n\t}\r\n\r\n\t/**\r\n\t * Getters and setters\r\n\t */\r\n\r\n\t/**\r\n\t * An HTML container to place the Menu in.\r\n\t *\r\n\t * A container must be an HTML element, because menu itself is HTML, and\r\n\t * cannot be placed into SVG.\r\n\t *\r\n\t * @param container Reference to container element\r\n\t * @todo Check if menu is already build. If it is, just move it to a new container\r\n\t */\r\n\tpublic set container(container: $type.Optional<HTMLElement>) {\r\n\t\tthis._container = container;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Container\r\n\t */\r\n\tpublic get container(): $type.Optional<HTMLElement> {\r\n\t\treturn this._container;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of menu items. Can be nested.\r\n\t *\r\n\t * @param items  Menu items\r\n\t */\r\n\tpublic set items(items: Array<IExportMenuItem>) {\r\n\t\tthis._items = items;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Menu items\r\n\t */\r\n\tpublic get items(): Array<IExportMenuItem> {\r\n\t\treturn this._items;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets main menu tag to place menu in.\r\n\t *\r\n\t * This also sets up how menu items are built.\r\n\t *\r\n\t * If you set this to \"ul\", menu items will be wrapped into `<li>` tags.\r\n\t *\r\n\t * If set to \"div\", menu items will be wrapped in `<div>` tags.\r\n\t *\r\n\t * @default \"ul\"\r\n\t * @param tag Tag to use for menu\r\n\t */\r\n\tpublic set tag(tag: \"ul\" | \"div\") {\r\n\t\tthis._menuTag = tag;\r\n\t\tthis._itemTag = tag == \"ul\" ? \"li\" : \"div\";\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current menu tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Menu tag (item that contains sub-items)\r\n\t */\r\n\tpublic get menuTag(): string {\r\n\t\treturn this.adapter.apply(\"menuTag\", {\r\n\t\t\ttag: this._menuTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns tag to wrap items into.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Item tag\r\n\t */\r\n\tpublic get itemTag(): string {\r\n\t\treturn this.adapter.apply(\"itemTag\", {\r\n\t\t\ttag: this._itemTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns menu label tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Label tag\r\n\t */\r\n\tpublic get labelTag(): string {\r\n\t\treturn this.adapter.apply(\"labelTag\", {\r\n\t\t\ttag: this._labelTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns icon tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Icon tag\r\n\t */\r\n\tpublic get iconTag(): string {\r\n\t\treturn this.adapter.apply(\"iconTag\", {\r\n\t\t\ttag: this._iconTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * A horizontal alignment for the menu placement.\r\n\t *\r\n\t * @param value Horizontal alignment\r\n\t */\r\n\tpublic set align(value: Align) {\r\n\t\tthis._align = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Horizontal alignment\r\n\t */\r\n\tpublic get align(): Align {\r\n\t\treturn this.adapter.apply(\"align\", {\r\n\t\t\talign: this._align\r\n\t\t}).align;\r\n\t}\r\n\r\n\t/**\r\n\t * A vertical alignment for the menu placement.\r\n\t *\r\n\t * @param value Vertical alignment\r\n\t */\r\n\tpublic set verticalAlign(value: VerticalAlign) {\r\n\t\tthis._verticalAlign = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Vertical alignment\r\n\t */\r\n\tpublic get verticalAlign(): VerticalAlign {\r\n\t\treturn this.adapter.apply(\"verticalAlign\", {\r\n\t\t\tverticalAlign: this._verticalAlign\r\n\t\t}).verticalAlign;\r\n\t}\r\n\r\n\t/**\r\n\t * Class name prefix.\r\n\t *\r\n\t * @default \"amexport\"\r\n\t * @param value Class name prefix\r\n\t */\r\n\tpublic set classPrefix(value: string) {\r\n\t\tthis._classPrefix = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Class name prefix\r\n\t */\r\n\tpublic get classPrefix(): string {\r\n\t\treturn this.adapter.apply(\"classPrefix\", {\r\n\t\t\tclassPrefix: this._classPrefix\r\n\t\t}).classPrefix;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether [[ExportMenu]] should load external CSS to style itself.\r\n\t *\r\n\t * If set to `false`, the menu will not be styled, and will rely on some\r\n\t * external CSS.\r\n\t *\r\n\t * @default true\r\n\t * @param Should ExportMenu load its own CSS?\r\n\t */\r\n\tpublic set defaultStyles(value: boolean) {\r\n\t\tif (this._defaultStyles != value) {\r\n\t\t\tthis._defaultStyles = value;\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.loadDefaultCSS();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Should ExportMenu load its own CSS?\r\n\t */\r\n\tpublic get defaultStyles(): boolean {\r\n\t\treturn this.adapter.apply(\"defaultStyles\", {\r\n\t\t\tdefaultStyles: this._defaultStyles\r\n\t\t}).defaultStyles;\r\n\t}\r\n\r\n\t/**\r\n\t * Loads the default CSS.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic loadDefaultCSS(): void {\r\n\t\tthis._disposers.push(exportCSS($dom.getShadowRoot(this.container), this.classPrefix));\r\n\r\n\t\tif (this._element) {\r\n\t\t\tthis._element.style.display = \"\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A tab index for the menu.\r\n\t *\r\n\t * Tab index will influence the order in which elements on the chart and\r\n\t * the whole page are selected when pressing TAB key.\r\n\t *\r\n\t * @param value Tab index\r\n\t */\r\n\tpublic set tabindex(value: number) {\r\n\t\tthis._tabindex = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tab index\r\n\t */\r\n\tpublic get tabindex(): number {\r\n\t\treturn this.adapter.apply(\"tabindex\", {\r\n\t\t\ttabindex: this._tabindex\r\n\t\t}).tabindex;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Language]] instance.\r\n\t *\r\n\t * @param value An instance of [[Language]]\r\n\t */\r\n\tpublic set language(value: Language) {\r\n\t\tthis._language.set(value, value.events.on(\"localechanged\", (ev) => {\r\n\t\t\tthis.invalidate();\r\n\t\t}));\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return A [[Language]] instance to be used\r\n\t */\r\n\tpublic get language(): Language {\r\n\t\tlet language = this._language.get();\r\n\r\n\t\tif (language == null) {\r\n\t\t\tlanguage = new Language();\r\n\r\n\t\t\t// TODO code duplication with `set language()`\r\n\t\t\tthis._language.set(language, language.events.on(\"localechanged\", (ev) => {\r\n\t\t\t\tthis.invalidate();\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\treturn language;\r\n\t}\r\n\r\n\t/**\r\n\t * Controlling the menu\r\n\t */\r\n\r\n\t/**\r\n\t * Removes all active classes from menu items. Useful on touch devices and\r\n\t * keyboard navigation where open menu can be closed instantly by clicking or\r\n\t * tapping outside it.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic close(): void {\r\n\r\n\t\tif (this.isDisposed()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this._ignoreNextClose) {\r\n\t\t\tthis._ignoreNextClose = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.closeOnClick) {\r\n\t\t\tthis._element.style.pointerEvents = \"none\";\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis._element.style.pointerEvents = \"auto\";\r\n\t\t\t}, 100);\r\n\t\t}\r\n\r\n\t\tif (this._currentSelection) {\r\n\t\t\tthis.setBlur(this._currentSelection);\r\n\t\t\tthis._currentSelection = undefined;\r\n\t\t}\r\n\r\n\t\tif (this._element) {\r\n\t\t\tlet items = this._element.getElementsByClassName(\"active\");\r\n\t\t\tfor (let len = items.length, i = len - 1; i >= 0; i--) {\r\n\t\t\t\tif (items[i]) {\r\n\t\t\t\t\t$dom.removeClass(<HTMLElement>items[i], \"active\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.events.dispatchImmediately(\"closed\", {\r\n\t\t\ttype: \"closed\",\r\n\t\t\ttarget: this\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Selects a branch in the menu.\r\n\t *\r\n\t * Handles closing of currently open branch.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Branch to select\r\n\t */\r\n\tpublic selectBranch(branch: IExportMenuItem): void {\r\n\r\n\t\tif (this.isDisposed()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Cancel previous closure\r\n\t\tif (branch.closeTimeout) {\r\n\t\t\tthis.removeDispose(branch.closeTimeout);\r\n\t\t\tbranch.closeTimeout = undefined;\r\n\t\t}\r\n\r\n\t\t// Add active class\r\n\t\t$dom.addClass(branch.element, \"active\");\r\n\r\n\t\t// Set expanded\r\n\t\tif (branch.submenuElement) {\r\n\t\t\tbranch.submenuElement.setAttribute(\"aria-expanded\", \"true\");\r\n\t\t}\r\n\r\n\t\t// Remove current selection\r\n\t\tif (this._currentSelection && this._currentSelection !== branch && this._currentSelection.ascendants) {\r\n\t\t\t$iter.each($iter.concat($iter.fromArray([this._currentSelection]), this._currentSelection.ascendants.iterator()), (ascendant) => {\r\n\t\t\t\tif (!branch.ascendants.contains(ascendant) && branch !== ascendant) {\r\n\t\t\t\t\tthis.unselectBranch(ascendant, true);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Select and/or cancel timeout for current ascendants\r\n\t\t$iter.each(branch.ascendants.iterator(), (ascendant) => {\r\n\t\t\tif (ascendant.closeTimeout) {\r\n\t\t\t\tthis.removeDispose(ascendant.closeTimeout);\r\n\t\t\t\tascendant.closeTimeout = undefined;\r\n\t\t\t}\r\n\t\t\t$dom.addClass(ascendant.element, \"active\");\r\n\t\t});\r\n\r\n\t\t// Log current selection\r\n\t\tthis._currentSelection = branch;\r\n\r\n\t\t// Invoke event\r\n\t\tif (this.events.isEnabled(\"branchselected\")) {\r\n\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"branchselected\"] = {\r\n\t\t\t\ttype: \"branchselected\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tbranch: branch\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"branchselected\", event);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Unselects a branch. Also selects a branch one level up if necessary.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Branch to unselect\r\n\t * @param simple If `true`, only the branch will be unselected without selecting parent branch\r\n\t */\r\n\tpublic unselectBranch(branch: IExportMenuItem, simple?: boolean): void {\r\n\r\n\t\tif (this.isDisposed()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Remove active class\r\n\t\t$dom.removeClass(branch.element, \"active\");\r\n\r\n\t\t// Set expanded\r\n\t\tif (branch.submenuElement) {\r\n\t\t\tbranch.submenuElement.removeAttribute(\"aria-expanded\");\r\n\t\t}\r\n\r\n\t\t// Remove current selection\r\n\t\tif (this._currentSelection == branch) {\r\n\t\t\tthis._currentSelection = undefined;\r\n\t\t}\r\n\r\n\t\t// Invoke event\r\n\t\tif (this.events.isEnabled(\"branchunselected\")) {\r\n\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"branchunselected\"] = {\r\n\t\t\t\ttype: \"branchunselected\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tbranch: branch\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"branchunselected\", event);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Delay unselection of a branch. This can still be cancelled in some other\r\n\t * place if the branch or its children regain focus.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Branch to unselect\r\n\t * @param simple If `true`, only the branch will be unselected without selecting parent branch\r\n\t */\r\n\tpublic delayUnselectBranch(branch: IExportMenuItem, simple?: boolean): void {\r\n\r\n\t\tif (this.isDisposed()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Schedule branch unselection\r\n\t\tif (branch.closeTimeout) {\r\n\t\t\tthis.removeDispose(branch.closeTimeout);\r\n\t\t\tbranch.closeTimeout = undefined;\r\n\t\t}\r\n\t\tbranch.closeTimeout = this.setTimeout(() => {\r\n\t\t\tthis.unselectBranch(branch, simple);\r\n\t\t}, this.closeDelay);\r\n\r\n\t\t// Schedule unselection of all ascendants\r\n\t\t// In case focus went away from the export menu altogether, this will ensure\r\n\t\t// that all items will be closed.\r\n\t\t// In case we're jumping to other menu item, those delayed unselections will\r\n\t\t// be cancelled by `selectBranch`\r\n\t\tif (simple !== true && branch.ascendants) {\r\n\t\t\t$iter.each(branch.ascendants.iterator(), (ascendant) => {\r\n\t\t\t\tthis.delayUnselectBranch(ascendant, true);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Navigates the menu based on which direction kayboard key was pressed.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param key A key that was pressed\r\n\t */\r\n\tpublic moveSelection(key: KeyboardKeys): void {\r\n\r\n\t\tif (this.isDisposed()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Check if there's a current selection\r\n\t\tif (!this._currentSelection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet newSelection: $type.Optional<IExportMenuItem>;\r\n\r\n\t\tif (key == \"up\") {\r\n\t\t\t// Try moving up in current menu list, or to the last item if already\r\n\t\t\t// at the top\r\n\t\t\tnewSelection = this.getPrevSibling(this._currentSelection);\r\n\t\t}\r\n\t\telse if (key == \"down\") {\r\n\t\t\t// Try moving down in current menu list, or to the top item if already\r\n\t\t\t// at the bottom\r\n\t\t\tnewSelection = this.getNextSibling(this._currentSelection);\r\n\t\t}\r\n\t\telse if ((key == \"left\" && this.align == \"right\") || (key == \"right\" && this.align == \"left\")) {\r\n\t\t\tlet menu = this.getSubMenu(this._currentSelection);\r\n\r\n\t\t\t// Go one level-deeper\r\n\t\t\tif (menu != null) {\r\n\t\t\t\tnewSelection = menu[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ((key == \"right\" && this.align == \"right\") || (key == \"left\" && this.align == \"left\")) {\r\n\t\t\t// Go one level-deeper\r\n\t\t\tnewSelection = this.getParentItem(this._currentSelection);\r\n\t\t}\r\n\r\n\t\tif (newSelection && newSelection !== this._currentSelection) {\r\n\t\t\tthis.selectBranch(newSelection);\r\n\t\t\tthis.setFocus(newSelection);\r\n\t\t\tthis._currentSelection = newSelection;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns all siblings of a menu item, including this same menu item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item\r\n\t * @return List of sibling menu items\r\n\t */\r\n\tpublic getSiblings(branch: IExportMenuItem): Array<IExportMenuItem> {\r\n\t\tlet parent = this.getParentItem(branch);\r\n\r\n\t\tif (parent && parent.menu) {\r\n\t\t\treturn parent.menu;\r\n\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns menu items parent item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item\r\n\t * @return Parent menu item\r\n\t */\r\n\tpublic getParentItem(branch: IExportMenuItem): $type.Optional<IExportMenuItem> {\r\n\t\tif (branch.ascendants && branch.ascendants.length) {\r\n\t\t\treturn branch.ascendants.getIndex(branch.ascendants.length - 1);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns next sibling in the same menu branch. If there is no next sibling,\r\n\t * the first one is returned. If there is just one item, that item is\r\n\t * returned. Unsupported menu items are skipped.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item to search siblings for\r\n\t * @return Menu item\r\n\t */\r\n\tpublic getNextSibling(branch: IExportMenuItem): IExportMenuItem {\r\n\t\tlet siblings = this.getSiblings(branch);\r\n\t\tif (siblings.length > 1) {\r\n\t\t\tlet next = siblings.indexOf(branch) + 1;\r\n\t\t\tnext = siblings.length == next ? 0 : next;\r\n\t\t\treturn siblings[next].unsupported ? this.getNextSibling(siblings[next]) : siblings[next];\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn branch;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns previous sibling in the same menu branch. If there is no next\r\n\t * sibling, the first one is returned. If there is just one item, that item is\r\n\t * returned. Unsupported menu items are skipped.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item to search siblings for\r\n\t * @return Menu item\r\n\t */\r\n\tpublic getPrevSibling(branch: IExportMenuItem): IExportMenuItem {\r\n\t\tlet siblings = this.getSiblings(branch);\r\n\t\tif (siblings.length > 1) {\r\n\t\t\tlet prev = siblings.indexOf(branch) - 1;\r\n\t\t\tprev = prev == -1 ? siblings.length - 1 : prev;\r\n\t\t\treturn siblings[prev].unsupported ? this.getPrevSibling(siblings[prev]) : siblings[prev];\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn branch;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempts to set focus on particular menu element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Menu item\r\n\t */\r\n\tpublic setFocus(branch: IExportMenuItem): void {\r\n\t\tif (branch.interactions) {\r\n\t\t\ttry {\r\n\t\t\t\t(<HTMLElement>branch.interactions.element).focus();\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\t// nothing\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempts to remove focus from the menu element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Menu item\r\n\t */\r\n\tpublic setBlur(branch: IExportMenuItem): void {\r\n\t\tif (branch.interactions) {\r\n\t\t\ttry {\r\n\t\t\t\t(<HTMLElement>branch.interactions.element).blur();\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\t// nothing\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides the whole branch of menu.\r\n\t *\r\n\t * @param  branch  branch\r\n\t */\r\n\tpublic hideBranch(branch: IExportMenuItem): void {\r\n\t\tbranch.element.style.display = \"none\";\r\n\t}\r\n\r\n\t/**\r\n\t * Show the branch of menu.\r\n\t *\r\n\t * @param  branch  branch\r\n\t */\r\n\tpublic showBranch(branch: IExportMenuItem): void {\r\n\t\tbranch.element.style.display = \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * The main element o fthe menu - usually `<ul>`.\r\n\t *\r\n\t * @since 4.10.6\r\n\t * @return Menu element\r\n\t */\r\n\tpublic get element(): $type.Optional<HTMLElement> {\r\n\t\treturn this._element;\r\n\t}\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}