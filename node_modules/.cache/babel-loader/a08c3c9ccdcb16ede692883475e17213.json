{"ast":null,"code":"/**\r\n * Popup class is used to display information over chart area.\r\n */\nimport { __extends } from \"tslib\";\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\n\nimport popupCSS from \"./PopupCSS\";\nimport { Adapter } from \"../utils/Adapter\";\nimport { BaseObjectEvents } from \"../Base\";\nimport { getInteraction } from \"../interaction/Interaction\";\nimport { keyboard } from \"../utils/Keyboard\";\nimport { MultiDisposer } from \"../utils/Disposer\";\nimport { getShadowRoot } from \"../utils/DOM\";\nimport * as $type from \"../utils/Type\";\nimport * as $object from \"../utils/Object\";\n/**\r\n * Shows an HTML popup which covers window or a chart area.\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v4/concepts/popups-and-modals/} For examples and docs on Popups and Modals.\r\n * @todo Positioning over whole window\r\n */\n\nvar Popup =\n/** @class */\nfunction (_super) {\n  __extends(Popup, _super);\n  /**\r\n   * Constructor\r\n   */\n\n\n  function Popup() {\n    var _this = _super.call(this) || this;\n    /**\r\n     * Adapter.\r\n     */\n\n\n    _this.adapter = new Adapter(_this);\n    /**\r\n     * Holds references to various HTML elements, Popup consists of.\r\n     */\n\n    _this._elements = {};\n    /**\r\n     * Holdes Interaction objects for various Popup's elements.\r\n     */\n\n    _this._IOs = {};\n    /**\r\n     * Contents of popup window.\r\n     */\n\n    _this._content = \"\";\n    /**\r\n     * Title of the popup window.\r\n     */\n\n    _this._title = \"\";\n    /**\r\n     * Prefix to apply to class names for popup elements.\r\n     */\n\n    _this._classPrefix = \"ampopup\";\n    /**\r\n     * If set to `true` [[Popup]] will use default styles.\r\n     */\n\n    _this._defaultStyles = true;\n    /**\r\n     * If set to `true` [[Popup]] will dim out all chart content behind it by\r\n     * showing a semi-transparent fill. (curtain)\r\n     */\n\n    _this._showCurtain = false;\n    /**\r\n     * Indicates whether popup can be dragged.\r\n     */\n\n    _this._draggable = true;\n    /**\r\n     * Horizontal position of the content window.\r\n     */\n\n    _this._align = \"center\";\n    /**\r\n     * Resize popup as images are being loaded.\r\n     */\n\n    _this._dynamicResize = true;\n    /**\r\n     * Vertical position of the content window.\r\n     */\n\n    _this._verticalAlign = \"middle\";\n    /**\r\n     * Shift in position of the element. (used for dragging)\r\n     */\n\n    _this._shift = {\n      x: 0,\n      y: 0\n    };\n    /**\r\n     * Temporary shift in position of the element. (used for dragging)\r\n     */\n\n    _this._tempShift = {\n      x: 0,\n      y: 0\n    };\n    /**\r\n     * A title for screen readers. It is very highly recommended to set that title\r\n     * so that people using screen reader tools can get an immediate summary of\r\n     * the information in the popup.\r\n     */\n\n    _this._readerTitle = \"\";\n    /**\r\n     * Is popup closable?\r\n     */\n\n    _this._closable = true;\n    /**\r\n     * Was CSS already loaded?\r\n     */\n\n    _this._cssLoaded = false;\n    /**\r\n     * If set to other than \"none\" will try to re-adjust the position of the\r\n     * popop to fit within chart container or browser window.\r\n     *\r\n     * @ignore Feature not yet implemented\r\n     * @todo Implement\r\n     */\n\n    _this._fitTo = \"window\";\n    /**\r\n     * Identifies if this object is a \"template\" and should not be treated as\r\n     * real object that is drawn or actually used in the chart.\r\n     *\r\n     * @ignore Exclude from docs\r\n     */\n\n    _this.isTemplate = false;\n    /**\r\n     * Indicates if the element was already sized and should not be measured for\r\n     * size again, saving some precious resources.\r\n     */\n\n    _this._sized = false;\n    _this.className = \"Popup\";\n    return _this;\n  }\n  /**\r\n   * Shows popup window.\r\n   */\n\n\n  Popup.prototype.open = function () {\n    if (this.container) {\n      if (this._elements.wrapper) {\n        this.container.appendChild(this._elements.wrapper);\n      }\n\n      if (this._elements.curtain) {\n        this.container.appendChild(this._elements.curtain);\n        this.showCurtain = this.showCurtain;\n      }\n\n      this.positionElement();\n      this.dispatchImmediately(\"opened\");\n    }\n  };\n  /**\r\n   * Hides popup window.\r\n   */\n\n\n  Popup.prototype.close = function () {\n    if (this._elements.wrapper) {\n      if (this._elements.wrapper.parentElement) {\n        this._elements.wrapper.parentElement.removeChild(this._elements.wrapper);\n      }\n    }\n\n    if (this._elements.curtain) {\n      if (this._elements.curtain.parentElement) {\n        this._elements.curtain.parentElement.removeChild(this._elements.curtain);\n      }\n    }\n\n    this.dispatchImmediately(\"closed\");\n    this.releasePointers();\n  };\n  /**\r\n   * Destroy (dispose) popup.\r\n   */\n\n\n  Popup.prototype.dispose = function () {\n    this.close();\n\n    _super.prototype.dispose.call(this);\n  };\n  /**\r\n   * Positions content element in the center of popup based on its actual size.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Popup.prototype.positionElement = function (forceResize) {\n    var _this = this;\n\n    if (forceResize === void 0) {\n      forceResize = true;\n    }\n\n    if (!this._elements.wrapper) {\n      return;\n    }\n\n    setTimeout(function () {\n      if (!_this._elements.wrapper) {\n        return;\n      }\n\n      if (forceResize || !_this._sized) {\n        _this._elements.wrapper.style.opacity = \"0.01\";\n        _this._elements.wrapper.style.left = \"0\";\n        _this._elements.wrapper.style.top = \"0\";\n        _this._elements.wrapper.style.margin = \"0 0 0 0\";\n        _this._elements.wrapper.style.width = \"\";\n        _this._elements.wrapper.style.height = \"\";\n\n        var bbox = _this._elements.wrapper.getBoundingClientRect();\n\n        _this._elements.wrapper.style.width = bbox.width + \"px\";\n        _this._elements.wrapper.style.height = bbox.height + \"px\";\n        _this._sized = true;\n      } // Check for any images that are not yet loaded\n\n\n      if (_this.dynamicResize) {\n        var images = _this._elements.wrapper.getElementsByTagName(\"img\");\n\n        for (var i = 0; i < images.length; i++) {\n          var image = images[i];\n\n          if (!image.complete) {\n            // Resize popup once again when image is loaded\n            image.addEventListener(\"load\", function () {\n              _this.positionElement(true);\n            }); // Do this for one image only as it will be checked again next time\n            // anyway\n\n            break;\n          }\n        }\n      }\n\n      setTimeout(function () {\n        if (!_this._elements.wrapper) {\n          return;\n        }\n\n        var bbox;\n\n        if ((forceResize || !_this._sized) && _this._bbox) {\n          bbox = _this._bbox;\n        } else {\n          bbox = _this._elements.wrapper.getBoundingClientRect();\n          _this._elements.wrapper.style.opacity = \"\";\n        } // Set horizontal positioning\n\n\n        switch (_this.align) {\n          case \"left\":\n            _this._elements.wrapper.style.left = \"0\";\n            _this._elements.wrapper.style.right = \"auto\";\n            _this._elements.wrapper.style.marginLeft = _this.toStyle(_this._shift.x + _this._tempShift.x);\n            break;\n\n          case \"center\":\n            _this._elements.wrapper.style.left = \"50%\";\n            _this._elements.wrapper.style.right = \"auto\";\n            _this._elements.wrapper.style.marginLeft = _this.toStyle(Math.round(-bbox.width / 2) + (_this._shift.x + _this._tempShift.x));\n            break;\n\n          case \"right\":\n            _this._elements.wrapper.style.left = \"auto\";\n            _this._elements.wrapper.style.right = \"0\";\n            _this._elements.wrapper.style.marginLeft = _this.toStyle(_this._shift.x + _this._tempShift.x);\n            break;\n\n          default:\n            _this._elements.wrapper.style.left = _this.toStyle(_this.left) || \"auto\";\n            _this._elements.wrapper.style.right = _this.toStyle(_this.right) || \"auto\";\n            _this._elements.wrapper.style.marginLeft = _this.toStyle(_this._shift.x + _this._tempShift.x);\n            break;\n        } // Set vertical positioning\n\n\n        switch (_this.verticalAlign) {\n          case \"top\":\n            _this._elements.wrapper.style.top = \"0\";\n            _this._elements.wrapper.style.bottom = \"auto\";\n            _this._elements.wrapper.style.marginTop = _this.toStyle(_this._shift.y + _this._tempShift.y);\n            break;\n\n          case \"middle\":\n            _this._elements.wrapper.style.top = \"50%\";\n            _this._elements.wrapper.style.bottom = \"auto\";\n            _this._elements.wrapper.style.marginTop = _this.toStyle(Math.round(-bbox.height / 2) + (_this._shift.y + _this._tempShift.y));\n            break;\n\n          case \"bottom\":\n            _this._elements.wrapper.style.top = \"auto\";\n            _this._elements.wrapper.style.bottom = \"0\";\n            _this._elements.wrapper.style.marginTop = _this.toStyle(_this._shift.y + _this._tempShift.y);\n            break;\n\n          default:\n            _this._elements.wrapper.style.top = _this.toStyle(_this.top) || \"auto\";\n            _this._elements.wrapper.style.bottom = _this.toStyle(_this.bottom) || \"auto\";\n            _this._elements.wrapper.style.marginTop = _this.toStyle(_this._shift.y + _this._tempShift.y);\n            break;\n        }\n      }, 1);\n    }, 1);\n  };\n\n  Popup.prototype.setupDragging = function () {\n    var _this = this;\n\n    if (this.draggable) {\n      if (!this._IOs.header.events.has(\"drag\")) {\n        this._IOs.header.events.on(\"drag\", function (ev) {\n          _this._tempShift.x = ev.shift.x;\n          _this._tempShift.y = ev.shift.y;\n\n          _this.positionElement(false);\n        });\n      }\n\n      if (!this._IOs.header.events.has(\"dragstop\")) {\n        this._IOs.header.events.on(\"dragstop\", function (ev) {\n          _this._shift.x += _this._tempShift.x;\n          _this._shift.y += _this._tempShift.y;\n          _this._tempShift.x = 0;\n          _this._tempShift.y = 0;\n\n          _this.positionElement(false);\n        });\n      }\n    } else {\n      if (this._IOs.header) {\n        getInteraction().unprepElement(this._IOs.header);\n\n        if (this._IOs.header.events.has(\"drag\")) {\n          this._IOs.header.events.off(\"drag\");\n        }\n\n        if (this._IOs.header.events.has(\"dragstop\")) {\n          this._IOs.header.events.off(\"dragstop\");\n        }\n      }\n    }\n  };\n\n  Popup.prototype.toStyle = function (value) {\n    if (!$type.hasValue(value)) {\n      return null;\n    } else if ($type.isNumber(value)) {\n      return \"\" + value + \"px\";\n    } else {\n      return value.toString();\n    }\n  };\n\n  Object.defineProperty(Popup.prototype, \"classPrefix\", {\n    /**\r\n     * A prefix that is applied to class names of various popup elements.\r\n     *\r\n     * @return Class name prefix\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"classPrefix\", this._classPrefix);\n    },\n\n    /**\r\n     * @param value Class name prefix\r\n     */\n    set: function set(value) {\n      this._classPrefix = value;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"classPrefixRaw\", {\n    /**\r\n     * Returns raw prefix (without adapters applied).\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @return Class name prefix\r\n     */\n    get: function get() {\n      return this._classPrefix;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"content\", {\n    /**\r\n     * @return Popup content\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"content\", this._content);\n    },\n\n    /**\r\n     * Popup content.\r\n     *\r\n     * Popup content can be any valid HTML, including CSS.\r\n     *\r\n     * @param value Popup content\r\n     */\n    set: function set(value) {\n      if (this._content != value) {\n        this._content = value;\n\n        if (!this._elements.content) {\n          this.createContentElement();\n        }\n\n        this._elements.content.innerHTML = value;\n        this.positionElement();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Popup.prototype.getClassNames = function () {\n    return this.adapter.apply(\"classNames\", {\n      wrapperClass: this.classPrefix + \"\",\n      headerClass: this.classPrefix + \"-header\",\n      titleClass: this.classPrefix + \"-title\",\n      contentClass: this.classPrefix + \"-content\",\n      insideClass: this.classPrefix + \"-inside\",\n      curtainClass: this.classPrefix + \"-curtain\",\n      closeClass: this.classPrefix + \"-close\"\n    });\n  };\n  /**\r\n   * Creates content element.\r\n   */\n\n\n  Popup.prototype.createContentElement = function () {\n    // Check if it's created already\n    if (this._elements.wrapper) {\n      return;\n    } // Get class names for popup elements\n\n\n    var classNames = this.getClassNames(); // Create content element\n\n    var wrapper = document.createElement(\"div\");\n    wrapper.className = classNames.contentClass;\n    wrapper.style.opacity = \"0.01\"; // Create close button\n\n    var close = document.createElement(\"a\");\n    close.className = classNames.closeClass; // header title\n\n    var header = document.createElement(\"div\");\n    header.className = classNames.headerClass; // Content title\n\n    var title = document.createElement(\"div\");\n    title.innerHTML = this.title;\n    title.className = classNames.titleClass;\n\n    if (!this.title) {\n      title.style.display = \"none\";\n    } // Content div\n\n\n    var content = document.createElement(\"div\");\n    content.className = classNames.insideClass;\n    content.innerHTML = this.content; // Set up events for content\n\n    this._IOs.wrapper = getInteraction().getInteraction(wrapper);\n    this._IOs.header = getInteraction().getInteraction(header);\n\n    this._disposers.push(this._IOs.wrapper); // Set hover/out events\n\n\n    this._IOs.wrapper.events.on(\"over\", this.disablePointers, this);\n\n    this._IOs.wrapper.events.on(\"out\", this.releasePointers, this); // Create an InteractionObject for close\n\n\n    this._IOs.close = getInteraction().getInteraction(close);\n\n    this._disposers.push(this._IOs.close); // Hide close for now\n\n\n    close.style.visibility = \"hidden\"; // Add accessible stuff\n\n    wrapper.setAttribute(\"role\", \"dialog\"); // Add to wrapper\n\n    header.appendChild(close);\n    header.appendChild(title);\n    wrapper.appendChild(header);\n    wrapper.appendChild(content);\n    this.container.appendChild(wrapper); // Save for later access\n\n    this._elements.wrapper = wrapper;\n    this._elements.header = header;\n    this._elements.content = content;\n    this._elements.title = title;\n    this._elements.close = close; // Load CSS\n\n    if (this.defaultStyles) {\n      this.loadDefaultCSS();\n    } // Create curtain as well\n\n\n    this.createCurtainElement(); // Apply events\n\n    this.applyEvents();\n    this.applyReaderSettings(); // Draggable?\n\n    this.setupDragging();\n  };\n\n  Object.defineProperty(Popup.prototype, \"title\", {\n    /**\r\n     * @return Popup title\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"title\", this._title);\n    },\n\n    /**\r\n     * Popup title.\r\n     *\r\n     * Popup title can be any valid HTML, including CSS.\r\n     *\r\n     * @param value  Popup title\r\n     */\n    set: function set(value) {\n      if (this._title != value) {\n        this._title = value;\n\n        if (!this._elements.content) {\n          this.createContentElement();\n        }\n\n        this._elements.title.innerHTML = value;\n        this.positionElement();\n        this.applyReaderSettings();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"readerTitle\", {\n    /**\r\n     * @return Popup content\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"readerTitle\", this._readerTitle != \"\" ? this._readerTitle : this.title);\n    },\n\n    /**\r\n     * A title for screen readers. It is very highly recommended to set that title\r\n     * so that people using screen reader tools can get an immediate summary of\r\n     * the information in the popup.\r\n     *\r\n     * @param value  Reader title\r\n     */\n    set: function set(value) {\n      if (this._readerTitle != value) {\n        this._readerTitle = value;\n        this.applyReaderSettings();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"closable\", {\n    /**\r\n     * @return Closable?\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"closable\", this._closable);\n    },\n\n    /**\r\n     * Is popup closable?\r\n     *\r\n     * If it is, it can be closed in a number of ways, e.g. by hitting ESC key,\r\n     * clicking curtain, or clicking the close button.\r\n     *\r\n     * If it is not closable, the only way to close it is via `close()` call.\r\n     *\r\n     * @param value Closable?\r\n     */\n    set: function set(value) {\n      if (value !== this._closable) {\n        this._closable = value;\n        this.applyEvents();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"fitTo\", {\n    /**\r\n     * @ignore\r\n     * @todo Implement\r\n     * @return Fit option\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"fitTo\", this._fitTo);\n    },\n\n    /**\r\n     * If set to other than \"none\" will try to re-adjust the position of the\r\n     * popop to fit within chart container or browser window.\r\n     *\r\n     * @ignore\r\n     * @todo Implement\r\n     * @default \"window\"\r\n     * @param value  Fit option\r\n     */\n    set: function set(value) {\n      if (value != this._fitTo) {\n        this._fitTo = value;\n        this.positionElement();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"defaultStyles\", {\n    /**\r\n     * @return Use default CSS?\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"defaultStyles\", this._defaultStyles);\n    },\n\n    /**\r\n     * Should popup use default CSS?\r\n     *\r\n     * If default CSS is disabled, an external CSS should handle the look of the\r\n     * popup, since it will look quite out of place otherwise.\r\n     *\r\n     * @default true\r\n     * @param Use default CSS?\r\n     */\n    set: function set(value) {\n      if (this._defaultStyles != value) {\n        this._defaultStyles = value;\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"showCurtain\", {\n    /**\r\n     * @return Show curtain?\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"showCurtain\", this._showCurtain);\n    },\n\n    /**\r\n     * Should popup use dim out all content behind it?\r\n     *\r\n     * @default false\r\n     * @param Show curtain?\r\n     */\n    set: function set(value) {\n      if (this._showCurtain != value) {\n        this._showCurtain = value;\n\n        if (this._elements.curtain) {\n          this._elements.curtain.style.display = value ? \"block\" : \"none\";\n        }\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Creates curtain element.\r\n   */\n\n  Popup.prototype.createCurtainElement = function () {\n    // Get class names for popup elements\n    var classNames = this.getClassNames(); // Create the curtain\n\n    var curtain = document.createElement(\"div\");\n    curtain.className = classNames.curtainClass; // Append curtain to wrapper\n\n    this.container.appendChild(curtain); // Create an InteractionObject for curtain because we might need to\n    // set interactions on it\n\n    this._IOs.curtain = getInteraction().getInteraction(curtain); // Add Curtain IO to disposers\n\n    this._disposers.push(this._IOs.curtain); // Set events to disable underlying interactivity\n\n\n    this._IOs.curtain.events.on(\"over\", this.disablePointers, this);\n\n    this._IOs.curtain.events.on(\"out\", this.releasePointers, this); // Hide it?\n\n\n    curtain.style.display = this.showCurtain ? \"block\" : \"none\"; // Save for later\n\n    this._elements.curtain = curtain;\n  };\n\n  Object.defineProperty(Popup.prototype, \"draggable\", {\n    /**\r\n     * @return Show curtain?\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"draggable\", this._draggable);\n    },\n\n    /**\r\n     * Can the popup be dragged with a pointer?\r\n     *\r\n     * @default false\r\n     * @param Show curtain?\r\n     */\n    set: function set(value) {\n      if (this._draggable != value) {\n        this._draggable = value;\n        this.setupDragging();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"dynamicResize\", {\n    /**\r\n     * @return Resize dynamically?\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"dynamicResize\", this._dynamicResize);\n    },\n\n    /**\r\n     * Resize popup as images are being loaded.\r\n     *\r\n     * @default true\r\n     * @since 4.9.17\r\n     * @param Resize dynamically?\r\n     */\n    set: function set(value) {\n      if (this._dynamicResize != value) {\n        this._dynamicResize = value;\n        this.positionElement(true);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"align\", {\n    /**\r\n     * @return Horizontal position\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"align\", this._align);\n    },\n\n    /**\r\n     * Horizontal positioning of the content window.\r\n     *\r\n     * Available options: \"left\", \"center\" (default), \"right\", and \"none\".\r\n     *\r\n     * @default \"center\"\r\n     * @param Horizontal position\r\n     */\n    set: function set(value) {\n      if (this._align != value) {\n        this._align = value;\n        this.positionElement();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"verticalAlign\", {\n    /**\r\n     * @return Vertical position\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"verticalAlign\", this._verticalAlign);\n    },\n\n    /**\r\n     * Vertical positioning of the content window.\r\n     *\r\n     * Available options: \"top\", \"middle\" (default), \"bottom\", and \"none\".\r\n     *\r\n     * @default \"middle\"\r\n     * @param Vertical position\r\n     */\n    set: function set(value) {\n      if (this._verticalAlign != value) {\n        this._verticalAlign = value;\n        this.positionElement();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"left\", {\n    /**\r\n     * @return Left\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"left\", this._left);\n    },\n\n    /**\r\n     * \"left\" coordinate of a non-aligned (`align = \"none\"`) popup.\r\n     *\r\n     * Can be either absolute pixel value, or relative (`Percent`).\r\n     *\r\n     * Setting this property will automatically set `align` to \"none\".\r\n     *\r\n     * NOTE: The position is relative to the chart container.\r\n     *\r\n     * @param Left\r\n     */\n    set: function set(value) {\n      if (this.left != value) {\n        this._left = value;\n        this._align = \"none\";\n        this.positionElement();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"right\", {\n    /**\r\n     * @return Right\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"right\", this._right);\n    },\n\n    /**\r\n     * \"right\" coordinate of a non-aligned (`align = \"none\"`) popup.\r\n     *\r\n     * Can be either absolute pixel value, or relative (`Percent`).\r\n     *\r\n     * Setting this property will automatically set `align` to \"none\".\r\n     *\r\n     * NOTE: The position is relative to the chart container.\r\n     *\r\n     * @param Right\r\n     */\n    set: function set(value) {\n      if (this.right != value) {\n        this._right = value;\n        this._align = \"none\";\n        this.positionElement();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"top\", {\n    /**\r\n     * @return Top\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"top\", this._top);\n    },\n\n    /**\r\n     * \"top\" coordinate of a non-aligned (`verticalAlign = \"none\"`) popup.\r\n     *\r\n     * Can be either absolute pixel value, or relative (`Percent`).\r\n     *\r\n     * Setting this property will automatically set `verticalAlign` to \"none\".\r\n     *\r\n     * NOTE: The position is relative to the chart container.\r\n     *\r\n     * @param Top\r\n     */\n    set: function set(value) {\n      if (this.top != value) {\n        this._top = value;\n        this._verticalAlign = \"none\";\n        this.positionElement();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"bottom\", {\n    /**\r\n     * @return Bottom\r\n     */\n    get: function get() {\n      return this.adapter.apply(\"bottom\", this._bottom);\n    },\n\n    /**\r\n     * \"bottom\" coordinate of a non-aligned (`verticalAlign = \"none\"`) popup.\r\n     *\r\n     * Can be either absolute pixel value, or relative (`Percent`).\r\n     *\r\n     * Setting this property will automatically set `verticalAlign` to \"none\".\r\n     *\r\n     * NOTE: The position is relative to the chart container.\r\n     *\r\n     * @param Bottom\r\n     */\n    set: function set(value) {\n      if (this.bottom != value) {\n        this._bottom = value;\n        this._verticalAlign = \"none\";\n        this.positionElement();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Popup.prototype, \"elements\", {\n    /**\r\n     * Returns an object with references to various elements of the Popup.\r\n     *\r\n     * * `wrapper`\r\n     * * `title`\r\n     * * `content`\r\n     * * `close`\r\n     * * `curtain`\r\n     */\n    get: function get() {\n      return this._elements;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Loads popup CSS.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n  Popup.prototype.loadDefaultCSS = function () {\n    if (!this._cssLoaded) {\n      this._disposers.push(popupCSS(getShadowRoot(this.container), this.classPrefix));\n\n      $object.each(this._elements, function (key, el) {\n        el.style.display = \"\";\n      });\n      this._cssLoaded = true;\n    }\n  };\n  /**\r\n   * If popup is closable, this method adds various events to popup elements.\r\n   */\n\n\n  Popup.prototype.applyEvents = function () {\n    var _this = this;\n\n    if (this._IOs.close) {\n      if (this.closable) {\n        this._IOs.close.element.style.visibility = \"visible\";\n        var disposers = [getInteraction().body.events.on(\"keyup\", function (ev) {\n          if (keyboard.isKey(ev.event, \"esc\") && _this.closable) {\n            _this.close();\n          }\n        }), this._IOs.close.events.on(\"hit\", function (ev) {\n          _this.close();\n        })];\n        disposers.push(this._IOs.curtain.events.on(\"hit\", function (ev) {\n          if (_this.showCurtain && _this.closable) {\n            _this.close();\n          }\n        }));\n\n        this._disposers.push(new MultiDisposer(disposers));\n      } else {\n        this._IOs.close.element.style.visibility = \"hidden\";\n      }\n    }\n  };\n  /**\r\n   * Disables interactivity on parent chart.\r\n   */\n\n\n  Popup.prototype.disablePointers = function () {\n    if (this.sprite) {\n      this._spriteInteractionsEnabled = this.sprite.interactionsEnabled;\n      this.sprite.interactionsEnabled = false;\n    }\n  };\n  /**\r\n   * Releases temporarily disabled pointers on parent chart.\r\n   */\n\n\n  Popup.prototype.releasePointers = function () {\n    if ($type.hasValue(this._spriteInteractionsEnabled)) {\n      this.sprite.interactionsEnabled = this._spriteInteractionsEnabled;\n      this._spriteInteractionsEnabled = undefined;\n    }\n  };\n  /**\r\n   * Sets screen reader related settings.\r\n   */\n\n\n  Popup.prototype.applyReaderSettings = function () {\n    this.elements.wrapper.setAttribute(\"aria-label\", this.readerTitle);\n  };\n  /**\r\n   * Copies all properties and related data from different element.\r\n   *\r\n   * @param object Source element\r\n   */\n\n\n  Popup.prototype.copyFrom = function (source) {\n    _super.prototype.copyFrom.call(this, source);\n\n    this.container = source.container;\n    this.sprite = source.sprite;\n    this.classPrefix = source.classPrefixRaw;\n    this.content = source.content;\n    this.title = source.title;\n    this.readerTitle = source.readerTitle;\n    this.defaultStyles = source.defaultStyles;\n    this.showCurtain = source.showCurtain;\n    this.align = source.align;\n    this.verticalAlign = source.verticalAlign;\n    this.left = source.left;\n    this.right = source.right;\n    this.top = source.top;\n    this.bottom = source.bottom;\n    this.adapter.copyFrom(source.adapter);\n  };\n\n  return Popup;\n}(BaseObjectEvents);\n\nexport { Popup };","map":{"version":3,"mappings":"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","names":["popupCSS","Adapter","BaseObjectEvents","getInteraction","keyboard","MultiDisposer","getShadowRoot","$type","$object","__extends","_super","_this","x","y","className","Popup","container","_elements","wrapper","appendChild","curtain","showCurtain","positionElement","dispatchImmediately","parentElement","removeChild","releasePointers","close","dispose","call","forceResize","setTimeout","_sized","style","opacity","left","top","margin","width","height","bbox","getBoundingClientRect","dynamicResize","images","getElementsByTagName","i","length","image","complete","addEventListener","_bbox","align","right","marginLeft","toStyle","_shift","_tempShift","Math","round","verticalAlign","bottom","marginTop","draggable","_IOs","header","events","has","on","ev","shift","unprepElement","off","value","hasValue","isNumber","toString","Object","adapter","apply","_classPrefix","_content","content","createContentElement","innerHTML","wrapperClass","classPrefix","headerClass","titleClass","contentClass","insideClass","curtainClass","closeClass","classNames","getClassNames","document","createElement","title","display","_disposers","push","disablePointers","visibility","setAttribute","defaultStyles","loadDefaultCSS","createCurtainElement","applyEvents","applyReaderSettings","setupDragging","_title","_readerTitle","_closable","_fitTo","_defaultStyles","_showCurtain","_draggable","_dynamicResize","_align","_verticalAlign","_left","_right","_top","_bottom","_cssLoaded","each","key","el","closable","element","disposers","body","isKey","event","sprite","_spriteInteractionsEnabled","interactionsEnabled","undefined","elements","readerTitle","source","copyFrom","classPrefixRaw"],"sourceRoot":"","sources":["../../../../../src/.internal/core/elements/Popup.ts"],"sourcesContent":["/**\r\n * Popup class is used to display information over chart area.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport popupCSS from \"./PopupCSS\";\r\nimport { Adapter } from \"../utils/Adapter\";\r\nimport { BaseObjectEvents } from \"../Base\";\r\nimport { Sprite } from \"../Sprite\";\r\nimport { getInteraction } from \"../interaction/Interaction\";\r\nimport { InteractionObject } from \"../interaction/InteractionObject\";\r\nimport { keyboard } from \"../utils/Keyboard\";\r\nimport { Percent } from \"../utils/Percent\";\r\nimport { MultiDisposer } from \"../utils/Disposer\";\r\nimport { Align } from \"../defs/Align\";\r\nimport { VerticalAlign } from \"../defs/VerticalAlign\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { Optional } from \"../utils/Type\";\r\nimport { getShadowRoot } from \"../utils/DOM\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $object from \"../utils/Object\";\r\n\r\n/**\r\n * Represents a list of available adapters for Export.\r\n */\r\nexport interface IPopupAdapters {\r\n\r\n\t/**\r\n\t * Applied to the class prefixes.\r\n\t */\r\n\tclassPrefix: string,\r\n\r\n\t/**\r\n\t * Applied to popup content before it is shown.\r\n\t */\r\n\tcontent: string,\r\n\r\n\t/**\r\n\t * Applied to popup title before it is shown.\r\n\t */\r\n\ttitle: string,\r\n\r\n\t/**\r\n\t * Applied to the screen reader title.\r\n\t */\r\n\treaderTitle: string,\r\n\r\n\t/**\r\n\t * Applied to default `defaultStyles` property before it is retrieved.\r\n\t */\r\n\tdefaultStyles: boolean,\r\n\r\n\t/**\r\n\t * Applied to default `showCurtain` property before it is retrieved.\r\n\t */\r\n\tshowCurtain: boolean,\r\n\r\n\t/**\r\n\t * Applied to default `draggable` property before it is retrieved.\r\n\t */\r\n\tdraggable: boolean,\r\n\r\n\t/**\r\n\t * Applied to `closable` property before it is retrieved.\r\n\t */\r\n\tclosable: boolean,\r\n\r\n\t/**\r\n\t * Applied to `dynamicResize` property before it is retrieved.\r\n\t */\r\n\tdynamicResize: boolean,\r\n\r\n\t/**\r\n\t * Applied to `fitTo` property before it's retrieved.\r\n\t *\r\n\t * @ignore Feature not yet implemented\r\n\t */\r\n\tfitTo: \"none\" | \"container\" | \"window\",\r\n\r\n\t/**\r\n\t * Applied to horizontal alignment of the popup.\r\n\t */\r\n\talign: Optional<Align>;\r\n\r\n\t/**\r\n\t * Applied to vertical alignment of the popup.\r\n\t */\r\n\tverticalAlign: Optional<VerticalAlign>;\r\n\r\n\t/**\r\n\t * Applied to `left` position value.\r\n\t */\r\n\tleft: number | Percent;\r\n\r\n\t/**\r\n\t * Applied to `right` position value.\r\n\t */\r\n\tright: number | Percent;\r\n\r\n\t/**\r\n\t * Applied to `top` position value.\r\n\t */\r\n\ttop: number | Percent;\r\n\r\n\t/**\r\n\t * Applied to `bottom` position value.\r\n\t */\r\n\tbottom: number | Percent;\r\n\r\n\t/**\r\n\t * Applied to class names list that are added as class for various popup\r\n\t * elements.\r\n\t */\r\n\tclassNames: {\r\n\t\twrapperClass: string,\r\n\t\ttitleClass: string,\r\n\t\theaderClass: string,\r\n\t\tcontentClass: string,\r\n\t\tinsideClass: string,\r\n\t\tcurtainClass: string,\r\n\t\tcloseClass: string\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Defines events for Popup.\r\n */\r\nexport interface IPopupEvents {\r\n\r\n\t/**\r\n\t * Invoked when Popup is opened.\r\n\t */\r\n\topened: {};\r\n\r\n\t/**\r\n\t * Invoked when Popup is closed.\r\n\t */\r\n\tclosed: {};\r\n\r\n}\r\n\r\n/**\r\n * Shows an HTML popup which covers window or a chart area.\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v4/concepts/popups-and-modals/} For examples and docs on Popups and Modals.\r\n * @todo Positioning over whole window\r\n */\r\nexport class Popup extends BaseObjectEvents {\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IPopupEvents;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IPopupAdapters;\r\n\r\n\t/**\r\n\t * Adapter.\r\n\t */\r\n\tpublic adapter: Adapter<Popup, IPopupAdapters> = new Adapter<Popup, IPopupAdapters>(this);\r\n\r\n\t/**\r\n\t * A reference to an HTML element to be used for container. If not set, popup\r\n\t * will cover the whole window.\r\n\t */\r\n\tpublic container: $type.Optional<HTMLElement | Document>;\r\n\r\n\t/**\r\n\t * A parent element this Popup belongs to.\r\n\t */\r\n\tpublic sprite: $type.Optional<Sprite>;\r\n\r\n\t/**\r\n\t * Holds references to various HTML elements, Popup consists of.\r\n\t */\r\n\tprotected _elements: {\r\n\t\twrapper?: HTMLElement;\r\n\t\ttitle?: HTMLElement;\r\n\t\theader?: HTMLElement;\r\n\t\tcontent?: HTMLElement;\r\n\t\tclose?: HTMLElement;\r\n\t\tcurtain?: HTMLElement;\r\n\t} = {};\r\n\r\n\t/**\r\n\t * Holdes Interaction objects for various Popup's elements.\r\n\t */\r\n\tprotected _IOs: {\r\n\t\twrapper?: InteractionObject;\r\n\t\tcontent?: InteractionObject;\r\n\t\theader?: InteractionObject;\r\n\t\tclose?: InteractionObject;\r\n\t\tcurtain?: InteractionObject;\r\n\t} = {};\r\n\r\n\t/**\r\n\t * Contents of popup window.\r\n\t */\r\n\tprotected _content: string = \"\";\r\n\r\n\t/**\r\n\t * Title of the popup window.\r\n\t */\r\n\tprotected _title: string = \"\";\r\n\r\n\t/**\r\n\t * Prefix to apply to class names for popup elements.\r\n\t */\r\n\tprotected _classPrefix: string = \"ampopup\"\r\n\r\n\t/**\r\n\t * If set to `true` [[Popup]] will use default styles.\r\n\t */\r\n\tprotected _defaultStyles: boolean = true;\r\n\r\n\t/**\r\n\t * If set to `true` [[Popup]] will dim out all chart content behind it by\r\n\t * showing a semi-transparent fill. (curtain)\r\n\t */\r\n\tprotected _showCurtain: boolean = false;\r\n\r\n\t/**\r\n\t * Indicates whether popup can be dragged.\r\n\t */\r\n\tprotected _draggable: boolean = true;\r\n\r\n\t/**\r\n\t * Horizontal position of the content window.\r\n\t */\r\n\tprotected _align: Optional<Align> = \"center\";\r\n\r\n\t/**\r\n\t * Resize popup as images are being loaded.\r\n\t */\r\n\tprotected _dynamicResize: boolean = true;\r\n\r\n\t/**\r\n\t * Vertical position of the content window.\r\n\t */\r\n\tprotected _verticalAlign: Optional<VerticalAlign> = \"middle\";\r\n\r\n\t/**\r\n\t * Shift in position of the element. (used for dragging)\r\n\t */\r\n\tprotected _shift: IPoint = {\r\n\t\tx: 0,\r\n\t\ty: 0\r\n\t};\r\n\r\n\t/**\r\n\t * Temporary shift in position of the element. (used for dragging)\r\n\t */\r\n\tprotected _tempShift: IPoint = {\r\n\t\tx: 0,\r\n\t\ty: 0\r\n\t};\r\n\r\n\t/**\r\n\t * \"left\" position of the popup content.\r\n\t */\r\n\tprotected _left: number | Percent;\r\n\r\n\t/**\r\n\t * \"right\" position of the popup content.\r\n\t */\r\n\tprotected _right: number | Percent;\r\n\r\n\t/**\r\n\t * \"top\" position of the popup content.\r\n\t */\r\n\tprotected _top: number | Percent;\r\n\r\n\t/**\r\n\t * \"bottom\" position of the popup content.\r\n\t */\r\n\tprotected _bottom: number | Percent;\r\n\r\n\t/**\r\n\t * A title for screen readers. It is very highly recommended to set that title\r\n\t * so that people using screen reader tools can get an immediate summary of\r\n\t * the information in the popup.\r\n\t */\r\n\tpublic _readerTitle: string = \"\";\r\n\r\n\t/**\r\n\t * Is popup closable?\r\n\t */\r\n\tprivate _closable: boolean = true;\r\n\r\n\t/**\r\n\t * Was CSS already loaded?\r\n\t */\r\n\tprivate _cssLoaded: boolean = false;\r\n\r\n\t/**\r\n\t * If set to other than \"none\" will try to re-adjust the position of the\r\n\t * popop to fit within chart container or browser window.\r\n\t *\r\n\t * @ignore Feature not yet implemented\r\n\t * @todo Implement\r\n\t */\r\n\tprivate _fitTo: \"none\" | \"container\" | \"window\" = \"window\";\r\n\r\n\t/**\r\n\t * Used to log original value of `interactionsEnabled` so that it can be restored\r\n\t * after temporarily disabling it.\r\n\t */\r\n\tprivate _spriteInteractionsEnabled: $type.Optional<boolean>;\r\n\r\n\t/**\r\n\t * Identifies if this object is a \"template\" and should not be treated as\r\n\t * real object that is drawn or actually used in the chart.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic isTemplate: boolean = false;\r\n\r\n\t/**\r\n\t * Indicates if the element was already sized and should not be measured for\r\n\t * size again, saving some precious resources.\r\n\t */\r\n\tprivate _sized: boolean = false;\r\n\r\n\t/**\r\n\t * Cached bounding rectangle info.\r\n\t */\r\n\tprivate _bbox: $type.Optional<DOMRect | ClientRect>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"Popup\";\r\n\t}\r\n\r\n\t/**\r\n\t * Shows popup window.\r\n\t */\r\n\tpublic open(): void {\r\n\t\tif (this.container) {\r\n\t\t\tif (this._elements.wrapper) {\r\n\t\t\t\tthis.container.appendChild(this._elements.wrapper);\r\n\t\t\t}\r\n\t\t\tif (this._elements.curtain) {\r\n\t\t\t\tthis.container.appendChild(this._elements.curtain);\r\n\t\t\t\tthis.showCurtain = this.showCurtain;\r\n\t\t\t}\r\n\t\t\tthis.positionElement();\r\n\t\t\tthis.dispatchImmediately(\"opened\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides popup window.\r\n\t */\r\n\tpublic close(): void {\r\n\t\tif (this._elements.wrapper) {\r\n\t\t\tif (this._elements.wrapper.parentElement) {\r\n\t\t\t\tthis._elements.wrapper.parentElement.removeChild(this._elements.wrapper);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._elements.curtain) {\r\n\t\t\tif (this._elements.curtain.parentElement) {\r\n\t\t\t\tthis._elements.curtain.parentElement.removeChild(this._elements.curtain);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.dispatchImmediately(\"closed\");\r\n\t\tthis.releasePointers();\r\n\t}\r\n\r\n\t/**\r\n\t * Destroy (dispose) popup.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tthis.close();\r\n\t\tsuper.dispose();\r\n\t}\r\n\r\n\t/**\r\n\t * Positions content element in the center of popup based on its actual size.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic positionElement(forceResize: boolean = true): void {\r\n\r\n\t\tif (!this._elements.wrapper) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (!this._elements.wrapper) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (forceResize || !this._sized) {\r\n\t\t\t\tthis._elements.wrapper.style.opacity = \"0.01\";\r\n\t\t\t\tthis._elements.wrapper.style.left = \"0\";\r\n\t\t\t\tthis._elements.wrapper.style.top = \"0\";\r\n\t\t\t\tthis._elements.wrapper.style.margin = \"0 0 0 0\";\r\n\r\n\t\t\t\tthis._elements.wrapper.style.width = \"\";\r\n\t\t\t\tthis._elements.wrapper.style.height = \"\";\r\n\r\n\t\t\t\tlet bbox = this._elements.wrapper.getBoundingClientRect();\r\n\t\t\t\tthis._elements.wrapper.style.width = bbox.width + \"px\";\r\n\t\t\t\tthis._elements.wrapper.style.height = bbox.height + \"px\";\r\n\r\n\t\t\t\tthis._sized = true;\r\n\t\t\t}\r\n\r\n\t\t\t// Check for any images that are not yet loaded\r\n\t\t\tif (this.dynamicResize) {\r\n\t\t\t\tconst images = this._elements.wrapper.getElementsByTagName(\"img\");\r\n\t\t\t\tfor (let i = 0; i < images.length; i++) {\r\n\t\t\t\t\tconst image = images[i];\r\n\t\t\t\t\tif (!image.complete) {\r\n\t\t\t\t\t\t// Resize popup once again when image is loaded\r\n\t\t\t\t\t\timage.addEventListener(\"load\", () => {\r\n\t\t\t\t\t\t\tthis.positionElement(true);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Do this for one image only as it will be checked again next time\r\n\t\t\t\t\t\t// anyway\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tif (!this._elements.wrapper) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet bbox: DOMRect | ClientRect;\r\n\t\t\t\tif ((forceResize || !this._sized) && this._bbox) {\r\n\t\t\t\t\tbbox = this._bbox;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tbbox = this._elements.wrapper.getBoundingClientRect();\r\n\t\t\t\t\tthis._elements.wrapper.style.opacity = \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set horizontal positioning\r\n\t\t\t\tswitch (this.align) {\r\n\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.left = \"0\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.right = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginLeft = this.toStyle(this._shift.x + this._tempShift.x);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"center\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.left = \"50%\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.right = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginLeft = this.toStyle(Math.round(-bbox.width / 2) + (this._shift.x + this._tempShift.x));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"right\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.left = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.right = \"0\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginLeft = this.toStyle(this._shift.x + this._tempShift.x);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthis._elements.wrapper.style.left = this.toStyle(this.left) || \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.right = this.toStyle(this.right) || \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginLeft = this.toStyle(this._shift.x + this._tempShift.x);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set vertical positioning\r\n\t\t\t\tswitch (this.verticalAlign) {\r\n\t\t\t\t\tcase \"top\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.top = \"0\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.bottom = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginTop = this.toStyle(this._shift.y + this._tempShift.y);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"middle\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.top = \"50%\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.bottom = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginTop = this.toStyle(Math.round(-bbox.height / 2) + (this._shift.y + this._tempShift.y));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"bottom\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.top = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.bottom = \"0\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginTop = this.toStyle(this._shift.y + this._tempShift.y);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthis._elements.wrapper.style.top = this.toStyle(this.top) || \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.bottom = this.toStyle(this.bottom) || \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginTop = this.toStyle(this._shift.y + this._tempShift.y);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t}, 1);\r\n\t\t}, 1);\r\n\r\n\t}\r\n\r\n\tprotected setupDragging(): void {\r\n\t\tif (this.draggable) {\r\n\t\t\tif (!this._IOs.header.events.has(\"drag\")) {\r\n\t\t\t\tthis._IOs.header.events.on(\"drag\", (ev) => {\r\n\t\t\t\t\tthis._tempShift.x = ev.shift.x;\r\n\t\t\t\t\tthis._tempShift.y = ev.shift.y;\r\n\t\t\t\t\tthis.positionElement(false);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (!this._IOs.header.events.has(\"dragstop\")) {\r\n\t\t\t\tthis._IOs.header.events.on(\"dragstop\", (ev) => {\r\n\t\t\t\t\tthis._shift.x += this._tempShift.x;\r\n\t\t\t\t\tthis._shift.y += this._tempShift.y;\r\n\t\t\t\t\tthis._tempShift.x = 0;\r\n\t\t\t\t\tthis._tempShift.y = 0;\r\n\t\t\t\t\tthis.positionElement(false);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this._IOs.header) {\r\n\t\t\t\tgetInteraction().unprepElement(this._IOs.header);\r\n\t\t\t\tif (this._IOs.header.events.has(\"drag\")) {\r\n\t\t\t\t\tthis._IOs.header.events.off(\"drag\");\r\n\t\t\t\t}\r\n\t\t\t\tif (this._IOs.header.events.has(\"dragstop\")) {\r\n\t\t\t\t\tthis._IOs.header.events.off(\"dragstop\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toStyle(value: number | Percent): string | null {\r\n\t\tif (!$type.hasValue(value)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\telse if ($type.isNumber(value)) {\r\n\t\t\treturn \"\" + value + \"px\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn value.toString();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A prefix that is applied to class names of various popup elements.\r\n\t *\r\n\t * @return Class name prefix\r\n\t */\r\n\tpublic get classPrefix(): string {\r\n\t\treturn this.adapter.apply(\"classPrefix\", this._classPrefix);\r\n\t}\r\n\r\n\t/**\r\n\t * @param value Class name prefix\r\n\t */\r\n\tpublic set classPrefix(value: string) {\r\n\t\tthis._classPrefix = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns raw prefix (without adapters applied).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Class name prefix\r\n\t */\r\n\tpublic get classPrefixRaw(): string {\r\n\t\treturn this._classPrefix;\r\n\t}\r\n\r\n\t/**\r\n\t * Popup content.\r\n\t *\r\n\t * Popup content can be any valid HTML, including CSS.\r\n\t *\r\n\t * @param value Popup content\r\n\t */\r\n\tpublic set content(value: string) {\r\n\t\tif (this._content != value) {\r\n\t\t\tthis._content = value;\r\n\t\t\tif (!this._elements.content) {\r\n\t\t\t\tthis.createContentElement();\r\n\t\t\t}\r\n\t\t\tthis._elements.content.innerHTML = value;\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Popup content\r\n\t */\r\n\tpublic get content(): string {\r\n\t\treturn this.adapter.apply(\"content\", this._content);\r\n\t}\r\n\r\n\tprotected getClassNames() {\r\n\t\treturn this.adapter.apply(\"classNames\", {\r\n\t\t\twrapperClass: this.classPrefix + \"\",\r\n\t\t\theaderClass: this.classPrefix + \"-header\",\r\n\t\t\ttitleClass: this.classPrefix + \"-title\",\r\n\t\t\tcontentClass: this.classPrefix + \"-content\",\r\n\t\t\tinsideClass: this.classPrefix + \"-inside\",\r\n\t\t\tcurtainClass: this.classPrefix + \"-curtain\",\r\n\t\t\tcloseClass: this.classPrefix + \"-close\"\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Creates content element.\r\n\t */\r\n\tprotected createContentElement(): void {\r\n\r\n\t\t// Check if it's created already\r\n\t\tif (this._elements.wrapper) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Get class names for popup elements\r\n\t\tlet classNames = this.getClassNames();\r\n\r\n\t\t// Create content element\r\n\t\tlet wrapper = document.createElement(\"div\");\r\n\t\twrapper.className = classNames.contentClass;\r\n\t\twrapper.style.opacity = \"0.01\";\r\n\r\n\t\t// Create close button\r\n\t\tlet close = document.createElement(\"a\");\r\n\t\tclose.className = classNames.closeClass;\r\n\r\n\t\t// header title\r\n\t\tconst header = document.createElement(\"div\");\r\n\t\theader.className = classNames.headerClass;\r\n\r\n\t\t// Content title\r\n\t\tlet title = document.createElement(\"div\");\r\n\t\ttitle.innerHTML = this.title;\r\n\t\ttitle.className = classNames.titleClass;\r\n\t\tif (!this.title) {\r\n\t\t\ttitle.style.display = \"none\";\r\n\t\t}\r\n\r\n\t\t// Content div\r\n\t\tlet content = document.createElement(\"div\");\r\n\t\tcontent.className = classNames.insideClass;\r\n\t\tcontent.innerHTML = this.content;\r\n\r\n\t\t// Set up events for content\r\n\t\tthis._IOs.wrapper = getInteraction().getInteraction(wrapper);\r\n\t\tthis._IOs.header = getInteraction().getInteraction(header);\r\n\t\tthis._disposers.push(this._IOs.wrapper);\r\n\r\n\t\t// Set hover/out events\r\n\t\tthis._IOs.wrapper.events.on(\"over\", this.disablePointers, this);\r\n\t\tthis._IOs.wrapper.events.on(\"out\", this.releasePointers, this);\r\n\r\n\t\t// Create an InteractionObject for close\r\n\t\tthis._IOs.close = getInteraction().getInteraction(close);\r\n\t\tthis._disposers.push(this._IOs.close);\r\n\r\n\t\t// Hide close for now\r\n\t\tclose.style.visibility = \"hidden\";\r\n\r\n\t\t// Add accessible stuff\r\n\t\twrapper.setAttribute(\"role\", \"dialog\");\r\n\r\n\t\t// Add to wrapper\r\n\t\theader.appendChild(close);\r\n\t\theader.appendChild(title);\r\n\t\twrapper.appendChild(header);\r\n\t\twrapper.appendChild(content);\r\n\t\tthis.container.appendChild(wrapper);\r\n\r\n\t\t// Save for later access\r\n\t\tthis._elements.wrapper = wrapper;\r\n\t\tthis._elements.header = header;\r\n\t\tthis._elements.content = content;\r\n\t\tthis._elements.title = title;\r\n\t\tthis._elements.close = close;\r\n\r\n\t\t// Load CSS\r\n\t\tif (this.defaultStyles) {\r\n\t\t\tthis.loadDefaultCSS();\r\n\t\t}\r\n\r\n\t\t// Create curtain as well\r\n\t\tthis.createCurtainElement();\r\n\r\n\t\t// Apply events\r\n\t\tthis.applyEvents();\r\n\r\n\t\tthis.applyReaderSettings();\r\n\r\n\t\t// Draggable?\r\n\t\tthis.setupDragging();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Popup title.\r\n\t *\r\n\t * Popup title can be any valid HTML, including CSS.\r\n\t *\r\n\t * @param value  Popup title\r\n\t */\r\n\tpublic set title(value: string) {\r\n\t\tif (this._title != value) {\r\n\t\t\tthis._title = value;\r\n\t\t\tif (!this._elements.content) {\r\n\t\t\t\tthis.createContentElement();\r\n\t\t\t}\r\n\t\t\tthis._elements.title.innerHTML = value;\r\n\t\t\tthis.positionElement();\r\n\t\t\tthis.applyReaderSettings();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Popup title\r\n\t */\r\n\tpublic get title(): string {\r\n\t\treturn this.adapter.apply(\"title\", this._title);\r\n\t}\r\n\r\n\t/**\r\n\t * A title for screen readers. It is very highly recommended to set that title\r\n\t * so that people using screen reader tools can get an immediate summary of\r\n\t * the information in the popup.\r\n\t *\r\n\t * @param value  Reader title\r\n\t */\r\n\tpublic set readerTitle(value: string) {\r\n\t\tif (this._readerTitle != value) {\r\n\t\t\tthis._readerTitle = value;\r\n\t\t\tthis.applyReaderSettings();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Popup content\r\n\t */\r\n\tpublic get readerTitle(): string {\r\n\t\treturn this.adapter.apply(\r\n\t\t\t\"readerTitle\",\r\n\t\t\tthis._readerTitle != \"\" ? this._readerTitle : this.title\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Is popup closable?\r\n\t *\r\n\t * If it is, it can be closed in a number of ways, e.g. by hitting ESC key,\r\n\t * clicking curtain, or clicking the close button.\r\n\t *\r\n\t * If it is not closable, the only way to close it is via `close()` call.\r\n\t *\r\n\t * @param value Closable?\r\n\t */\r\n\tpublic set closable(value: boolean) {\r\n\t\tif (value !== this._closable) {\r\n\t\t\tthis._closable = value;\r\n\t\t\tthis.applyEvents();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Closable?\r\n\t */\r\n\tpublic get closable(): boolean {\r\n\t\treturn this.adapter.apply(\"closable\", this._closable);\r\n\t}\r\n\r\n\t/**\r\n\t * If set to other than \"none\" will try to re-adjust the position of the\r\n\t * popop to fit within chart container or browser window.\r\n\t *\r\n\t * @ignore\r\n\t * @todo Implement\r\n\t * @default \"window\"\r\n\t * @param value  Fit option\r\n\t */\r\n\tpublic set fitTo(value: \"none\" | \"container\" | \"window\") {\r\n\t\tif (value != this._fitTo) {\r\n\t\t\tthis._fitTo = value;\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @todo Implement\r\n\t * @return Fit option\r\n\t */\r\n\tpublic get fitTo(): \"none\" | \"container\" | \"window\" {\r\n\t\treturn this.adapter.apply(\"fitTo\", this._fitTo);\r\n\t}\r\n\r\n\t/**\r\n\t * Should popup use default CSS?\r\n\t *\r\n\t * If default CSS is disabled, an external CSS should handle the look of the\r\n\t * popup, since it will look quite out of place otherwise.\r\n\t *\r\n\t * @default true\r\n\t * @param Use default CSS?\r\n\t */\r\n\tpublic set defaultStyles(value: boolean) {\r\n\t\tif (this._defaultStyles != value) {\r\n\t\t\tthis._defaultStyles = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Use default CSS?\r\n\t */\r\n\tpublic get defaultStyles(): boolean {\r\n\t\treturn this.adapter.apply(\"defaultStyles\", this._defaultStyles);\r\n\t}\r\n\r\n\t/**\r\n\t * Should popup use dim out all content behind it?\r\n\t *\r\n\t * @default false\r\n\t * @param Show curtain?\r\n\t */\r\n\tpublic set showCurtain(value: boolean) {\r\n\t\tif (this._showCurtain != value) {\r\n\t\t\tthis._showCurtain = value;\r\n\t\t\tif (this._elements.curtain) {\r\n\t\t\t\tthis._elements.curtain.style.display = value ? \"block\" : \"none\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Show curtain?\r\n\t */\r\n\tpublic get showCurtain(): boolean {\r\n\t\treturn this.adapter.apply(\"showCurtain\", this._showCurtain);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates curtain element.\r\n\t */\r\n\tprotected createCurtainElement(): void {\r\n\r\n\t\t// Get class names for popup elements\r\n\t\tlet classNames = this.getClassNames();\r\n\r\n\t\t// Create the curtain\r\n\t\tlet curtain = document.createElement(\"div\");\r\n\t\tcurtain.className = classNames.curtainClass;\r\n\r\n\t\t// Append curtain to wrapper\r\n\t\tthis.container.appendChild(curtain);\r\n\r\n\t\t// Create an InteractionObject for curtain because we might need to\r\n\t\t// set interactions on it\r\n\t\tthis._IOs.curtain = getInteraction().getInteraction(curtain);\r\n\r\n\t\t// Add Curtain IO to disposers\r\n\t\tthis._disposers.push(this._IOs.curtain);\r\n\r\n\t\t// Set events to disable underlying interactivity\r\n\t\tthis._IOs.curtain.events.on(\"over\", this.disablePointers, this);\r\n\t\tthis._IOs.curtain.events.on(\"out\", this.releasePointers, this);\r\n\r\n\t\t// Hide it?\r\n\t\tcurtain.style.display = this.showCurtain ? \"block\" : \"none\";\r\n\r\n\t\t// Save for later\r\n\t\tthis._elements.curtain = curtain;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Can the popup be dragged with a pointer?\r\n\t *\r\n\t * @default false\r\n\t * @param Show curtain?\r\n\t */\r\n\tpublic set draggable(value: boolean) {\r\n\t\tif (this._draggable != value) {\r\n\t\t\tthis._draggable = value;\r\n\t\t\tthis.setupDragging();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Show curtain?\r\n\t */\r\n\tpublic get draggable(): boolean {\r\n\t\treturn this.adapter.apply(\"draggable\", this._draggable);\r\n\t}\r\n\r\n\t/**\r\n\t * Resize popup as images are being loaded.\r\n\t *\r\n\t * @default true\r\n\t * @since 4.9.17\r\n\t * @param Resize dynamically?\r\n\t */\r\n\tpublic set dynamicResize(value: boolean) {\r\n\t\tif (this._dynamicResize != value) {\r\n\t\t\tthis._dynamicResize = value;\r\n\t\t\tthis.positionElement(true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Resize dynamically?\r\n\t */\r\n\tpublic get dynamicResize(): boolean {\r\n\t\treturn this.adapter.apply(\"dynamicResize\", this._dynamicResize);\r\n\t}\r\n\r\n\t/**\r\n\t * Horizontal positioning of the content window.\r\n\t *\r\n\t * Available options: \"left\", \"center\" (default), \"right\", and \"none\".\r\n\t *\r\n\t * @default \"center\"\r\n\t * @param Horizontal position\r\n\t */\r\n\tpublic set align(value: Align) {\r\n\t\tif (this._align != value) {\r\n\t\t\tthis._align = value;\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Horizontal position\r\n\t */\r\n\tpublic get align(): Align {\r\n\t\treturn this.adapter.apply(\"align\", this._align);\r\n\t}\r\n\r\n\t/**\r\n\t * Vertical positioning of the content window.\r\n\t *\r\n\t * Available options: \"top\", \"middle\" (default), \"bottom\", and \"none\".\r\n\t *\r\n\t * @default \"middle\"\r\n\t * @param Vertical position\r\n\t */\r\n\tpublic set verticalAlign(value: VerticalAlign) {\r\n\t\tif (this._verticalAlign != value) {\r\n\t\t\tthis._verticalAlign = value;\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Vertical position\r\n\t */\r\n\tpublic get verticalAlign(): VerticalAlign {\r\n\t\treturn this.adapter.apply(\"verticalAlign\", this._verticalAlign);\r\n\t}\r\n\r\n\t/**\r\n\t * \"left\" coordinate of a non-aligned (`align = \"none\"`) popup.\r\n\t *\r\n\t * Can be either absolute pixel value, or relative (`Percent`).\r\n\t *\r\n\t * Setting this property will automatically set `align` to \"none\".\r\n\t *\r\n\t * NOTE: The position is relative to the chart container.\r\n\t *\r\n\t * @param Left\r\n\t */\r\n\tpublic set left(value: number | Percent) {\r\n\t\tif (this.left != value) {\r\n\t\t\tthis._left = value;\r\n\t\t\tthis._align = \"none\";\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Left\r\n\t */\r\n\tpublic get left(): number | Percent {\r\n\t\treturn this.adapter.apply(\"left\", this._left);\r\n\t}\r\n\r\n\t/**\r\n\t * \"right\" coordinate of a non-aligned (`align = \"none\"`) popup.\r\n\t *\r\n\t * Can be either absolute pixel value, or relative (`Percent`).\r\n\t *\r\n\t * Setting this property will automatically set `align` to \"none\".\r\n\t *\r\n\t * NOTE: The position is relative to the chart container.\r\n\t *\r\n\t * @param Right\r\n\t */\r\n\tpublic set right(value: number | Percent) {\r\n\t\tif (this.right != value) {\r\n\t\t\tthis._right = value;\r\n\t\t\tthis._align = \"none\";\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Right\r\n\t */\r\n\tpublic get right(): number | Percent {\r\n\t\treturn this.adapter.apply(\"right\", this._right);\r\n\t}\r\n\r\n\t/**\r\n\t * \"top\" coordinate of a non-aligned (`verticalAlign = \"none\"`) popup.\r\n\t *\r\n\t * Can be either absolute pixel value, or relative (`Percent`).\r\n\t *\r\n\t * Setting this property will automatically set `verticalAlign` to \"none\".\r\n\t *\r\n\t * NOTE: The position is relative to the chart container.\r\n\t *\r\n\t * @param Top\r\n\t */\r\n\tpublic set top(value: number | Percent) {\r\n\t\tif (this.top != value) {\r\n\t\t\tthis._top = value;\r\n\t\t\tthis._verticalAlign = \"none\";\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Top\r\n\t */\r\n\tpublic get top(): number | Percent {\r\n\t\treturn this.adapter.apply(\"top\", this._top);\r\n\t}\r\n\r\n\t/**\r\n\t * \"bottom\" coordinate of a non-aligned (`verticalAlign = \"none\"`) popup.\r\n\t *\r\n\t * Can be either absolute pixel value, or relative (`Percent`).\r\n\t *\r\n\t * Setting this property will automatically set `verticalAlign` to \"none\".\r\n\t *\r\n\t * NOTE: The position is relative to the chart container.\r\n\t *\r\n\t * @param Bottom\r\n\t */\r\n\tpublic set bottom(value: number | Percent) {\r\n\t\tif (this.bottom != value) {\r\n\t\t\tthis._bottom = value;\r\n\t\t\tthis._verticalAlign = \"none\";\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Bottom\r\n\t */\r\n\tpublic get bottom(): number | Percent {\r\n\t\treturn this.adapter.apply(\"bottom\", this._bottom);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an object with references to various elements of the Popup.\r\n\t *\r\n\t * * `wrapper`\r\n\t * * `title`\r\n\t * * `content`\r\n\t * * `close`\r\n\t * * `curtain`\r\n\t */\r\n\tpublic get elements(): {\r\n\t\twrapper?: HTMLElement;\r\n\t\ttitle?: HTMLElement;\r\n\t\tcontent?: HTMLElement;\r\n\t\tclose?: HTMLElement;\r\n\t\tcurtain?: HTMLElement;\r\n\t} {\r\n\t\treturn this._elements;\r\n\t}\r\n\r\n\t/**\r\n\t * Loads popup CSS.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic loadDefaultCSS(): void {\r\n\t\tif (!this._cssLoaded) {\r\n\t\t\tthis._disposers.push(popupCSS(getShadowRoot(this.container), this.classPrefix));\r\n\t\t\t$object.each(this._elements, (key, el) => {\r\n\t\t\t\tel.style.display = \"\";\r\n\t\t\t});\r\n\t\t\tthis._cssLoaded = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * If popup is closable, this method adds various events to popup elements.\r\n\t */\r\n\tprotected applyEvents(): void {\r\n\t\tif (this._IOs.close) {\r\n\t\t\tif (this.closable) {\r\n\t\t\t\tthis._IOs.close.element.style.visibility = \"visible\";\r\n\r\n\t\t\t\tlet disposers = [\r\n\t\t\t\t\tgetInteraction().body.events.on(\"keyup\", (ev) => {\r\n\t\t\t\t\t\tif (keyboard.isKey(ev.event, \"esc\") && this.closable) {\r\n\t\t\t\t\t\t\tthis.close()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tthis._IOs.close.events.on(\"hit\", (ev) => {\r\n\t\t\t\t\t\tthis.close();\r\n\t\t\t\t\t})\r\n\t\t\t\t];\r\n\t\t\t\tdisposers.push(this._IOs.curtain.events.on(\"hit\", (ev) => {\r\n\t\t\t\t\tif (this.showCurtain && this.closable) {\r\n\t\t\t\t\t\tthis.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t\tthis._disposers.push(new MultiDisposer(disposers));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._IOs.close.element.style.visibility = \"hidden\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Disables interactivity on parent chart.\r\n\t */\r\n\tprotected disablePointers(): void {\r\n\t\tif (this.sprite) {\r\n\t\t\tthis._spriteInteractionsEnabled = this.sprite.interactionsEnabled;\r\n\t\t\tthis.sprite.interactionsEnabled = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Releases temporarily disabled pointers on parent chart.\r\n\t */\r\n\tprotected releasePointers(): void {\r\n\t\tif ($type.hasValue(this._spriteInteractionsEnabled)) {\r\n\t\t\tthis.sprite.interactionsEnabled = this._spriteInteractionsEnabled;\r\n\t\t\tthis._spriteInteractionsEnabled = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets screen reader related settings.\r\n\t */\r\n\tprotected applyReaderSettings(): void {\r\n\t\tthis.elements.wrapper.setAttribute(\"aria-label\", this.readerTitle);\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all properties and related data from different element.\r\n\t *\r\n\t * @param object Source element\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\tsuper.copyFrom(source);\r\n\t\tthis.container = source.container;\r\n\t\tthis.sprite = source.sprite;\r\n\t\tthis.classPrefix = source.classPrefixRaw;\r\n\t\tthis.content = source.content;\r\n\t\tthis.title = source.title;\r\n\t\tthis.readerTitle = source.readerTitle;\r\n\t\tthis.defaultStyles = source.defaultStyles;\r\n\t\tthis.showCurtain = source.showCurtain;\r\n\t\tthis.align = source.align;\r\n\t\tthis.verticalAlign = source.verticalAlign;\r\n\t\tthis.left = source.left;\r\n\t\tthis.right = source.right;\r\n\t\tthis.top = source.top;\r\n\t\tthis.bottom = source.bottom;\r\n\t\tthis.adapter.copyFrom(source.adapter);\r\n\t}\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}