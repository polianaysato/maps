{"ast":null,"code":"import _slicedToArray from\"C:/Users/polia/Desktop/Overlay/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";// @ts-nocheck\nimport{useRef,useEffect,useState,useCallback}from\"react\";import mapboxgl from\"mapbox-gl\";import\"mapbox-gl/dist/mapbox-gl.css\";import ReactDOM from'react-dom';import{makeStyles,Box,IconButton}from'@material-ui/core';import AddIcon from'@mui/icons-material/Add';import RemoveIcon from'@mui/icons-material/Remove';import clusterBlue from\"../assets/clusterBlue.svg\";import unclusteredPoint from\"../assets/unclusteredPoint.svg\";import\"../styles/App.css\";import Legend from\"../components/Legend\";import{mapboxStyle,states12MilesRadius,states12MilesSteps,states18MilesRadius,states18MilesSteps,states6MilesRadius,states6MilesSteps,statesHeatmapFill,statesHeatmapSteps,statesMapFilter,statesCircleStroke18,statesCircleStroke6,statesCircleStroke12,getPixels}from\"../helpers/Utils\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var useStyles=makeStyles(function(){return{chartDiv:{height:'25em'},ctrlWrapper:{zIndex:1000,position:'absolute',right:0,top:0,display:'block',width:30,margin:10},plus:{boxShadow:'rgb(0, 0, 0, 0.2) 0px 3px 1px -2px, rgb(0, 0, 0, 0.14) 0px 2px 2px 0px, rgb(0, 0, 0, 0.12) 0px 1px 5px 0px',background:'#FFF',width:30,height:30,borderRadius:'5px 5px 0px 0px'},minus:{boxShadow:'rgb(0, 0, 0, 0.2) 0px 3px 1px -2px, rgb(0, 0, 0, 0.14) 0px 2px 2px 0px, rgb(0, 0, 0, 0.12) 0px 1px 5px 0px',background:'#FFF',width:30,height:30,borderRadius:'0px 0px 5px 5px'}};});mapboxgl.accessToken=\"pk.eyJ1IjoiZW5nbWFwYm94IiwiYSI6ImNqY3M1ZXA5czM2ZGYzM283ZmhscDltcGMifQ.Za7ut_7UThGzvjWhX4ACJQ\";export var Mapbox=function Mapbox(_ref){var geoJson=_ref.geoJson,poi=_ref.poi,Popup=_ref.Popup;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),colorScheme=_useState2[0],setColorScheme=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),steps=_useState4[0],setSteps=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),poiViews6Miles=_useState6[0],setPoiViews6Miles=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),poiColor6Miles=_useState8[0],setPoiColor6Miles=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),poiViews12Miles=_useState10[0],setPoiViews12Miles=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),poiColor12Miles=_useState12[0],setPoiColor12Miles=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),poiViews18Miles=_useState14[0],setPoiViews18Miles=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),poiColor18Miles=_useState16[0],setPoiColor18Miles=_useState16[1];var mapContainer=useRef();var map=useRef();var popUpRef=useRef();var geoCoder=useRef();var classes=useStyles();useEffect(function(){setColorScheme(statesHeatmapFill);setSteps(statesHeatmapSteps);setPoiColor6Miles(states6MilesRadius);setPoiViews6Miles(states6MilesSteps);setPoiColor12Miles(states12MilesRadius);setPoiViews12Miles(states12MilesSteps);setPoiColor18Miles(states18MilesRadius);setPoiViews18Miles(states18MilesSteps);},[]);useEffect(function(){//initialize popup just once\npopUpRef.current=new mapboxgl.Popup({closeButton:false,closeOnClick:false});},[]);useEffect(function(){map.current=new mapboxgl.Map({container:mapContainer.current,style:mapboxStyle,center:[-97,36],zoom:3.3});console.log(poi);// only want to work with the map after it has fully loaded\n// if you try to add sources and layers before the map has loaded\n// things will not work properly\nmap.current.on(\"load\",function(){map.current.addSource(\"sites\",{type:\"geojson\",data:poi});map.current.addSource(\"states\",{type:\"geojson\",data:geoJson});map.current.addLayer({id:\"hover\",type:\"fill\",source:\"states\",paint:{\"fill-color\":statesMapFilter,\"fill-opacity\":1,\"fill-outline-color\":\"#000\"}});map.current.addLayer({id:'outerCircle',type:'circle','icon-allow-overlap':true,source:'sites',paint:{\"circle-color\":statesCircleStroke18,\"circle-radius\":[\"interpolate\",[\"linear\"],[\"zoom\"],// zoom is 5 (or less) -> circle radius will be 1px\n4,9// zoom is 10 (or greater) -> circle radius will be 5px\n],'circle-opacity':1}});map.current.addLayer({id:'radius',type:'circle',source:'sites','icon-allow-overlap':true,paint:{\"circle-color\":statesCircleStroke12,\"circle-radius\":[\"interpolate\",[\"linear\"],[\"zoom\"],// zoom is 5 (or less) -> circle radius will be 1px\n4,6// zoom is 10 (or greater) -> circle radius will be 5px\n],'circle-opacity':1}});map.current.addLayer({id:\"unclustered-point\",type:\"circle\",source:\"sites\",filter:[\"!\",[\"has\",\"point_count\"]],'icon-allow-overlap':true,paint:{\"circle-color\":statesCircleStroke6,\"circle-radius\":[\"interpolate\",[\"linear\"],[\"zoom\"],// zoom is 5 (or less) -> circle radius will be 1px\n4,3// zoom is 10 (or greater) -> circle radius will be 5px\n],'circle-opacity':1}});map.current.on(\"mouseover\",\"radius\",function(e){e.preventDefault();var f=map.current.queryRenderedFeatures(e.point,{layers:['radius']});if(f.length){map.current.getCanvas().style.cursor='pointer';var popupNode=document.createElement('div');if(Popup){var elem=/*#__PURE__*/_jsx(Popup,{data:f[0]});ReactDOM.render(elem,popupNode);popUpRef.current.setLngLat(e.lngLat).setDOMContent(popupNode).addTo(map.current);}return;}});map.current.on('mouseover',\"hover\",function(){map.current.getCanvas().style.cursor='';popUpRef.current.remove();});map.current.on('click',function(e){if(e.defaultPrevented===false){popUpRef.current.remove();}});});// cleanup function to remove map on unmount\nreturn function(){return map.current.remove();};},[Popup,geoJson,poi,poiColor12Miles,poiColor6Miles,poiViews12Miles,poiViews6Miles]);var createRadiusOnZoom=useCallback(function(currentZoom){var stops18=[];var stops12=[];var stops6=[];var innerRadius={};var midRadius={};var outerRadius={};var pixels=7;if(map.current){pixels=Number(getPixels('US',Number(currentZoom),50));}var pixels18=Number(pixels);var pixels12=Number(pixels*0.5);var pixels6=Number(pixels*0.3);stops18.push(['Mock',pixels18]);stops12.push(['Mock',pixels12]);stops6.push(['Mock',pixels6]);innerRadius={property:'vendor',type:'categorical',stops:stops6};midRadius={property:'vendor',type:'categorical',stops:stops12};outerRadius={property:'vendor',type:'categorical',stops:stops18};return{innerRadius:innerRadius,midRadius:midRadius,outerRadius:outerRadius};},[]);var zoomIn=useCallback(function(){if(map.current!==undefined){var currentZoom=map.current.getZoom();if(currentZoom){map.current.zoomTo(Number(currentZoom)+1,{duration:350});var radius=createRadiusOnZoom(currentZoom);if(map.current!==undefined&&map.current.isStyleLoaded()){map.current.setPaintProperty('unclustered-point','circle-radius',radius.innerRadius);map.current.setPaintProperty('outerCircle','circle-radius',radius.outerRadius);map.current.setPaintProperty('radius','circle-radius',radius.midRadius);}}}},[createRadiusOnZoom]);var zoomOut=useCallback(function(){if(map.current!==undefined){var currentZoom=map.current.getZoom();if(currentZoom){map.current.zoomTo(Number(currentZoom)-1,{duration:350});var radius=createRadiusOnZoom(currentZoom-1);if(map.current!==undefined&&map.current.isStyleLoaded()){map.current.setPaintProperty('unclustered-point','circle-radius',radius.innerRadius);map.current.setPaintProperty('radius','circle-radius',radius.midRadius);map.current.setPaintProperty('outerCircle','circle-radius',radius.outerRadius);}}}},[createRadiusOnZoom]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Legend,{type:\"dots\",clusters:\"Clusters\",pointCount:\"Views\",clusterImg:clusterBlue,unclusteredImg:unclusteredPoint,unclusteredPoint:\"Unclustered Points\",colorScheme:colorScheme,steps:steps,poi:\"POI\",views:\"Views\",poiColor6Miles:poiColor6Miles,poiViews6Miles:poiViews6Miles,poiColor12Miles:poiColor12Miles,poiViews12Miles:poiViews12Miles,poiColor18Miles:poiColor18Miles,poiViews18Miles:poiViews18Miles}),/*#__PURE__*/_jsx(\"div\",{ref:mapContainer,style:{width:\"100%\",height:\"100vh\"}}),/*#__PURE__*/_jsx(\"div\",{className:classes.ctrlWrapper,children:/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"zoom in\",onClick:zoomIn,className:classes.plus,children:/*#__PURE__*/_jsx(AddIcon,{})}),/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"zoom out\",onClick:zoomOut,className:classes.minus,children:/*#__PURE__*/_jsx(RemoveIcon,{})})]})})]});};","map":{"version":3,"sources":["C:/Users/polia/Desktop/Overlay/src/pages/Mapbox.tsx"],"names":["useRef","useEffect","useState","useCallback","mapboxgl","ReactDOM","makeStyles","Box","IconButton","AddIcon","RemoveIcon","Legend","mapboxStyle","states12MilesRadius","states12MilesSteps","states18MilesRadius","states18MilesSteps","states6MilesRadius","states6MilesSteps","statesHeatmapFill","statesHeatmapSteps","statesMapFilter","statesCircleStroke18","statesCircleStroke6","statesCircleStroke12","getPixels","useStyles","chartDiv","height","ctrlWrapper","zIndex","position","right","top","display","width","margin","plus","boxShadow","background","borderRadius","minus","accessToken","Mapbox","geoJson","poi","Popup","colorScheme","setColorScheme","steps","setSteps","poiViews6Miles","setPoiViews6Miles","poiColor6Miles","setPoiColor6Miles","poiViews12Miles","setPoiViews12Miles","poiColor12Miles","setPoiColor12Miles","poiViews18Miles","setPoiViews18Miles","poiColor18Miles","setPoiColor18Miles","mapContainer","map","popUpRef","geoCoder","classes","current","closeButton","closeOnClick","Map","container","style","center","zoom","console","log","on","addSource","type","data","addLayer","id","source","paint","filter","e","preventDefault","f","queryRenderedFeatures","point","layers","length","getCanvas","cursor","popupNode","document","createElement","elem","render","setLngLat","lngLat","setDOMContent","addTo","remove","defaultPrevented","createRadiusOnZoom","currentZoom","stops18","stops12","stops6","innerRadius","midRadius","outerRadius","pixels","Number","pixels18","pixels12","pixels6","push","property","stops","zoomIn","undefined","getZoom","zoomTo","duration","radius","isStyleLoaded","setPaintProperty","zoomOut","clusterBlue","unclusteredPoint"],"mappings":"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","sourcesContent":["// @ts-nocheck\nimport { useRef, useEffect, useState, useCallback } from \"react\"\nimport mapboxgl from \"mapbox-gl\"\nimport \"mapbox-gl/dist/mapbox-gl.css\"\nimport MapboxGeocoder from '@mapbox/mapbox-gl-geocoder'\nimport ReactDOM from 'react-dom'\nimport { makeStyles, Box, IconButton } from '@material-ui/core'\nimport AddIcon from '@mui/icons-material/Add'\nimport RemoveIcon from '@mui/icons-material/Remove';\nimport clusterBlue from \"../assets/clusterBlue.svg\"\nimport unclusteredPoint from \"../assets/unclusteredPoint.svg\"\nimport \"../styles/App.css\"\nimport Legend from \"../components/Legend\"\nimport { mapboxStyle, states12MilesRadius, states12MilesSteps, states18MilesRadius, states18MilesSteps, states6MilesRadius, states6MilesSteps, statesHeatmapFill, statesHeatmapSteps, statesMapFilter, statesCircleStroke18, statesCircleStroke6, statesCircleStroke12, getPixels } from \"../helpers/Utils\"\n\n\nconst useStyles = makeStyles(() => ({\n  chartDiv: {\n    height: '25em'\n  },\n  ctrlWrapper: {\n    zIndex: 1000,\n    position: 'absolute',\n    right: 0,\n    top: 0,\n    display: 'block',\n    width: 30,\n    margin: 10,\n  },\n  plus: {\n    boxShadow: 'rgb(0, 0, 0, 0.2) 0px 3px 1px -2px, rgb(0, 0, 0, 0.14) 0px 2px 2px 0px, rgb(0, 0, 0, 0.12) 0px 1px 5px 0px',\n    background: '#FFF',\n    width: 30,\n    height: 30,\n    borderRadius: '5px 5px 0px 0px',\n  },\n  minus: {\n    boxShadow: 'rgb(0, 0, 0, 0.2) 0px 3px 1px -2px, rgb(0, 0, 0, 0.14) 0px 2px 2px 0px, rgb(0, 0, 0, 0.12) 0px 1px 5px 0px',\n    background: '#FFF',\n    width: 30,\n    height: 30,\n    borderRadius: '0px 0px 5px 5px',\n  }\n}))\n\nmapboxgl.accessToken =\n  \"pk.eyJ1IjoiZW5nbWFwYm94IiwiYSI6ImNqY3M1ZXA5czM2ZGYzM283ZmhscDltcGMifQ.Za7ut_7UThGzvjWhX4ACJQ\";\n\n\nexport const Mapbox = ({ geoJson, poi, Popup }) => {\n  const [colorScheme, setColorScheme] = useState<Array<string>>([])\n  const [steps, setSteps] = useState<Array<number>>([])\n\n  const [poiViews6Miles, setPoiViews6Miles] = useState<Array<number>>([])\n  const [poiColor6Miles, setPoiColor6Miles] = useState<Array<string>>([])\n\n  const [poiViews12Miles, setPoiViews12Miles] = useState<Array<number>>([])\n  const [poiColor12Miles, setPoiColor12Miles] = useState<Array<string>>([])\n\n  const [poiViews18Miles, setPoiViews18Miles] = useState<Array<number>>([])\n  const [poiColor18Miles, setPoiColor18Miles] = useState<Array<string>>([])\n\n  const mapContainer = useRef()\n  const map = useRef()\n  const popUpRef = useRef()\n  const geoCoder = useRef()\n\n\n  const classes = useStyles()\n\n\n  useEffect(() => {\n    setColorScheme(statesHeatmapFill)\n    setSteps(statesHeatmapSteps)\n\n    setPoiColor6Miles(states6MilesRadius)\n\n    setPoiViews6Miles(states6MilesSteps)\n\n    setPoiColor12Miles(states12MilesRadius)\n    setPoiViews12Miles(states12MilesSteps)\n\n    setPoiColor18Miles(states18MilesRadius)\n    setPoiViews18Miles(states18MilesSteps)\n  }, [])\n\n  useEffect(() => {\n    //initialize popup just once\n    popUpRef.current = new mapboxgl.Popup({\n        closeButton: false,\n        closeOnClick: false,\n    })\n}, [])\n\n\n  useEffect(() => {\n    map.current = new mapboxgl.Map({\n      container: mapContainer.current,\n      style: mapboxStyle,\n      center: [-97, 36],\n      zoom: 3.3,\n    })\n\n    console.log(poi)\n\n    // only want to work with the map after it has fully loaded\n    // if you try to add sources and layers before the map has loaded\n    // things will not work properly\n    map.current.on(\"load\", () => {\n      map.current.addSource(\"sites\", {\n        type: \"geojson\",\n        data: poi,\n      })\n\n      map.current.addSource(\"states\", {\n        type: \"geojson\",\n        data: geoJson,\n      })\n\n      map.current.addLayer({\n        id: \"hover\",\n        type: \"fill\",\n        source: \"states\",\n        paint: {\n          \"fill-color\": statesMapFilter,\n          \"fill-opacity\": 1,\n          \"fill-outline-color\": \"#000\",\n        },\n        \n      })\n\n      map.current.addLayer({\n        id: 'outerCircle',\n        type: 'circle',\n        'icon-allow-overlap': true,\n        source: 'sites',\n        paint: {\n          \"circle-color\": statesCircleStroke18,\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"zoom\"],\n            // zoom is 5 (or less) -> circle radius will be 1px\n            4,\n            9,\n            // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n            'circle-opacity': 1,\n        },\n    })\n\n      map.current.addLayer({\n        id: 'radius',\n        type: 'circle',\n        source: 'sites',\n        'icon-allow-overlap': true,\n        paint: {\n          \"circle-color\": statesCircleStroke12,\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"zoom\"],\n            // zoom is 5 (or less) -> circle radius will be 1px\n            4,\n            6,\n            // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n            'circle-opacity': 1,\n        },\n    })\n\n      map.current.addLayer({\n        id: \"unclustered-point\",\n        type: \"circle\",\n        source: \"sites\",\n        filter: [\"!\", [\"has\", \"point_count\"]],\n        'icon-allow-overlap': true,\n        paint: {\n          \"circle-color\": statesCircleStroke6,\n          \"circle-radius\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"zoom\"],\n            // zoom is 5 (or less) -> circle radius will be 1px\n            4,\n            3,\n            // zoom is 10 (or greater) -> circle radius will be 5px\n          ],\n          'circle-opacity': 1,\n        },\n      })\n\n\n\n      map.current.on(\"mouseover\", \"radius\", (e: any) => {\n        e.preventDefault()\n        let f = map.current.queryRenderedFeatures(e.point, { layers: ['radius'] })\n\n        if (f.length) {\n            map.current.getCanvas().style.cursor = 'pointer'\n            let popupNode = document.createElement('div')\n            if (Popup) {\n                let elem = <Popup data={f[0]} />\n                ReactDOM.render(elem, popupNode)\n                popUpRef.current\n                    .setLngLat(e.lngLat)\n                    .setDOMContent(popupNode)\n                    .addTo(map.current)\n            }\n            return\n        }\n      })\n\n        map.current.on('mouseover', `hover`, () => {\n        map.current.getCanvas().style.cursor = ''\n        popUpRef.current.remove()\n      }) \n      \n\n      map.current.on('click', (e) => {\n        if (e.defaultPrevented === false) {\n          popUpRef.current.remove()\n        }\n      });\n      \n     \n    })\n\n    // cleanup function to remove map on unmount\n    return () => map.current.remove()\n  }, [Popup, geoJson, poi, poiColor12Miles, poiColor6Miles, poiViews12Miles, poiViews6Miles])\n\n\n  const createRadiusOnZoom = useCallback((currentZoom: number) => {\n    let stops18: any = []\n    let stops12: any = []\n    let stops6: any = []\n    let innerRadius = {}\n    let midRadius = {}\n    let outerRadius = {}\n    let pixels: number = 7\n\n    if (map.current) {\n        pixels = Number(getPixels('US', Number(currentZoom), 50))\n    }\n\n    let pixels18 = Number(pixels) \n    let pixels12 = Number(pixels*0.5) \n    let pixels6 = Number(pixels*0.3) \n    stops18.push(['Mock', pixels18])\n    stops12.push(['Mock', pixels12])\n    stops6.push(['Mock', pixels6])\n\n    innerRadius = {\n        property: 'vendor',\n        type: 'categorical',\n        stops: stops6,\n    }\n\n    midRadius = {\n      property: 'vendor',\n        type: 'categorical',\n        stops: stops12,\n    }\n\n    outerRadius = {\n      property: 'vendor',\n        type: 'categorical',\n        stops: stops18,\n    }\n\n    return {\n        innerRadius: innerRadius,\n        midRadius: midRadius,\n        outerRadius: outerRadius\n    }\n}, [])\n\n\nconst zoomIn = useCallback(() => {\n  if (map.current !== undefined) {\n      let currentZoom = map.current.getZoom()\n\n      if (currentZoom) {\n          map.current.zoomTo(Number(currentZoom) + 1, {\n              duration: 350,\n          })\n\n          let radius = createRadiusOnZoom(currentZoom)\n\n          if (map.current !== undefined && map.current.isStyleLoaded()) {\n            map.current.setPaintProperty('unclustered-point', 'circle-radius', radius.innerRadius)\n            map.current.setPaintProperty('outerCircle', 'circle-radius', radius.outerRadius)\n            map.current.setPaintProperty('radius', 'circle-radius', radius.midRadius)\n            \n        } \n      }\n  }\n}, [createRadiusOnZoom])\n\n\nconst zoomOut = useCallback(() => {\n  if (map.current !== undefined) {\n      let currentZoom = map.current.getZoom()\n\n      if (currentZoom) {\n          map.current.zoomTo(Number(currentZoom) - 1, {\n              duration: 350,\n          })\n\n          let radius = createRadiusOnZoom(currentZoom - 1)\n\n          if (map.current !== undefined && map.current.isStyleLoaded()) {\n            map.current.setPaintProperty('unclustered-point', 'circle-radius', radius.innerRadius)\n            map.current.setPaintProperty('radius', 'circle-radius', radius.midRadius)\n            map.current.setPaintProperty('outerCircle', 'circle-radius', radius.outerRadius)\n        } \n      }\n  }\n}, [createRadiusOnZoom])\n\n\n  return (\n    <>\n      <Legend\n        type=\"dots\"\n        clusters=\"Clusters\"\n        pointCount=\"Views\"\n        clusterImg={clusterBlue}\n        unclusteredImg={unclusteredPoint}\n        unclusteredPoint=\"Unclustered Points\"\n        colorScheme={colorScheme}\n        steps={steps}\n        poi=\"POI\"\n        views=\"Views\"\n        poiColor6Miles={poiColor6Miles}\n        poiViews6Miles={poiViews6Miles}\n        poiColor12Miles={poiColor12Miles}\n        poiViews12Miles={poiViews12Miles}\n        poiColor18Miles={poiColor18Miles}\n        poiViews18Miles={poiViews18Miles}\n      />\n      <div ref={mapContainer} style={{ width: \"100%\", height: \"100vh\" }} />\n      <div className={classes.ctrlWrapper}>\n        <Box>\n          <IconButton aria-label=\"zoom in\" onClick={zoomIn} className={classes.plus}>\n            <AddIcon />\n          </IconButton>\n          <IconButton aria-label=\"zoom out\" onClick={zoomOut} className={classes.minus}>\n            <RemoveIcon /> \n          </IconButton>\n        </Box>\n      </div>\n    </>\n  )\n}\n\n\n"]},"metadata":{},"sourceType":"module"}