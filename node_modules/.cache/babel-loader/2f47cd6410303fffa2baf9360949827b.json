{"ast":null,"code":"/**\r\n * Functionality for any series-based elements, like Line Series (graphs),\r\n * Pie slice lists, etc.\r\n */\nimport { __extends } from \"tslib\";\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\n\nimport { Component } from \"../../core/Component\";\nimport { Sprite } from \"../../core/Sprite\";\nimport { List, ListTemplate, ListDisposer } from \"../../core/utils/List\";\nimport { Dictionary, DictionaryDisposer } from \"../../core/utils/Dictionary\";\nimport { DataItem } from \"../../core/DataItem\";\nimport { Container } from \"../../core/Container\";\nimport { Tooltip } from \"../../core/elements/Tooltip\";\nimport { Bullet } from \"../elements/Bullet\";\nimport { LegendSettings } from \"../Legend\";\nimport { options } from \"../../core/Options\";\nimport { Color } from \"../../core/utils/Color\";\nimport { registry } from \"../../core/Registry\";\nimport * as $iter from \"../../core/utils/Iterator\";\nimport * as $math from \"../../core/utils/Math\";\nimport * as $ease from \"../../core/utils/Ease\";\nimport * as $utils from \"../../core/utils/Utils\";\nimport * as $object from \"../../core/utils/Object\";\nimport * as $type from \"../../core/utils/Type\";\nimport * as $array from \"../../core/utils/Array\";\nimport * as $colors from \"../../core/utils/Colors\";\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\n\n/**\r\n * Defines a [[DataItem]] for [[Series]].\r\n *\r\n * @see {@link DataItem}\r\n */\n\nvar SeriesDataItem =\n/** @class */\nfunction (_super) {\n  __extends(SeriesDataItem, _super);\n  /**\r\n   * Constructor\r\n   */\n\n\n  function SeriesDataItem() {\n    var _this = _super.call(this) || this;\n\n    _this.className = \"SeriesDataItem\"; //@todo Should we make `bullets` list disposable?\n    //this._disposers.push(new DictionaryDisposer(this.bullets));\n\n    _this.values.value = {};\n    _this.values.value = {};\n\n    _this.applyTheme();\n\n    return _this;\n  }\n\n  Object.defineProperty(SeriesDataItem.prototype, \"bullets\", {\n    /**\r\n     * A dictionary of data items bullets, where key is uid of a bullet template.\r\n     */\n    get: function get() {\n      if (!this._bullets) {\n        this._bullets = new Dictionary();\n\n        this._disposers.push(new DictionaryDisposer(this._bullets));\n      }\n\n      return this._bullets;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Destroys this object and all related data.\r\n   */\n\n  SeriesDataItem.prototype.dispose = function () {\n    this.bullets.clear();\n\n    _super.prototype.dispose.call(this);\n  };\n\n  Object.defineProperty(SeriesDataItem.prototype, \"value\", {\n    /**\r\n     * @return Value\r\n     */\n    get: function get() {\n      return this.values.value.value;\n    },\n\n    /**\r\n     * data items's numeric value.\r\n     *\r\n     * @param value  Value\r\n     */\n    set: function set(value) {\n      this.setValue(\"value\", value);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return SeriesDataItem;\n}(DataItem);\n\nexport { SeriesDataItem };\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\n\n/**\r\n * Defines base class for any kind of serial data.\r\n *\r\n * @see {@link ISeriesEvents} for a list of available Events\r\n * @see {@link ISeriesAdapters} for a list of available Adapters\r\n * @todo Separate axis-related stuff to some other class so that MapSeries would not have unrelated stuff\r\n */\n\nvar Series =\n/** @class */\nfunction (_super) {\n  __extends(Series, _super);\n  /**\r\n   * Constructor\r\n   */\n\n\n  function Series() {\n    var _this = _super.call(this) || this;\n    /**\r\n     * Should this series excluded from the axis scale calculations?\r\n     *\r\n     * @default false\r\n     */\n\n\n    _this._ignoreMinMax = false;\n    /**\r\n     * Should series' bullets?\r\n     *\r\n     * @default true\r\n     */\n\n    _this._showBullets = true;\n    /**\r\n     * Settings for the appearance of the related legend items.\r\n     */\n\n    _this.legendSettings = new LegendSettings();\n    /**\r\n     * Lowest overal values by type.\r\n     */\n\n    _this._tmin = new Dictionary();\n    /**\r\n     * Highest overal values by type.\r\n     */\n\n    _this._tmax = new Dictionary();\n    /**\r\n     * Lowest values in current selection by type.\r\n     */\n\n    _this._smin = new Dictionary();\n    /**\r\n     * Highest values in current selection by type.\r\n     */\n\n    _this._smax = new Dictionary();\n    /**\r\n     * [dataItemsByAxis description]\r\n     *\r\n     * Both by category and date.\r\n     *\r\n     * @ignore Exclude from docs\r\n     * @todo Description\r\n     */\n\n    _this.dataItemsByAxis = new Dictionary();\n    /**\r\n     * Normally series items are focusable using keyboard, so that people can\r\n     * select them with a TAB key. However, if there are a lot of data points on\r\n     * screen it might be long and useless to tab through all o fthem.\r\n     *\r\n     * This is where `skipFocusThreshold` comes in. If there are more items than\r\n     * the value set here, we will not make those focusable and rather let screen\r\n     * reader software rely on the series summary, or authors provide alternative\r\n     * detailed information display, such as HTML table.\r\n     *\r\n     * Different series might have different threshold defaults.\r\n     */\n\n    _this.skipFocusThreshold = 20;\n    /**\r\n     * Used to indicate if `itemReaderText` was changed \"from the outside\".\r\n     */\n\n    _this._itemReaderTextChanged = false;\n    /**\r\n     * Most of the series use absolute values. However sometimes various\r\n     * calculated percent values are need, e.g. item's percent representation\r\n     * across all values in series, etc.\r\n     *\r\n     * It's a resource-intensive operation, so it is disabled by default.\r\n     *\r\n     * If you need percents to be calculated, e.g. for showing them in tooltips,\r\n     * or creating 100% stacks, this setting needs to be set to `true`.\r\n     *\r\n     * NOTE: `PieChart`, which relies on slice percentages, has this\r\n     * automatically set to `true`.\r\n     *\r\n     * @default false\r\n     */\n\n    _this.calculatePercent = false;\n    /**\r\n     * When `calculatePercent` is enabled and data item's percent value is\r\n     * calculated, last item's real value is used instead of its working value.\r\n     *\r\n     * This is done for the animations when last item in series (e.g. slice in\r\n     * a `PieSeries`) is hidden or shown. (if we would use real value, the\r\n     * calculated percent would always be 100%).\r\n     *\r\n     * Sometimes there is a need (e.g. for drill-down Sunburst) to disable this\r\n     * hack by setting `usePercentHack` to `false`.\r\n     *\r\n     * @since 4.9.13\r\n     * @default true\r\n     */\n\n    _this.usePercentHack = true;\n    /**\r\n     * Specifies if series should be automatically disposed when removing from\r\n     * chart's `series` list.\r\n     *\r\n     * @default true\r\n     */\n\n    _this.autoDispose = true;\n    /**\r\n     * When chart/series' data is processed, all kinds of derivative values are\r\n     * calculated. E.g. sum, min, max, change, etc. This is a potentially\r\n     * time-consuming operation, especially prominent in data-heavy charts.\r\n     *\r\n     * If your chart does not need those values, and you have a lot of data,\r\n     * setting this to `true` might give a dramatic increase in initial chart\r\n     * load speed.\r\n     *\r\n     * Please note, regular column and line series usage scenarios do not\r\n     * require derivative values. Those come into play only when you do advanced\r\n     * functionality like coloring segments of charts in different colors\r\n     * depending on change between open and close values, have stacked series, or\r\n     * display any of the derived values, like percent, in tooltips or bullets.\r\n     *\r\n     * @default false\r\n     */\n\n    _this.simplifiedProcessing = false;\n\n    if (_this.constructor === Series) {\n      throw new Error(\"'Series' cannot be instantiated directly. Please use a specific series type.\");\n    }\n\n    _this.className = \"Series\";\n    _this.isMeasured = false;\n    _this.layout = \"none\";\n    _this.shouldClone = false;\n\n    _this.setPropertyValue(\"hidden\", false);\n\n    _this.axisRanges = new List();\n\n    _this.axisRanges.events.on(\"inserted\", _this.processAxisRange, _this, false);\n\n    _this.minBulletDistance = 0; // otherwise we'll have a lot of cases when people won't see bullets and think it's a bug\n\n    _this.mainContainer = _this.createChild(Container);\n    _this.mainContainer.shouldClone = false;\n    _this.mainContainer.mask = _this.createChild(Sprite);\n\n    _this._disposers.push(_this.mainContainer); // all bullets should go on top of lines/fills. So we add a separate container for bullets and later set it's parent to chart.bulletsContainer\n\n\n    var bulletsContainer = _this.mainContainer.createChild(Container);\n\n    _this._shouldBeReady.push(bulletsContainer);\n\n    bulletsContainer.shouldClone = false;\n    bulletsContainer.layout = \"none\";\n    bulletsContainer.virtualParent = _this;\n\n    _this._disposers.push(bulletsContainer);\n\n    _this.bulletsContainer = bulletsContainer;\n    _this.tooltip = new Tooltip();\n    _this.tooltip.virtualParent = _this;\n\n    _this._disposers.push(_this.tooltip);\n\n    _this.hiddenState.transitionEasing = $ease.cubicIn; // this data item holds sums, averages, etc\n\n    _this.dataItem = _this.createDataItem();\n\n    _this._disposers.push(_this.dataItem);\n\n    _this.dataItem.component = _this; // Apply accessibility\n\n    _this.role = \"group\";\n\n    _this.applyTheme();\n\n    return _this;\n  }\n  /**\r\n   * We need this here so that class names can be applied to bullets container.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Series.prototype.applyTheme = function () {\n    _super.prototype.applyTheme.call(this);\n\n    if (options.autoSetClassName && this.bulletsContainer) {\n      this.bulletsContainer.className = this.className + \"-bullets\";\n      this.bulletsContainer.setClassName();\n    }\n  };\n  /**\r\n   * Sets defaults that instantiate some objects that rely on parent, so they\r\n   * cannot be set in constructor.\r\n   */\n\n\n  Series.prototype.applyInternalDefaults = function () {\n    _super.prototype.applyInternalDefaults.call(this);\n\n    if (!$type.hasValue(this.readerTitle)) {\n      this.readerTitle = this.language.translate(\"Series\");\n    }\n  };\n  /**\r\n   * Returns a new/empty DataItem of the type appropriate for this object.\r\n   *\r\n   * @see {@link DataItem}\r\n   * @return Data Item\r\n   */\n\n\n  Series.prototype.createDataItem = function () {\n    return new SeriesDataItem();\n  };\n\n  Object.defineProperty(Series.prototype, \"chart\", {\n    /**\r\n     * @return Chart\r\n     */\n    get: function get() {\n      return this._chart;\n    },\n\n    /**\r\n     * Chart series is used on.\r\n     *\r\n     * @param value  Chart\r\n     */\n    set: function set(value) {\n      this._chart = value;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Positions bullet.\r\n   *\r\n   * @param bullet  Sprite\r\n   */\n\n  Series.prototype.positionBullet = function (bullet) {// Placeholder method for extending classes to override.\n  };\n  /**\r\n   * Decorates newly created bullet after it has been instert into the list.\r\n   *\r\n   * @param event  List event\r\n   * @todo investigate why itemReaderText is undefined\r\n   */\n\n\n  Series.prototype.processBullet = function (event) {\n    var _this = this;\n\n    var bullet = event.newValue;\n    bullet.isTemplate = true; // Add accessibility options to bullet\n    // If there are relatively few bullets, make them focusable\n\n    this.events.once(\"datavalidated\", function (ev) {\n      if (_this.itemsFocusable()) {\n        bullet.focusable = true;\n      }\n    });\n    this.invalidate();\n  };\n  /**\r\n   * removes bullets\r\n   *\r\n   * @param event  List event\r\n   */\n\n\n  Series.prototype.removeBullet = function (event) {\n    var bullet = event.oldValue;\n    this.dataItems.each(function (dataItem) {\n      var eachBullet = dataItem.bullets.getKey(bullet.uid);\n\n      if (eachBullet) {\n        eachBullet.dispose();\n      }\n    });\n    this.invalidate();\n  };\n  /**\r\n   * Validates data items.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Series.prototype.validateDataItems = function () {\n    _super.prototype.validateDataItems.call(this);\n\n    this.processValues(false);\n  };\n  /**\r\n   * Returns first value for the specific key in the series.\r\n   *\r\n   * @param key  Key\r\n   * @return Value\r\n   * @todo Description\r\n   * @todo Convert to propert object property iterator\r\n   */\n\n\n  Series.prototype.getFirstValue = function (key, startIndex) {\n    // find first\n\n    /*\r\n    return $iter.findMap(this.dataItems.iterator(), (dataItem) => {\r\n        for (let key in dataItem.values) {\r\n            if ($object.hasKey(dataItem.values, key)) {\r\n                let value: number = dataItem.values[key].workingValue;\r\n                if ($type.isNumber(value)) {\r\n                    return value;\r\n                }\r\n            }\r\n        }\r\n          return null;\r\n    });*/\n    //if (startIndex > 0 && startIndex < this.dataItems.length - 1) {\n    //startIndex++;\n    //}\n    for (var i = startIndex; i >= 0; i--) {\n      var dataItem = this.dataItems.getIndex(i);\n      var value = dataItem.getActualWorkingValue(key);\n\n      if ($type.isNumber(value)) {\n        return value;\n      }\n    }\n\n    return null;\n  };\n  /**\r\n   * Returns first value for the specific key in the series.\r\n   *\r\n   * @param key  Key\r\n   * @return Value\r\n   * @todo Description\r\n   * @todo Convert to propert object property iterator\r\n   */\n\n\n  Series.prototype.getAbsoluteFirstValue = function (key) {\n    for (var i = 0; i < this.dataItems.length; i++) {\n      var dataItem = this.dataItems.getIndex(i);\n      var value = dataItem.values[key].value;\n\n      if ($type.isNumber(value)) {\n        return value;\n      }\n    }\n\n    return null;\n  };\n  /**\r\n   * [rangeChangeUpdate description]\r\n   *\r\n   * @todo Description\r\n   */\n\n\n  Series.prototype.rangeChangeUpdate = function () {\n    _super.prototype.rangeChangeUpdate.call(this);\n\n    this.processValues(true);\n  };\n  /**\r\n   * [processValues description]\r\n   *\r\n   * @todo Description\r\n   * @todo Convert to propert object property iterator\r\n   * @param dataItems [description]\r\n   */\n\n\n  Series.prototype.processValues = function (working) {\n    var _this = this;\n\n    if (!this.simplifiedProcessing) {\n      var dataItems = this.dataItems;\n      var count_1 = {};\n      var sum_1 = {};\n      var absoluteSum_1 = {};\n      var low_1 = {};\n      var high_1 = {};\n      var open_1 = {};\n      var close_1 = {};\n      var previous_1 = {};\n      var first_1 = {};\n      var absoluteFirst_1 = {}; //let duration: number = 0; // todo: check if series uses selection.change or selection.change.percent and set duration to interpolationduration\n\n      var startIndex_1 = $math.max(0, this.startIndex);\n      startIndex_1 = $math.min(startIndex_1, this.dataItems.length);\n      var endIndex = $math.min(this.endIndex, this.dataItems.length);\n\n      if (!$type.isNumber(startIndex_1)) {\n        startIndex_1 = 0;\n      }\n\n      if (!$type.isNumber(endIndex)) {\n        endIndex = this.dataItems.length;\n      }\n\n      if (startIndex_1 > 0) {\n        var dataItem_1 = dataItems.getIndex(startIndex_1 - 1);\n        $object.each(dataItem_1.values, function (key, values) {\n          var value = dataItem_1.getActualWorkingValue(key);\n\n          if ($type.isNumber(value)) {\n            // save previous\n            previous_1[key] = value;\n          }\n        });\n      }\n\n      var _loop_1 = function _loop_1(i) {\n        var dataItem_2 = dataItems.getIndex(i);\n        $object.each(dataItem_2.values, function (key, values) {\n          var value = dataItem_2.getActualWorkingValue(key); //if (i >= startIndex && i <= endIndex) { // do not add to count, sum etc if it is not within start/end index\n\n          if ($type.isNumber(value)) {\n            // count values\n            if (!$type.isNumber(count_1[key])) {\n              count_1[key] = 0;\n            }\n\n            count_1[key]++; // sum values\n\n            if (!$type.isNumber(sum_1[key])) {\n              sum_1[key] = 0;\n            }\n\n            sum_1[key] += value; // absolute sum values\n\n            if (!$type.isNumber(absoluteSum_1[key])) {\n              absoluteSum_1[key] = 0;\n            }\n\n            absoluteSum_1[key] += Math.abs(value); // open\n\n            if (!$type.isNumber(open_1[key])) {\n              open_1[key] = value;\n            } // close\n\n\n            close_1[key] = value; // low\n\n            if (!$type.isNumber(low_1[key])) {\n              low_1[key] = value;\n            } else {\n              if (low_1[key] > value) {\n                low_1[key] = value;\n              }\n            } // high\n\n\n            if (!$type.isNumber(high_1[key])) {\n              high_1[key] = value;\n            } else {\n              if (high_1[key] < value) {\n                high_1[key] = value;\n              }\n            }\n\n            if (!$type.isNumber(first_1[key])) {\n              first_1[key] = _this.getFirstValue(key, startIndex_1);\n            }\n\n            if (!$type.isNumber(absoluteFirst_1[key])) {\n              absoluteFirst_1[key] = _this.getAbsoluteFirstValue(key);\n            } // change\n\n\n            dataItem_2.setCalculatedValue(key, value - first_1[key], \"change\"); // change from start percent\n            // will fail if first value is 0\n\n            dataItem_2.setCalculatedValue(key, (value - first_1[key]) / first_1[key] * 100, \"changePercent\");\n            dataItem_2.setCalculatedValue(key, value - absoluteFirst_1[key], \"startChange\");\n            dataItem_2.setCalculatedValue(key, (value - absoluteFirst_1[key]) / absoluteFirst_1[key] * 100, \"startChangePercent\"); // previous change\n\n            var prevValue = previous_1[key];\n\n            if (!$type.isNumber(prevValue)) {\n              prevValue = value;\n            }\n\n            dataItem_2.setCalculatedValue(key, value - prevValue, \"previousChange\"); // previous change percent\n\n            dataItem_2.setCalculatedValue(key, (value - prevValue) / prevValue * 100, \"previousChangePercent\"); // save previous\n\n            previous_1[key] = value;\n          }\n        });\n      };\n\n      for (var i = startIndex_1; i < endIndex; i++) {\n        _loop_1(i);\n      }\n\n      if (this.calculatePercent) {\n        var _loop_2 = function _loop_2(i) {\n          var dataItem_3 = dataItems.getIndex(i);\n          $object.each(dataItem_3.values, function (key) {\n            var ksum = absoluteSum_1[key];\n            var value = dataItem_3.getActualWorkingValue(key);\n\n            if ($type.isNumber(value)) {\n              if (ksum > 0) {\n                if (_this.usePercentHack) {\n                  // this hack is made in order to make it possible to animate single slice to 0\n                  // if there is only one slice left, percent value is always 100%, so it won't animate\n                  // so we use real value of a slice instead of current value\n                  if (value == ksum) {\n                    ksum = dataItem_3.values[key].value;\n                  }\n                }\n\n                var percent = value / ksum * 100;\n                dataItem_3.setCalculatedValue(key, percent, \"percent\");\n              } else {\n                dataItem_3.setCalculatedValue(key, 0, \"percent\");\n              }\n            }\n          });\n        };\n\n        for (var i = startIndex_1; i < endIndex; i++) {\n          _loop_2(i);\n        }\n      } // calculate one before first (cant do that in cycle, as we don't know open yet\n      // when drawing line chart we should draw line to the invisible data point to the left, otherwise the line will always look like it starts from the selected point\n      // so we do startIndex - 1\n\n\n      if (startIndex_1 > 0) {\n        var zeroItem_1 = dataItems.getIndex(startIndex_1 - 1);\n        $object.each(zeroItem_1.values, function (key) {\n          var value = zeroItem_1.values[key].value; // change\n\n          zeroItem_1.setCalculatedValue(key, value - open_1[key], \"change\"); // change percent\n\n          zeroItem_1.setCalculatedValue(key, (value - open_1[key]) / open_1[key] * 100, \"changePercent\");\n        });\n      } // we save various data like sum, average to dataPoint of the series\n\n\n      var dataItem_4 = this.dataItem;\n      $object.each(dataItem_4.values, function (key) {\n        dataItem_4.setCalculatedValue(key, sum_1[key], \"sum\");\n        dataItem_4.setCalculatedValue(key, absoluteSum_1[key], \"absoluteSum\");\n        dataItem_4.setCalculatedValue(key, sum_1[key] / count_1[key], \"average\");\n        dataItem_4.setCalculatedValue(key, open_1[key], \"open\");\n        dataItem_4.setCalculatedValue(key, close_1[key], \"close\");\n        dataItem_4.setCalculatedValue(key, low_1[key], \"low\");\n        dataItem_4.setCalculatedValue(key, high_1[key], \"high\");\n        dataItem_4.setCalculatedValue(key, count_1[key], \"count\");\n      });\n    }\n  };\n  /**\r\n   * (Re)validates the whole series, effectively causing it to redraw.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Series.prototype.validate = function () {\n    if ($utils.isIE()) {\n      this.filters.clear();\n    }\n\n    $iter.each(this.axisRanges.iterator(), function (axisRange) {\n      //axisRange.contents.disposeChildren(); // not good for columns, as they are reused\n      //\t\t\taxisRange.appendChildren();\n      axisRange.validate();\n    });\n\n    _super.prototype.validate.call(this);\n\n    var bulletsContainer = this.bulletsContainer;\n    bulletsContainer.fill = this.fill;\n    bulletsContainer.stroke = this.stroke;\n    bulletsContainer.x = this.pixelX;\n    bulletsContainer.y = this.pixelY;\n\n    if (this.bulletsContainer.children.length > 0) {\n      if (this._showBullets) {\n        for (var i = 0; i < this.startIndex; i++) {\n          var dataItem = this.dataItems.getIndex(i);\n\n          if (dataItem) {\n            dataItem.bullets.each(function (key, bullet) {\n              bullet.__disabled = true;\n            });\n          }\n        }\n\n        for (var i = this.dataItems.length - 1; i > this.endIndex; i--) {\n          var dataItem = this.dataItems.getIndex(i);\n\n          if (dataItem) {\n            dataItem.bullets.each(function (key, bullet) {\n              bullet.__disabled = true;\n            });\n          }\n        }\n      } else {\n        this.bulletsContainer.children.each(function (bullet) {\n          bullet.__disabled = true;\n        });\n      }\n    }\n\n    this.updateTooltipBounds();\n  };\n  /**\r\n   * @ignore\r\n   */\n\n\n  Series.prototype.updateTooltipBounds = function () {\n    if (this.topParent) {\n      var x = 0;\n      var y = 0;\n      var w = this.topParent.maxWidth;\n      var h = this.topParent.maxHeight;\n      var rect = {\n        x: x,\n        y: y,\n        width: w,\n        height: h\n      };\n      this.tooltip.setBounds(rect);\n    }\n  };\n\n  Series.prototype.shouldCreateBullet = function (dataItem, bulletTemplate) {\n    return true;\n  };\n  /**\r\n   * Validates data item's element, effectively redrawing it.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param dataItem  Data item\r\n   */\n\n\n  Series.prototype.validateDataElement = function (dataItem) {\n    var _this = this;\n\n    _super.prototype.validateDataElement.call(this, dataItem);\n\n    if (this._showBullets) {\n      if (!this.isHidden) {\n        this.bulletsContainer.visible = true;\n      }\n\n      this.bullets.each(function (bulletTemplate) {\n        // always better to use the same, this helps to avoid redrawing\n        var bullet = dataItem.bullets.getKey(bulletTemplate.uid);\n\n        if (_this.shouldCreateBullet(dataItem, bulletTemplate)) {\n          if (!bullet) {\n            var disabledField = bulletTemplate.propertyFields.disabled;\n            var dataContext = dataItem.dataContext;\n\n            if (disabledField && dataContext && dataContext[disabledField] === false) {\n              bulletTemplate.applyOnClones = false;\n              bulletTemplate.disabled = false;\n              bullet = bulletTemplate.clone();\n              bulletTemplate.disabled = true;\n              bulletTemplate.applyOnClones = true;\n            } else {\n              bullet = bulletTemplate.clone();\n            }\n\n            bullet.shouldClone = false;\n            dataItem.addSprite(bullet);\n\n            if (!_this.visible || _this.isHiding) {\n              bullet.hide(0);\n            }\n          }\n\n          var currentDataItem = bullet.dataItem;\n\n          if (currentDataItem != dataItem) {\n            // set to undefined in order not to reuse\n            if (currentDataItem) {\n              currentDataItem.bullets.setKey(bulletTemplate.uid, undefined);\n            }\n\n            var readerText_1 = _this.itemReaderText;\n\n            if (bullet instanceof Bullet) {\n              if (!readerText_1) {\n                readerText_1 = \"{\" + bullet.xField + \"}: {\" + bullet.yField + \"}\";\n              }\n\n              if (bullet.isDynamic) {\n                dataItem.events.on(\"workingvaluechanged\", bullet.deepInvalidate, bullet, false); //dataItem.events.on(\"calculatedvaluechanged\", bullet.deepInvalidate, bullet, false);\n\n                _this.dataItem.events.on(\"workingvaluechanged\", bullet.deepInvalidate, bullet, false);\n              }\n\n              bullet.deepInvalidate();\n            } // Add accessibility to bullet\n\n\n            if (bullet.focusable) {\n              bullet.events.on(\"focus\", function (ev) {\n                bullet.readerTitle = _this.populateString(readerText_1, bullet.dataItem);\n              }, undefined, false);\n              bullet.events.on(\"blur\", function (ev) {\n                bullet.readerTitle = \"\";\n              }, undefined, false);\n            }\n\n            if (bullet.hoverable) {\n              bullet.events.on(\"over\", function (ev) {\n                bullet.readerTitle = _this.populateString(readerText_1, bullet.dataItem);\n              }, undefined, false);\n              bullet.events.on(\"out\", function (ev) {\n                bullet.readerTitle = \"\";\n              }, undefined, false);\n            }\n          }\n\n          bullet.parent = _this.bulletsContainer;\n          dataItem.bullets.setKey(bulletTemplate.uid, bullet); // pass max w/h so we'd know if we should show/hide somethings\n\n          bullet.maxWidth = dataItem.itemWidth;\n          bullet.maxHeight = dataItem.itemHeight;\n          bullet.__disabled = false;\n\n          _this.positionBullet(bullet);\n        } else {\n          if (bullet) {\n            bullet.__disabled = true;\n          }\n        }\n      });\n    } else {\n      this.bulletsContainer.visible = false;\n    }\n  };\n  /**\r\n   * [handleDataItemWorkingValueChange description]\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Series.prototype.handleDataItemWorkingValueChange = function (dataItem, name) {\n    if (!this.dataRangeInvalid) {\n      this.invalidateProcessedData();\n    }\n  };\n\n  Object.defineProperty(Series.prototype, \"ignoreMinMax\", {\n    /**\r\n     * @return Exclude from calculations?\r\n     */\n    get: function get() {\n      return this._ignoreMinMax;\n    },\n\n    /**\r\n     * Should this series excluded from the axis scale calculations?\r\n     *\r\n     * @default false\r\n     * @param value  Exclude from calculations?\r\n     */\n    set: function set(value) {\n      this._ignoreMinMax = value;\n      this.invalidateDataItems();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Create a mask for the series.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n  Series.prototype.createMask = function () {// A placeholder method for extending classes to override.\n  };\n  /**\r\n   * Process axis range after it has been added to the list.\r\n   *\r\n   * @param event  Event\r\n   */\n\n\n  Series.prototype.processAxisRange = function (event) {\n    // create container if not existing\n    if (!this.rangesContainer) {\n      this.rangesContainer = this.createChild(Container);\n      this.rangesContainer.shouldClone = false;\n      this.rangesContainer.isMeasured = false;\n    }\n\n    var axisRange = event.newValue;\n\n    if (axisRange) {\n      axisRange.contents.parent = this.rangesContainer;\n      axisRange.isRange = true;\n      axisRange.events.on(\"valuechanged\", this.invalidateDataItems, this, false);\n    }\n  };\n  /**\r\n   * [getAxisField description]\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @todo Description\r\n   * @param axis  [description]\r\n   * @return [description]\r\n   */\n\n\n  Series.prototype.getAxisField = function (axis) {\n    return;\n  };\n  /**\r\n   * Shows the tooltip at specific position.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param xPosition  X\r\n   * @param yPosition  Y\r\n   */\n\n\n  Series.prototype.showTooltipAtPosition = function (xPosition, yPosition) {// Placeholder method for extending classes to override.\n  };\n\n  Object.defineProperty(Series.prototype, \"minBulletDistance\", {\n    /**\r\n     * @return Distance (px)\r\n     */\n    get: function get() {\n      return this.getPropertyValue(\"minBulletDistance\");\n    },\n\n    /**\r\n     * Minimal distance between data points in pixels.\r\n     *\r\n     * If distance gets smaller than this, bullets are turned off to avoid\r\n     * overlapping.\r\n     *\r\n     * `0` (zero) disables this behavior.\r\n     *\r\n     * IMPORTANT: This setting will work only when Series' base axis\r\n     * is [[CategoryAxis]] or [[DateAxis]]. If base axis is [[ValueAxis]] the\r\n     * setting will be ignored, because it would be a huge overhead to measure\r\n     * distance between each and every bullet.\r\n     *\r\n     * @default 0\r\n     * @param value  Distance (px)\r\n     */\n    set: function set(value) {\n      this.setPropertyValue(\"minBulletDistance\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Series.prototype, \"bullets\", {\n    /**\r\n     * A list of bullets that will be added to each and every items in the\r\n     * series.\r\n     *\r\n     * You can push any object that is a descendant of a [[Sprite]] here. All\r\n     * items added to this list will be copied and used as a bullet on all data\r\n     * items, including their properties, events, etc.\r\n     *\r\n     * @see {@link https://www.amcharts.com/docs/v4/concepts/bullets/} for more info about the concept of Bullets\r\n     * @return List of bullets.\r\n     */\n    get: function get() {\n      if (!this._bullets) {\n        this._bullets = new ListTemplate(new Bullet());\n        this._bullets.template.virtualParent = this;\n\n        this._bullets.events.on(\"inserted\", this.processBullet, this, false);\n\n        this._bullets.events.on(\"removed\", this.removeBullet, this, false);\n\n        this._disposers.push(new ListDisposer(this._bullets));\n\n        this._disposers.push(this._bullets.template);\n      }\n\n      return this._bullets;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Binds related legend data item's visual settings to this series' visual\r\n   * settings.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param marker  Legend item container\r\n   */\n\n  Series.prototype.createLegendMarker = function (marker) {// This is a placeholder method for extending classes to override.\n  };\n\n  Object.defineProperty(Series.prototype, \"hiddenInLegend\", {\n    /**\r\n     * @return Hidden in legend?\r\n     */\n    get: function get() {\n      return this.getPropertyValue(\"hiddenInLegend\");\n    },\n\n    /**\r\n     * Should the series be hidden in legend?\r\n     *\r\n     * @param value Hidden in legend?\r\n     */\n    set: function set(value) {\n      if (this.setPropertyValue(\"hiddenInLegend\", value)) {\n        if (this.chart) {\n          this.chart.feedLegend();\n        }\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Series.prototype, \"name\", {\n    /**\r\n     * @return Name\r\n     */\n    get: function get() {\n      return this.getPropertyValue(\"name\");\n    },\n\n    /**\r\n     * Series' name.\r\n     *\r\n     * @param value  Name\r\n     */\n    set: function set(value) {\n      this.setPropertyValue(\"name\", value);\n      var legendDataItem = this.legendDataItem;\n\n      if (legendDataItem) {\n        legendDataItem.component.invalidate();\n        legendDataItem.component.invalidateRawData();\n      }\n\n      this.readerTitle = value;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Series.prototype, \"itemReaderText\", {\n    /**\r\n     * @return Screen reader text template\r\n     */\n    get: function get() {\n      // Get explicitly set reader text\n      var readerText = this._itemReaderText; // Not set? Let's try something else\n\n      if (!readerText) {\n        // Tooltip text?\n        if (this.tooltipText) {\n          readerText = $utils.plainText(this.tooltipText);\n        } else if (this.tooltipHTML) {\n          readerText = $utils.plainText(this.tooltipHTML);\n        }\n      }\n\n      if (!this._adapterO) {\n        return readerText;\n      } else {\n        return this._adapterO.apply(\"itemReaderText\", readerText);\n      }\n    },\n\n    /**\r\n     * Screen reader text to be applied to each individual data item, such\r\n     * as bullets, columns or slices.\r\n     *\r\n     * The template can contain field reference meta codes, i.e. `{dateX}`,\r\n     * `{valueY}`, etc.\r\n     *\r\n     * Any text formatting options, e.g. `[bold]` will be ignored.\r\n     *\r\n     * @param value Screen reader text template\r\n     */\n    set: function set(value) {\n      this._itemReaderText = value;\n      this._itemReaderTextChanged = true;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Returns if number of data items in the series are beyond non-focusable\r\n   * count and should not be available for TAB-through.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @return Items focusable?\r\n   */\n\n  Series.prototype.itemsFocusable = function () {\n    return this.dataItems.length >= this.skipFocusThreshold ? false : true;\n  };\n\n  Object.defineProperty(Series.prototype, \"legendDataItem\", {\n    /**\r\n     * @return Data item\r\n     */\n    get: function get() {\n      return this._legendDataItem;\n    },\n\n    /**\r\n     * Legend data item that corresponds to this series.\r\n     *\r\n     * @param value  Data item\r\n     */\n    set: function set(value) {\n      this._legendDataItem = value;\n\n      this._legendDataItem.itemContainer.deepInvalidate();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Updates corresponding legend data item with current values.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param dataItem  Data item\r\n   */\n\n  Series.prototype.updateLegendValue = function (dataItem, notRange) {\n    // if this series has legend item\n    if (this.legendDataItem) {\n      var legendSettings = this.legendSettings;\n      var legendDataItem = this.legendDataItem;\n      var label = legendDataItem.label;\n      var valueLabel = legendDataItem.valueLabel; // update legend\n\n      if (dataItem && !dataItem.isDisposed() || notRange) {\n        if (valueLabel) {\n          if (legendSettings.itemValueText) {\n            valueLabel.text = legendSettings.itemValueText;\n          }\n\n          valueLabel.dataItem = dataItem;\n        }\n\n        if (label) {\n          if (legendSettings.itemLabelText) {\n            label.text = legendSettings.itemLabelText;\n          }\n\n          label.dataItem = dataItem;\n        }\n      } else {\n        if (label) {\n          // if itemLabelText is set, means we have to reset label even if labelText is not set\n          if (legendSettings.labelText || legendSettings.itemLabelText != undefined) {\n            label.text = legendSettings.labelText;\n          }\n\n          label.dataItem = this.dataItem;\n        }\n\n        if (valueLabel) {\n          if (legendSettings.valueText || legendSettings.itemValueText != undefined) {\n            valueLabel.text = legendSettings.valueText;\n          }\n\n          valueLabel.dataItem = this.dataItem;\n        }\n      }\n    }\n  };\n  /**\r\n   * Copies all properties from another instance of [[Series]].\r\n   *\r\n   * @param source  Source series\r\n   */\n\n\n  Series.prototype.copyFrom = function (source) {\n    this.bullets.copyFrom(source.bullets);\n    this.bulletsContainer.copyFrom(source.bulletsContainer);\n    this.calculatePercent = source.calculatePercent;\n    this.usePercentHack = source.usePercentHack;\n    this.simplifiedProcessing = source.simplifiedProcessing;\n\n    _super.prototype.copyFrom.call(this, source);\n  };\n  /**\r\n   * Displays a modal or console message with error, and halts any further\r\n   * processing of this element.\r\n   *\r\n   * @param e Error\r\n   */\n\n\n  Series.prototype.raiseCriticalError = function (e) {\n    if (this._chart && this._chart.modal) {\n      this._chart.modal.content = this._chart.adapter.apply(\"criticalError\", e).message;\n      this._chart.modal.closable = false;\n\n      if (!options.suppressErrors) {\n        this._chart.modal.open();\n      }\n\n      this._chart.disabled = true;\n    }\n\n    if (options.verbose) {\n      console.log(e);\n    }\n  };\n  /**\r\n   * Applies filters to the element.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  Series.prototype.applyFilters = function () {\n    var _this = this;\n\n    _super.prototype.applyFilters.call(this);\n\n    this.bulletsContainer.filters.clear(); // copyFrom of a list copies, does not clone\n\n    $iter.each(this.filters.iterator(), function (filter) {\n      _this.bulletsContainer.filters.push(filter.clone());\n    });\n  };\n\n  Object.defineProperty(Series.prototype, \"heatRules\", {\n    /**\r\n     * A list of heat rules to apply to series' elements based on the value\r\n     * of the data item.\r\n     *\r\n     * Heat rules can be any \"numeric\" (including `Color`) property, and can also\r\n     * be applied to child objects of series, like columns, bullets, etc.\r\n     *\r\n     * E.g.:\r\n     *\r\n     * ```TypeScript\r\n     * series.heatRules.push({\r\n     *  \"target\": series.columns.template,\r\n     *  \"property\": \"fill\",\r\n     *  \"min\": am4core.color(\"#F5DBCB\"),\r\n     *  \"max\": am4core.color(\"#ED7B84\"),\r\n     *  \"dataField\": \"valueY\"\r\n     *});\r\n     *```\r\n     * ```Javacript\r\n     * series.heatRules.push({\r\n     *  \"target\": series.columns.template,\r\n     *  \"property\": \"fill\",\r\n     *  \"min\": am4core.color(\"#F5DBCB\"),\r\n     *  \"max\": am4core.color(\"#ED7B84\"),\r\n     *  \"dataField\": \"valueY\"\r\n     *});\r\n     *```\r\n     *```JSON\r\n     *{\r\n     *  // ...\r\n     *  \"series\": [{\r\n     *    \"type\": \"ColumnSeries\",\r\n     *    \"heatRules\": [{\r\n     *      \"target\": \"columns.template\",\r\n     *      \"property\": \"fill\",\r\n     *      \"min\": \"#F5DBCB\",\r\n     *      \"max\": \"#ED7B84\",\r\n     *      \"dataField\": \"valueY\"\r\n     *    }]\r\n     *  }]\r\n     *}\r\n     *```\r\n     *\r\n     * @see {@link https://www.amcharts.com/docs/v4/concepts/series/#Heat_maps} for more about heat rules\r\n     * @return  Heat rules\r\n     */\n    get: function get() {\n      var _this = this;\n\n      if (!this._heatRules) {\n        this._heatRules = new List();\n\n        this._heatRules.events.on(\"inserted\", function (event) {\n          var heatRule = event.newValue;\n          var target = heatRule.target;\n\n          if (target) {\n            var dataField_1 = heatRule.dataField;\n\n            if (!$type.hasValue(dataField_1)) {\n              dataField_1 = \"value\";\n            }\n\n            var seriesDataItem_1 = _this.dataItem;\n            var property_1 = heatRule.property;\n            var minValue = $type.toNumber(heatRule.minValue);\n            var maxValue = $type.toNumber(heatRule.maxValue);\n\n            if (!$type.isNumber(minValue) && !$type.isNumber(maxValue)) {\n              _this.dataItem.events.on(\"calculatedvaluechanged\", function (event) {\n                if (event.property == dataField_1) {\n                  $iter.each(_this.dataItems.iterator(), function (dataItem) {\n                    var foundSprite = false;\n                    $array.each(dataItem.sprites, function (sprite) {\n                      if (sprite.clonedFrom == target) {\n                        var anySprite = sprite;\n                        anySprite[property_1] = anySprite[property_1];\n                        foundSprite = true;\n                      }\n                    });\n\n                    if (!foundSprite) {\n                      $array.each(dataItem.sprites, function (sprite) {\n                        if (sprite instanceof Container) {\n                          $iter.each(sprite.children.iterator(), function (child) {\n                            if (child.className == target.className) {\n                              var anyChild = child;\n                              anyChild[property_1] = anyChild[property_1];\n                            } // giveup here\n                            else if (child instanceof Container) {\n                              child.deepInvalidate();\n                            }\n                          });\n                        }\n                      });\n                    }\n                  });\n                }\n              });\n            }\n\n            _this.dataItems.template.events.on(\"workingvaluechanged\", function (event) {\n              if (event.property == dataField_1) {\n                var dataItem = event.target;\n                var foundSprite_1 = false;\n                $array.each(dataItem.sprites, function (sprite) {\n                  if (sprite.clonedFrom == target) {\n                    var anySprite = sprite;\n                    anySprite[property_1] = anySprite[property_1];\n                    foundSprite_1 = true;\n                  }\n                });\n\n                if (!foundSprite_1) {\n                  $array.each(dataItem.sprites, function (sprite) {\n                    if (sprite instanceof Container) {\n                      $iter.each(sprite.children.iterator(), function (child) {\n                        if (child.className == target.className) {\n                          var anyChild = child;\n                          anyChild[property_1] = anyChild[property_1];\n                        } // givup here\n                        else if (child instanceof Container) {\n                          child.deepInvalidate();\n                        }\n                      });\n                    }\n                  });\n                }\n              }\n            });\n\n            target.adapter.add(property_1, function (value, ruleTarget, property) {\n              var minValue = $type.toNumber(heatRule.minValue);\n              var maxValue = $type.toNumber(heatRule.maxValue);\n              var min = heatRule.min;\n              var max = heatRule.max;\n\n              if (ruleTarget instanceof Sprite) {\n                var anySprite = ruleTarget;\n                var propertyField = anySprite.propertyFields[property];\n\n                if (propertyField && ruleTarget.dataItem) {\n                  var dataContext = ruleTarget.dataItem.dataContext;\n\n                  if (dataContext && $type.hasValue(dataContext[propertyField])) {\n                    return value;\n                  }\n                }\n              }\n\n              var dataItem = ruleTarget.dataItem;\n\n              if (!$type.isNumber(minValue)) {\n                minValue = seriesDataItem_1.values[dataField_1].low;\n              }\n\n              if (!$type.isNumber(maxValue)) {\n                maxValue = seriesDataItem_1.values[dataField_1].high;\n              }\n\n              if (dataItem) {\n                var fieldValues = dataItem.values[dataField_1];\n\n                if (fieldValues) {\n                  var workingValue = dataItem.getActualWorkingValue(dataField_1);\n\n                  if ($type.hasValue(min) && $type.hasValue(max) && $type.isNumber(minValue) && $type.isNumber(maxValue) && $type.isNumber(workingValue)) {\n                    var percent = void 0;\n\n                    if (heatRule.logarithmic) {\n                      percent = (Math.log(workingValue) * Math.LOG10E - Math.log(minValue) * Math.LOG10E) / (Math.log(maxValue) * Math.LOG10E - Math.log(minValue) * Math.LOG10E);\n                    } else {\n                      percent = (workingValue - minValue) / (maxValue - minValue);\n                    }\n\n                    if ($type.isNumber(workingValue) && (!$type.isNumber(percent) || Math.abs(percent) == Infinity)) {\n                      percent = 0.5;\n                    } // fixes problems if all values are the same\n\n\n                    if ($type.isNumber(min)) {\n                      return min + (max - min) * percent;\n                    } else if (min instanceof Color) {\n                      return new Color($colors.interpolate(min.rgb, max.rgb, percent));\n                    }\n                  }\n                }\n              }\n\n              return value;\n            });\n          }\n        });\n      }\n\n      return this._heatRules;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Processes JSON-based config before it is applied to the object.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param config  Config\r\n   */\n\n  Series.prototype.processConfig = function (config) {\n    var heatRules;\n\n    if (config) {\n      // Set up bullets\n      if ($type.hasValue(config.bullets) && $type.isArray(config.bullets)) {\n        for (var i = 0, len = config.bullets.length; i < len; i++) {\n          var bullets = config.bullets[i];\n\n          if (!$type.hasValue(bullets.type)) {\n            bullets.type = \"Bullet\";\n          }\n        }\n      } // Let's take heatRules out of the config, so that we can process\n      // them later, when bullets are already there\n\n\n      if ($type.hasValue(config.heatRules) && $type.isArray(config.heatRules)) {\n        heatRules = config.heatRules;\n        delete config.heatRules;\n      }\n    }\n\n    _super.prototype.processConfig.call(this, config); // Process heat rules again, when all other elements are ready\n\n\n    if (heatRules) {\n      for (var i = 0, len = heatRules.length; i < len; i++) {\n        var rule = heatRules[i]; // Resolve target\n\n        var target = this;\n\n        if ($type.hasValue(rule.target) && $type.isString(rule.target)) {\n          // Check if we can find this element by id\n          if (this.map.hasKey(rule.target)) {\n            target = this.map.getKey(rule.target);\n          } else {\n            var parts = rule.target.split(\".\");\n\n            for (var x = 0; x < parts.length; x++) {\n              if (target instanceof List) {\n                var listitem = target.getIndex($type.toNumber(parts[x]));\n\n                if (!listitem) {\n                  target = target[parts[x]];\n                } else {\n                  target = listitem;\n                }\n              } else {\n                var maybeIndex = parts[x].match(/^(.*)\\[([0-9]+)\\]/);\n\n                if (maybeIndex) {\n                  if (target[maybeIndex[1]] instanceof List) {\n                    target = target[maybeIndex[1]].getIndex($type.toNumber(maybeIndex[2]));\n                  } else {\n                    target = target[maybeIndex[1]][$type.toNumber(maybeIndex[2])];\n                  }\n                } else {\n                  target = target[parts[x]];\n                }\n              }\n            }\n          }\n        }\n\n        rule.target = target; // Resolve colors and percents\n\n        if ($type.hasValue(rule.min)) {\n          rule.min = this.maybeColorOrPercent(rule.min);\n        }\n\n        if ($type.hasValue(rule.max)) {\n          rule.max = this.maybeColorOrPercent(rule.max);\n        }\n      }\n\n      _super.prototype.processConfig.call(this, {\n        heatRules: heatRules\n      });\n    }\n  };\n  /**\r\n   * Returns visibility value\r\n   * @ignore\r\n   */\n\n  /*\r\n      protected getVisibility(): boolean {\r\n          let hidden = this.getPropertyValue(\"hidden\");\r\n          if (hidden) {\r\n              return false;\r\n          }\r\n          else {\r\n              return super.getVisibility();\r\n          }\r\n      }*/\n\n  /**\r\n   * This function is used to sort element's JSON config properties, so that\r\n   * some properties that absolutely need to be processed last, can be put at\r\n   * the end.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param a  Element 1\r\n   * @param b  Element 2\r\n   * @return Sorting number\r\n   */\n\n\n  Series.prototype.configOrder = function (a, b) {\n    if (a == b) {\n      return 0;\n    } // Must come last\n    else if (a == \"heatRules\") {\n      return 1;\n    } else if (b == \"heatRules\") {\n      return -1;\n    } else {\n      return _super.prototype.configOrder.call(this, a, b);\n    }\n  };\n  /**\r\n   * Sets `visibility` property:\r\n   *\r\n   * * `true` - visible\r\n   * * `false` - hidden\r\n   *\r\n   * @param value  true - visible, false - hidden\r\n   * @return Current visibility\r\n   */\n\n\n  Series.prototype.setVisibility = function (value) {\n    _super.prototype.setVisibility.call(this, value);\n\n    this.bulletsContainer.visible = value;\n  };\n\n  return Series;\n}(Component);\n\nexport { Series };\n/**\r\n * Register class, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\n\nregistry.registeredClasses[\"Series\"] = Series;\nregistry.registeredClasses[\"SeriesDataItem\"] = SeriesDataItem;","map":{"version":3,"mappings":"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","names":["Component","Sprite","List","ListTemplate","ListDisposer","Dictionary","DictionaryDisposer","DataItem","Container","Tooltip","Bullet","LegendSettings","options","Color","registry","$iter","$math","$ease","$utils","$object","$type","$array","$colors","__extends","_super","_this","className","values","value","applyTheme","Object","SeriesDataItem","_bullets","_disposers","push","bullets","clear","dispose","call","setValue","constructor","Series","Error","isMeasured","layout","shouldClone","setPropertyValue","axisRanges","events","on","processAxisRange","minBulletDistance","mainContainer","createChild","mask","bulletsContainer","_shouldBeReady","virtualParent","tooltip","hiddenState","transitionEasing","cubicIn","dataItem","createDataItem","component","role","autoSetClassName","setClassName","applyInternalDefaults","hasValue","readerTitle","language","translate","_chart","bullet","event","newValue","isTemplate","once","ev","itemsFocusable","focusable","invalidate","oldValue","dataItems","each","eachBullet","getKey","uid","validateDataItems","processValues","key","startIndex","i","getIndex","getActualWorkingValue","isNumber","length","rangeChangeUpdate","working","simplifiedProcessing","count_1","sum_1","absoluteSum_1","low_1","high_1","open_1","close_1","previous_1","first_1","absoluteFirst_1","startIndex_1","max","min","endIndex","dataItem_1","dataItem_2","Math","abs","getFirstValue","getAbsoluteFirstValue","setCalculatedValue","prevValue","calculatePercent","dataItem_3","ksum","usePercentHack","percent","zeroItem_1","dataItem_4","isIE","filters","iterator","axisRange","validate","fill","stroke","x","pixelX","y","pixelY","children","_showBullets","__disabled","updateTooltipBounds","topParent","w","maxWidth","h","maxHeight","rect","width","height","setBounds","bulletTemplate","validateDataElement","isHidden","visible","shouldCreateBullet","disabledField","propertyFields","disabled","dataContext","applyOnClones","clone","addSprite","isHiding","hide","currentDataItem","setKey","undefined","readerText_1","itemReaderText","xField","yField","isDynamic","deepInvalidate","populateString","hoverable","parent","itemWidth","itemHeight","positionBullet","name","dataRangeInvalid","invalidateProcessedData","_ignoreMinMax","invalidateDataItems","rangesContainer","contents","isRange","axis","xPosition","yPosition","getPropertyValue","template","processBullet","removeBullet","marker","chart","feedLegend","legendDataItem","invalidateRawData","readerText","_itemReaderText","tooltipText","plainText","tooltipHTML","_adapterO","apply","_itemReaderTextChanged","skipFocusThreshold","_legendDataItem","itemContainer","notRange","legendSettings","label","valueLabel","isDisposed","itemValueText","text","itemLabelText","labelText","valueText","source","copyFrom","e","modal","content","adapter","message","closable","suppressErrors","open","verbose","console","log","applyFilters","filter","_heatRules","heatRule","target","dataField_1","dataField","seriesDataItem_1","property_1","property","minValue","toNumber","maxValue","foundSprite","sprites","sprite","clonedFrom","anySprite","child","anyChild","foundSprite_1","add","ruleTarget","propertyField","low","high","fieldValues","workingValue","logarithmic","LOG10E","Infinity","interpolate","rgb","config","heatRules","isArray","len","type","processConfig","rule","isString","map","hasKey","parts","split","listitem","maybeIndex","match","maybeColorOrPercent","a","b","configOrder","setVisibility","registeredClasses"],"sourceRoot":"","sources":["../../../../../src/.internal/charts/series/Series.ts"],"sourcesContent":["/**\r\n * Functionality for any series-based elements, like Line Series (graphs),\r\n * Pie slice lists, etc.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Component, IComponentProperties, IComponentDataFields, IComponentAdapters, IComponentEvents } from \"../../core/Component\";\r\nimport { AxisDataItem } from \"../axes/Axis\";\r\nimport { Sprite } from \"../../core/Sprite\";\r\nimport { List, ListTemplate, IListEvents, ListDisposer } from \"../../core/utils/List\";\r\nimport { Dictionary, DictionaryDisposer } from \"../../core/utils/Dictionary\";\r\nimport { DataItem } from \"../../core/DataItem\";\r\nimport { Container } from \"../../core/Container\";\r\nimport { SerialChart } from \"../types/SerialChart\";\r\nimport { Label } from \"../../core/elements/Label\";\r\nimport { Axis } from \"../axes/Axis\";\r\nimport { Tooltip } from \"../../core/elements/Tooltip\";\r\nimport { Bullet } from \"../elements/Bullet\";\r\nimport { LegendDataItem, LegendSettings } from \"../Legend\";\r\nimport { options } from \"../../core/Options\";\r\nimport { Ordering } from \"../../core/utils/Order\";\r\nimport { Color } from \"../../core/utils/Color\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport * as $iter from \"../../core/utils/Iterator\";\r\nimport * as $math from \"../../core/utils/Math\";\r\nimport * as $ease from \"../../core/utils/Ease\";\r\nimport * as $utils from \"../../core/utils/Utils\";\r\nimport * as $object from \"../../core/utils/Object\";\r\nimport * as $type from \"../../core/utils/Type\";\r\nimport * as $array from \"../../core/utils/Array\";\r\nimport * as $colors from \"../../core/utils/Colors\";\r\n\r\nexport interface IHeatRule {\r\n\ttarget: Sprite;\r\n\tproperty: string;\r\n\tmin: any;\r\n\tmax: any;\r\n\tdataField?: string;\r\n\tminValue?: number;\r\n\tmaxValue?: number;\r\n\tlogarithmic?: boolean;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines a [[DataItem]] for [[Series]].\r\n *\r\n * @see {@link DataItem}\r\n */\r\nexport class SeriesDataItem extends DataItem {\r\n\r\n\t/**\r\n\t * Related item's width in pixels.\r\n\t *\r\n\t * This is passed to bullets so that we'd know if the bullet (LabelBullet)\r\n\t * fits to max width/height.\r\n\t *\r\n\t * At the moment this is only used by column series.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic itemWidth: number;\r\n\r\n\t/**\r\n\t * Related item's height in pixels.\r\n\t *\r\n\t * This is passed to bullets so that we'd know if the bullet (LabelBullet)\r\n\t * fits to max width/height.\r\n\t *\r\n\t * At the moment this is only used by column series.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic itemHeight: number;\r\n\r\n\t/**\r\n\t * A dictionary of data items bullets, where key is uid of a bullet template.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _bullets: Dictionary<string, Sprite>;\r\n\r\n\t/**\r\n\t * Defines a type of [[Component]] this data item is used for.\r\n\t */\r\n\tpublic _component!: Series;\r\n\r\n\t/**\r\n\t * A dictionary of data items bullets, where key is uid of a bullet template.\r\n\t */\r\n\tpublic get bullets(): Dictionary<string, Sprite> {\r\n\t\tif (!this._bullets) {\r\n\t\t\tthis._bullets = new Dictionary<string, Sprite>();\r\n\t\t\tthis._disposers.push(new DictionaryDisposer(this._bullets));\r\n\t\t}\r\n\t\treturn this._bullets;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"SeriesDataItem\";\r\n\t\t//@todo Should we make `bullets` list disposable?\r\n\t\t//this._disposers.push(new DictionaryDisposer(this.bullets));\r\n\r\n\t\tthis.values.value = {};\r\n\t\tthis.values.value = {};\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys this object and all related data.\r\n\t */\r\n\tpublic dispose() {\r\n\t\tthis.bullets.clear();\r\n\t\tsuper.dispose();\r\n\t}\r\n\r\n\t/**\r\n\t * data items's numeric value.\r\n\t *\r\n\t * @param value  Value\r\n\t */\r\n\tpublic set value(value: number) {\r\n\t\tthis.setValue(\"value\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Value\r\n\t */\r\n\tpublic get value(): number {\r\n\t\treturn this.values.value.value;\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines data fields for [[Series]].\r\n */\r\nexport interface ISeriesDataFields extends IComponentDataFields {\r\n\t/**\r\n\t * Name of the field in data that holds numeric value.\r\n\t */\r\n\tvalue?: string;\r\n\r\n\t/**\r\n\t * Name of the field in data that holds boolean flag if item should be hidden.\r\n\t */\r\n\thidden?: string;\r\n}\r\n\r\n/**\r\n * Defines properties for [[Series]].\r\n */\r\nexport interface ISeriesProperties extends IComponentProperties {\r\n\r\n\t/**\r\n\t * Minimal distance between data points in pixels.\r\n\t *\r\n\t * If distance gets smaller than this, bullets are turned off to avoid\r\n\t * overlapping.\r\n\t *\r\n\t * `0` (zero) disables this behavior.\r\n\t *\r\n\t * @default 0\r\n\t */\r\n\tminBulletDistance?: number;\r\n\r\n\t/**\r\n\t * Should series be hidden in chart's legend?\r\n\t */\r\n\thiddenInLegend?: boolean;\r\n\r\n\t/**\r\n\t * Series' name.\r\n\t */\r\n\tname?: string;\r\n}\r\n\r\n/**\r\n * Defines events for [[Series]].\r\n */\r\nexport interface ISeriesEvents extends IComponentEvents {\r\n\r\n\t/**\r\n\t * @todo Description\r\n\t */\r\n\tselectionextremeschanged: {};\r\n\r\n\t/**\r\n\t * @todo Description\r\n\t */\r\n\textremeschanged: {};\r\n\r\n\t/**\r\n\t * @todo Description\r\n\t */\r\n\tdataitemchanged: {\r\n\t\tdataItem: DataItem\r\n\t};\r\n\r\n}\r\n\r\n/**\r\n * Defines adapters for [[Series]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface ISeriesAdapters extends IComponentAdapters, ISeriesProperties {\r\n\t/**\r\n\t * Applied to the name used by screen readers.\r\n\t */\r\n\titemReaderText: string\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines base class for any kind of serial data.\r\n *\r\n * @see {@link ISeriesEvents} for a list of available Events\r\n * @see {@link ISeriesAdapters} for a list of available Adapters\r\n * @todo Separate axis-related stuff to some other class so that MapSeries would not have unrelated stuff\r\n */\r\nexport class Series extends Component {\r\n\r\n\t/**\r\n\t * Defines the type of data fields used for the series.\r\n\t */\r\n\tpublic _dataFields: ISeriesDataFields;\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: ISeriesProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: ISeriesAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: ISeriesEvents;\r\n\r\n\t/**\r\n\t * Defines a type of data item used for the series.\r\n\t */\r\n\tpublic _dataItem: SeriesDataItem;\r\n\r\n\t/**\r\n\t * A reference to the legend data item related to this series.\r\n\t */\r\n\tprotected _legendDataItem: LegendDataItem;\r\n\r\n\t/**\r\n\t * Should this series excluded from the axis scale calculations?\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tprotected _ignoreMinMax: boolean = false;\r\n\r\n\t/**\r\n\t * Container series' elements are placed in.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic mainContainer: Container;\r\n\r\n\t/**\r\n\t * Should series' bullets?\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tprotected _showBullets: boolean = true;\r\n\r\n\t/**\r\n\t * List of series' bullets.\r\n\t */\r\n\tprotected _bullets: ListTemplate<Sprite>;\r\n\r\n\t/**\r\n\t * Container bullets are placed in.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic bulletsContainer: Container;\r\n\r\n\t/**\r\n\t * A chart series belongs to.\r\n\t */\r\n\tpublic _chart: SerialChart;\r\n\r\n\t/**\r\n\t * A container axis ranges are placed in.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic rangesContainer: Container;\r\n\r\n\t/**\r\n\t * A list of axis ranges for this series.\r\n\t */\r\n\tpublic axisRanges: List<AxisDataItem>;\r\n\r\n\t/**\r\n\t * Settings for the appearance of the related legend items.\r\n\t */\r\n\tpublic legendSettings: LegendSettings = new LegendSettings();\r\n\r\n\t/**\r\n\t * Lowest overal values by type.\r\n\t */\r\n\tprotected _tmin = new Dictionary<string, number>();\r\n\r\n\t/**\r\n\t * Highest overal values by type.\r\n\t */\r\n\tprotected _tmax = new Dictionary<string, number>();\r\n\r\n\t/**\r\n\t * Lowest values in current selection by type.\r\n\t */\r\n\tprotected _smin = new Dictionary<string, number>();\r\n\r\n\t/**\r\n\t * Highest values in current selection by type.\r\n\t */\r\n\tprotected _smax = new Dictionary<string, number>();\r\n\r\n\t/**\r\n\t * [dataItemsByAxis description]\r\n\t *\r\n\t * Both by category and date.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tpublic dataItemsByAxis = new Dictionary<string, Dictionary<string, this[\"_dataItem\"]>>();\r\n\r\n\t/**\r\n\t * Normally series items are focusable using keyboard, so that people can\r\n\t * select them with a TAB key. However, if there are a lot of data points on\r\n\t * screen it might be long and useless to tab through all o fthem.\r\n\t *\r\n\t * This is where `skipFocusThreshold` comes in. If there are more items than\r\n\t * the value set here, we will not make those focusable and rather let screen\r\n\t * reader software rely on the series summary, or authors provide alternative\r\n\t * detailed information display, such as HTML table.\r\n\t *\r\n\t * Different series might have different threshold defaults.\r\n\t */\r\n\tpublic skipFocusThreshold: number = 20;\r\n\r\n\t/**\r\n\t * Holds a default screen reader text for series data items. It will be used\r\n\t * to generate information for screen readers. If not set, the series will\r\n\t * try to deduce reader text from `tooltipText` or `tooltipHTML`. If those\r\n\t * are not set either, a default reader text will be used which is relevant\r\n\t * for each Series type.\r\n\t */\r\n\tprotected _itemReaderText: string;\r\n\r\n\r\n\t/**\r\n\t * Used to indicate if `itemReaderText` was changed \"from the outside\".\r\n\t */\r\n\tprotected _itemReaderTextChanged: boolean = false;\r\n\r\n\t/*\r\n\t\tpublic heatMapfillRule: (fill:Color, column: Sprite) => any = function(fill:Color, sprite: Sprite) {\r\n\t\t\tlet dataItem: SeriesDataItem = <SeriesDataItem>sprite.dataItem;\r\n\r\n\t\t\tif (dataItem && dataItem.value) {\r\n\t\t\t\tlet series = dataItem.component;\r\n\t\t\t\tif($type.hasValue(series.minColor) &&  $type.hasValue(series.maxColor) && $type.isNumber(series.minValue) && $type.isNumber(series.maxValue)){\r\n\t\t\t\t\tlet percent = (dataItem.values.value.workingValue - series.minValue) / (series.maxValue - series.minValue);\r\n\t\t\t\t\treturn new Color($colors.interpolate(series.minColor.rgb, series.maxColor.rgb, percent));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t*/\r\n\r\n\tprotected _heatRules: List<IHeatRule>;\r\n\r\n\t/**\r\n\t * Most of the series use absolute values. However sometimes various\r\n\t * calculated percent values are need, e.g. item's percent representation\r\n\t * across all values in series, etc.\r\n\t *\r\n\t * It's a resource-intensive operation, so it is disabled by default.\r\n\t *\r\n\t * If you need percents to be calculated, e.g. for showing them in tooltips,\r\n\t * or creating 100% stacks, this setting needs to be set to `true`.\r\n\t *\r\n\t * NOTE: `PieChart`, which relies on slice percentages, has this\r\n\t * automatically set to `true`.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tpublic calculatePercent: boolean = false;\r\n\r\n\t/**\r\n\t * When `calculatePercent` is enabled and data item's percent value is\r\n\t * calculated, last item's real value is used instead of its working value.\r\n\t *\r\n\t * This is done for the animations when last item in series (e.g. slice in\r\n\t * a `PieSeries`) is hidden or shown. (if we would use real value, the\r\n\t * calculated percent would always be 100%).\r\n\t *\r\n\t * Sometimes there is a need (e.g. for drill-down Sunburst) to disable this\r\n\t * hack by setting `usePercentHack` to `false`.\r\n\t *\r\n\t * @since 4.9.13\r\n\t * @default true\r\n\t */\r\n\tpublic usePercentHack: boolean = true;\r\n\r\n\t/**\r\n\t * Specifies if series should be automatically disposed when removing from\r\n\t * chart's `series` list.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tpublic autoDispose: boolean = true;\r\n\r\n\t/**\r\n\t * When chart/series' data is processed, all kinds of derivative values are\r\n\t * calculated. E.g. sum, min, max, change, etc. This is a potentially\r\n\t * time-consuming operation, especially prominent in data-heavy charts.\r\n\t *\r\n\t * If your chart does not need those values, and you have a lot of data,\r\n\t * setting this to `true` might give a dramatic increase in initial chart\r\n\t * load speed.\r\n\t *\r\n\t * Please note, regular column and line series usage scenarios do not\r\n\t * require derivative values. Those come into play only when you do advanced\r\n\t * functionality like coloring segments of charts in different colors\r\n\t * depending on change between open and close values, have stacked series, or\r\n\t * display any of the derived values, like percent, in tooltips or bullets.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tpublic simplifiedProcessing: boolean = false;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tif (this.constructor === Series) {\r\n\t\t\tthrow new Error(\"'Series' cannot be instantiated directly. Please use a specific series type.\");\r\n\t\t}\r\n\r\n\t\tthis.className = \"Series\";\r\n\t\tthis.isMeasured = false;\r\n\r\n\t\tthis.layout = \"none\";\r\n\t\tthis.shouldClone = false;\r\n\t\tthis.setPropertyValue(\"hidden\", false);\r\n\r\n\t\tthis.axisRanges = new List<AxisDataItem>();\r\n\t\tthis.axisRanges.events.on(\"inserted\", this.processAxisRange, this, false);\r\n\r\n\t\tthis.minBulletDistance = 0; // otherwise we'll have a lot of cases when people won't see bullets and think it's a bug\r\n\t\tthis.mainContainer = this.createChild(Container);\r\n\t\tthis.mainContainer.shouldClone = false;\r\n\t\tthis.mainContainer.mask = this.createChild(Sprite);\r\n\r\n\t\tthis._disposers.push(this.mainContainer);\r\n\r\n\t\t// all bullets should go on top of lines/fills. So we add a separate container for bullets and later set it's parent to chart.bulletsContainer\r\n\t\tlet bulletsContainer = this.mainContainer.createChild(Container);\r\n\t\tthis._shouldBeReady.push(bulletsContainer);\r\n\t\tbulletsContainer.shouldClone = false;\r\n\t\tbulletsContainer.layout = \"none\";\r\n\t\tbulletsContainer.virtualParent = this;\r\n\t\tthis._disposers.push(bulletsContainer);\r\n\t\tthis.bulletsContainer = bulletsContainer;\r\n\r\n\t\tthis.tooltip = new Tooltip();\r\n\t\tthis.tooltip.virtualParent = this;\r\n\t\tthis._disposers.push(this.tooltip);\r\n\r\n\t\tthis.hiddenState.transitionEasing = $ease.cubicIn;\r\n\r\n\t\t// this data item holds sums, averages, etc\r\n\t\tthis.dataItem = this.createDataItem();\r\n\t\tthis._disposers.push(this.dataItem);\r\n\t\tthis.dataItem.component = this;\r\n\r\n\t\t// Apply accessibility\r\n\t\tthis.role = \"group\";\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * We need this here so that class names can be applied to bullets container.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic applyTheme(): void {\r\n\t\tsuper.applyTheme();\r\n\t\tif (options.autoSetClassName && this.bulletsContainer) {\r\n\t\t\tthis.bulletsContainer.className = this.className + \"-bullets\";\r\n\t\t\tthis.bulletsContainer.setClassName();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets defaults that instantiate some objects that rely on parent, so they\r\n\t * cannot be set in constructor.\r\n\t */\r\n\tprotected applyInternalDefaults(): void {\r\n\t\tsuper.applyInternalDefaults();\r\n\t\tif (!$type.hasValue(this.readerTitle)) {\r\n\t\t\tthis.readerTitle = this.language.translate(\"Series\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new/empty DataItem of the type appropriate for this object.\r\n\t *\r\n\t * @see {@link DataItem}\r\n\t * @return Data Item\r\n\t */\r\n\tprotected createDataItem(): this[\"_dataItem\"] {\r\n\t\treturn new SeriesDataItem();\r\n\t}\r\n\r\n\t/**\r\n\t * Chart series is used on.\r\n\t *\r\n\t * @param value  Chart\r\n\t */\r\n\tpublic set chart(value: this[\"_chart\"]) {\r\n\t\tthis._chart = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Chart\r\n\t */\r\n\tpublic get chart(): this[\"_chart\"] {\r\n\t\treturn this._chart;\r\n\t}\r\n\r\n\t/**\r\n\t * Positions bullet.\r\n\t *\r\n\t * @param bullet  Sprite\r\n\t */\r\n\tpublic positionBullet(bullet: Sprite): void {\r\n\r\n\t\t// Placeholder method for extending classes to override.\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Decorates newly created bullet after it has been instert into the list.\r\n\t *\r\n\t * @param event  List event\r\n\t * @todo investigate why itemReaderText is undefined\r\n\t */\r\n\tprotected processBullet(event: IListEvents<Sprite>[\"inserted\"]) {\r\n\t\tlet bullet: Sprite = event.newValue;\r\n\t\tbullet.isTemplate = true;\r\n\t\t// Add accessibility options to bullet\r\n\t\t// If there are relatively few bullets, make them focusable\r\n\t\tthis.events.once(\"datavalidated\", (ev) => {\r\n\t\t\tif (this.itemsFocusable()) {\r\n\t\t\t\tbullet.focusable = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * removes bullets\r\n\t *\r\n\t * @param event  List event\r\n\t */\r\n\tprotected removeBullet(event: IListEvents<Sprite>[\"removed\"]) {\r\n\t\tlet bullet: Sprite = event.oldValue;\r\n\r\n\t\tthis.dataItems.each((dataItem) => {\r\n\t\t\tlet eachBullet = dataItem.bullets.getKey(bullet.uid);\r\n\t\t\tif (eachBullet) {\r\n\t\t\t\teachBullet.dispose();\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * Validates data items.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validateDataItems() {\r\n\t\tsuper.validateDataItems();\r\n\t\tthis.processValues(false);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns first value for the specific key in the series.\r\n\t *\r\n\t * @param key  Key\r\n\t * @return Value\r\n\t * @todo Description\r\n\t * @todo Convert to propert object property iterator\r\n\t */\r\n\tprotected getFirstValue(key: string, startIndex: number): number {\r\n\t\t// find first\r\n\t\t/*\r\n\t\treturn $iter.findMap(this.dataItems.iterator(), (dataItem) => {\r\n\t\t\tfor (let key in dataItem.values) {\r\n\t\t\t\tif ($object.hasKey(dataItem.values, key)) {\r\n\t\t\t\t\tlet value: number = dataItem.values[key].workingValue;\r\n\t\t\t\t\tif ($type.isNumber(value)) {\r\n\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t});*/\r\n\r\n\t\t//if (startIndex > 0 && startIndex < this.dataItems.length - 1) {\r\n\t\t//startIndex++;\r\n\t\t//}\r\n\t\tfor (let i = startIndex; i >= 0; i--) {\r\n\t\t\tlet dataItem = this.dataItems.getIndex(i);\r\n\t\t\tlet value: number = dataItem.getActualWorkingValue(key);\r\n\t\t\tif ($type.isNumber(value)) {\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns first value for the specific key in the series.\r\n\t *\r\n\t * @param key  Key\r\n\t * @return Value\r\n\t * @todo Description\r\n\t * @todo Convert to propert object property iterator\r\n\t */\r\n\tprotected getAbsoluteFirstValue(key: string): number {\r\n\t\tfor (let i = 0; i < this.dataItems.length; i++) {\r\n\t\t\tlet dataItem = this.dataItems.getIndex(i);\r\n\t\t\tlet value: number = dataItem.values[key].value;\r\n\t\t\tif ($type.isNumber(value)) {\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * [rangeChangeUpdate description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected rangeChangeUpdate() {\r\n\t\tsuper.rangeChangeUpdate();\r\n\t\tthis.processValues(true);\r\n\t}\r\n\r\n\t/**\r\n\t * [processValues description]\r\n\t *\r\n\t * @todo Description\r\n\t * @todo Convert to propert object property iterator\r\n\t * @param dataItems [description]\r\n\t */\r\n\tprotected processValues(working: boolean) {\r\n\t\tif (!this.simplifiedProcessing) {\r\n\t\t\tlet dataItems = this.dataItems;\r\n\r\n\t\t\tlet count: { [index: string]: number } = {};\r\n\t\t\tlet sum: { [index: string]: number } = {};\r\n\t\t\tlet absoluteSum: { [index: string]: number } = {};\r\n\t\t\tlet low: { [index: string]: number } = {};\r\n\t\t\tlet high: { [index: string]: number } = {};\r\n\t\t\tlet open: { [index: string]: number } = {};\r\n\t\t\tlet close: { [index: string]: number } = {};\r\n\t\t\tlet previous: { [index: string]: number } = {};\r\n\t\t\tlet first: { [index: string]: number } = {};\r\n\t\t\tlet absoluteFirst: { [index: string]: number } = {};\r\n\r\n\t\t\t//let duration: number = 0; // todo: check if series uses selection.change or selection.change.percent and set duration to interpolationduration\r\n\r\n\t\t\tlet startIndex: number = $math.max(0, this.startIndex);\r\n\t\t\tstartIndex = $math.min(startIndex, this.dataItems.length);\r\n\r\n\t\t\tlet endIndex: number = $math.min(this.endIndex, this.dataItems.length);\r\n\r\n\t\t\tif (!$type.isNumber(startIndex)) {\r\n\t\t\t\tstartIndex = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (!$type.isNumber(endIndex)) {\r\n\t\t\t\tendIndex = this.dataItems.length;\r\n\t\t\t}\r\n\r\n\t\t\tif (startIndex > 0) {\r\n\t\t\t\tlet dataItem = dataItems.getIndex(startIndex - 1);\r\n\r\n\t\t\t\t$object.each(dataItem.values, (key, values) => {\r\n\t\t\t\t\tlet value: number = dataItem.getActualWorkingValue(key);\r\n\r\n\t\t\t\t\tif ($type.isNumber(value)) {\r\n\t\t\t\t\t\t// save previous\r\n\t\t\t\t\t\tprevious[key] = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = startIndex; i < endIndex; i++) {\r\n\t\t\t\tlet dataItem = dataItems.getIndex(i);\r\n\r\n\t\t\t\t$object.each(dataItem.values, (key, values) => {\r\n\t\t\t\t\tlet value: number = dataItem.getActualWorkingValue(key);\r\n\r\n\t\t\t\t\t//if (i >= startIndex && i <= endIndex) { // do not add to count, sum etc if it is not within start/end index\r\n\t\t\t\t\tif ($type.isNumber(value)) {\r\n\r\n\t\t\t\t\t\t// count values\r\n\t\t\t\t\t\tif (!$type.isNumber(count[key])) {\r\n\t\t\t\t\t\t\tcount[key] = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcount[key]++;\r\n\r\n\t\t\t\t\t\t// sum values\r\n\t\t\t\t\t\tif (!$type.isNumber(sum[key])) {\r\n\t\t\t\t\t\t\tsum[key] = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsum[key] += value;\r\n\r\n\t\t\t\t\t\t// absolute sum values\r\n\t\t\t\t\t\tif (!$type.isNumber(absoluteSum[key])) {\r\n\t\t\t\t\t\t\tabsoluteSum[key] = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tabsoluteSum[key] += Math.abs(value);\r\n\r\n\t\t\t\t\t\t// open\r\n\t\t\t\t\t\tif (!$type.isNumber(open[key])) {\r\n\t\t\t\t\t\t\topen[key] = value;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// close\r\n\t\t\t\t\t\tclose[key] = value;\r\n\r\n\t\t\t\t\t\t// low\r\n\t\t\t\t\t\tif (!$type.isNumber(low[key])) {\r\n\t\t\t\t\t\t\tlow[key] = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tif (low[key] > value) {\r\n\t\t\t\t\t\t\t\tlow[key] = value;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// high\r\n\t\t\t\t\t\tif (!$type.isNumber(high[key])) {\r\n\t\t\t\t\t\t\thigh[key] = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tif (high[key] < value) {\r\n\t\t\t\t\t\t\t\thigh[key] = value;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!$type.isNumber(first[key])) {\r\n\t\t\t\t\t\t\tfirst[key] = this.getFirstValue(key, startIndex);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!$type.isNumber(absoluteFirst[key])) {\r\n\t\t\t\t\t\t\tabsoluteFirst[key] = this.getAbsoluteFirstValue(key);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// change\r\n\t\t\t\t\t\tdataItem.setCalculatedValue(key, value - first[key], \"change\");\r\n\t\t\t\t\t\t// change from start percent\r\n\t\t\t\t\t\t// will fail if first value is 0\r\n\t\t\t\t\t\tdataItem.setCalculatedValue(key, (value - first[key]) / first[key] * 100, \"changePercent\");\r\n\r\n\t\t\t\t\t\tdataItem.setCalculatedValue(key, (value - absoluteFirst[key]), \"startChange\");\r\n\r\n\t\t\t\t\t\tdataItem.setCalculatedValue(key, (value - absoluteFirst[key]) / absoluteFirst[key] * 100, \"startChangePercent\");\r\n\r\n\t\t\t\t\t\t// previous change\r\n\t\t\t\t\t\tlet prevValue: number = previous[key];\r\n\t\t\t\t\t\tif (!$type.isNumber(prevValue)) {\r\n\t\t\t\t\t\t\tprevValue = value;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdataItem.setCalculatedValue(key, value - prevValue, \"previousChange\");\r\n\t\t\t\t\t\t// previous change percent\r\n\t\t\t\t\t\tdataItem.setCalculatedValue(key, (value - prevValue) / prevValue * 100, \"previousChangePercent\");\r\n\r\n\t\t\t\t\t\t// save previous\r\n\t\t\t\t\t\tprevious[key] = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (this.calculatePercent) {\r\n\t\t\t\tfor (let i = startIndex; i < endIndex; i++) {\r\n\t\t\t\t\tlet dataItem = dataItems.getIndex(i);\r\n\r\n\t\t\t\t\t$object.each(dataItem.values, (key) => {\r\n\t\t\t\t\t\tlet ksum: number = absoluteSum[key];\r\n\r\n\t\t\t\t\t\tlet value: number = dataItem.getActualWorkingValue(key);\r\n\r\n\t\t\t\t\t\tif ($type.isNumber(value)) {\r\n\t\t\t\t\t\t\tif (ksum > 0) {\r\n\t\t\t\t\t\t\t\tif (this.usePercentHack) {\r\n\t\t\t\t\t\t\t\t\t// this hack is made in order to make it possible to animate single slice to 0\r\n\t\t\t\t\t\t\t\t\t// if there is only one slice left, percent value is always 100%, so it won't animate\r\n\t\t\t\t\t\t\t\t\t// so we use real value of a slice instead of current value\r\n\t\t\t\t\t\t\t\t\tif (value == ksum) {\r\n\t\t\t\t\t\t\t\t\t\tksum = dataItem.values[key].value;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet percent = value / ksum * 100;\r\n\r\n\t\t\t\t\t\t\t\tdataItem.setCalculatedValue(key, percent, \"percent\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tdataItem.setCalculatedValue(key, 0, \"percent\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// calculate one before first (cant do that in cycle, as we don't know open yet\r\n\t\t\t// when drawing line chart we should draw line to the invisible data point to the left, otherwise the line will always look like it starts from the selected point\r\n\t\t\t// so we do startIndex - 1\r\n\t\t\tif (startIndex > 0) {\r\n\t\t\t\tlet zeroItem: this[\"_dataItem\"] = dataItems.getIndex(startIndex - 1);\r\n\r\n\t\t\t\t$object.each(zeroItem.values, (key) => {\r\n\t\t\t\t\tlet value = zeroItem.values[key].value;\r\n\t\t\t\t\t// change\r\n\t\t\t\t\tzeroItem.setCalculatedValue(key, value - open[key], \"change\");\r\n\t\t\t\t\t// change percent\r\n\t\t\t\t\tzeroItem.setCalculatedValue(key, (value - open[key]) / open[key] * 100, \"changePercent\");\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// we save various data like sum, average to dataPoint of the series\r\n\t\t\tlet dataItem: DataItem = this.dataItem;\r\n\t\t\t$object.each(dataItem.values, (key) => {\r\n\t\t\t\tdataItem.setCalculatedValue(key, sum[key], \"sum\");\r\n\t\t\t\tdataItem.setCalculatedValue(key, absoluteSum[key], \"absoluteSum\");\r\n\t\t\t\tdataItem.setCalculatedValue(key, sum[key] / count[key], \"average\");\r\n\t\t\t\tdataItem.setCalculatedValue(key, open[key], \"open\");\r\n\t\t\t\tdataItem.setCalculatedValue(key, close[key], \"close\");\r\n\t\t\t\tdataItem.setCalculatedValue(key, low[key], \"low\");\r\n\t\t\t\tdataItem.setCalculatedValue(key, high[key], \"high\");\r\n\t\t\t\tdataItem.setCalculatedValue(key, count[key], \"count\");\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates the whole series, effectively causing it to redraw.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\r\n\t\tif ($utils.isIE()) {\r\n\t\t\tthis.filters.clear();\r\n\t\t}\r\n\r\n\t\t$iter.each(this.axisRanges.iterator(), (axisRange) => {\r\n\t\t\t//axisRange.contents.disposeChildren(); // not good for columns, as they are reused\r\n\t\t\t//\t\t\taxisRange.appendChildren();\r\n\t\t\taxisRange.validate();\r\n\t\t});\r\n\r\n\t\tsuper.validate();\r\n\t\tlet bulletsContainer = this.bulletsContainer;\r\n\t\tbulletsContainer.fill = this.fill;\r\n\t\tbulletsContainer.stroke = this.stroke;\r\n\t\tbulletsContainer.x = this.pixelX;\r\n\t\tbulletsContainer.y = this.pixelY;\r\n\r\n\t\tif (this.bulletsContainer.children.length > 0) {\r\n\t\t\tif (this._showBullets) {\r\n\r\n\t\t\t\tfor (let i = 0; i < this.startIndex; i++) {\r\n\t\t\t\t\tlet dataItem = this.dataItems.getIndex(i);\r\n\t\t\t\t\tif (dataItem) {\r\n\t\t\t\t\t\tdataItem.bullets.each((key, bullet) => {\r\n\t\t\t\t\t\t\tbullet.__disabled = true;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let i = this.dataItems.length - 1; i > this.endIndex; i--) {\r\n\t\t\t\t\tlet dataItem = this.dataItems.getIndex(i);\r\n\t\t\t\t\tif (dataItem) {\r\n\t\t\t\t\t\tdataItem.bullets.each((key, bullet) => {\r\n\t\t\t\t\t\t\tbullet.__disabled = true;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.bulletsContainer.children.each((bullet) => {\r\n\t\t\t\t\tbullet.__disabled = true;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.updateTooltipBounds();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic updateTooltipBounds() {\r\n\t\tif (this.topParent) {\r\n\t\t\tlet x = 0;\r\n\t\t\tlet y = 0;\r\n\t\t\tlet w = this.topParent.maxWidth;\r\n\t\t\tlet h = this.topParent.maxHeight;\r\n\t\t\tlet rect = { x: x, y: y, width: w, height: h };\r\n\r\n\t\t\tthis.tooltip.setBounds(rect);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tprotected shouldCreateBullet(dataItem: this[\"_dataItem\"], bulletTemplate: Sprite): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Validates data item's element, effectively redrawing it.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param dataItem  Data item\r\n\t */\r\n\tpublic validateDataElement(dataItem: this[\"_dataItem\"]): void {\r\n\t\tsuper.validateDataElement(dataItem);\r\n\r\n\t\tif (this._showBullets) {\r\n\t\t\tif (!this.isHidden) {\r\n\t\t\t\tthis.bulletsContainer.visible = true;\r\n\t\t\t}\r\n\t\t\tthis.bullets.each((bulletTemplate) => {\r\n\t\t\t\t// always better to use the same, this helps to avoid redrawing\r\n\t\t\t\tlet bullet: Sprite = <Sprite>dataItem.bullets.getKey(bulletTemplate.uid);\r\n\r\n\t\t\t\tif (this.shouldCreateBullet(dataItem, bulletTemplate)) {\r\n\t\t\t\t\tif (!bullet) {\r\n\r\n\t\t\t\t\t\tlet disabledField = bulletTemplate.propertyFields.disabled;\r\n\t\t\t\t\t\tlet dataContext = <any>dataItem.dataContext;\r\n\t\t\t\t\t\tif (disabledField && dataContext && dataContext[disabledField] === false) {\r\n\t\t\t\t\t\t\tbulletTemplate.applyOnClones = false;\r\n\t\t\t\t\t\t\tbulletTemplate.disabled = false;\r\n\t\t\t\t\t\t\tbullet = bulletTemplate.clone();\r\n\t\t\t\t\t\t\tbulletTemplate.disabled = true;\r\n\t\t\t\t\t\t\tbulletTemplate.applyOnClones = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tbullet = bulletTemplate.clone();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbullet.shouldClone = false;\r\n\t\t\t\t\t\tdataItem.addSprite(bullet);\r\n\r\n\t\t\t\t\t\tif (!this.visible || this.isHiding) {\r\n\t\t\t\t\t\t\tbullet.hide(0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet currentDataItem: this[\"_dataItem\"] = <this[\"_dataItem\"]>bullet.dataItem;\r\n\t\t\t\t\tif (currentDataItem != dataItem) {\r\n\t\t\t\t\t\t// set to undefined in order not to reuse\r\n\t\t\t\t\t\tif (currentDataItem) {\r\n\t\t\t\t\t\t\tcurrentDataItem.bullets.setKey(bulletTemplate.uid, undefined);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet readerText = this.itemReaderText;\r\n\r\n\t\t\t\t\t\tif (bullet instanceof Bullet) {\r\n\t\t\t\t\t\t\tif (!readerText) {\r\n\t\t\t\t\t\t\t\treaderText = (\"{\" + bullet.xField + \"}: {\" + bullet.yField + \"}\");\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (bullet.isDynamic) {\r\n\t\t\t\t\t\t\t\tdataItem.events.on(\"workingvaluechanged\", bullet.deepInvalidate, bullet, false);\r\n\t\t\t\t\t\t\t\t//dataItem.events.on(\"calculatedvaluechanged\", bullet.deepInvalidate, bullet, false);\r\n\t\t\t\t\t\t\t\tthis.dataItem.events.on(\"workingvaluechanged\", bullet.deepInvalidate, bullet, false);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbullet.deepInvalidate();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Add accessibility to bullet\r\n\t\t\t\t\t\tif (bullet.focusable) {\r\n\t\t\t\t\t\t\tbullet.events.on(\"focus\", (ev) => {\r\n\t\t\t\t\t\t\t\tbullet.readerTitle = this.populateString(readerText, bullet.dataItem);\r\n\t\t\t\t\t\t\t}, undefined, false);\r\n\t\t\t\t\t\t\tbullet.events.on(\"blur\", (ev) => {\r\n\t\t\t\t\t\t\t\tbullet.readerTitle = \"\";\r\n\t\t\t\t\t\t\t}, undefined, false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (bullet.hoverable) {\r\n\t\t\t\t\t\t\tbullet.events.on(\"over\", (ev) => {\r\n\t\t\t\t\t\t\t\tbullet.readerTitle = this.populateString(readerText, bullet.dataItem);\r\n\t\t\t\t\t\t\t}, undefined, false);\r\n\t\t\t\t\t\t\tbullet.events.on(\"out\", (ev) => {\r\n\t\t\t\t\t\t\t\tbullet.readerTitle = \"\";\r\n\t\t\t\t\t\t\t}, undefined, false);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbullet.parent = this.bulletsContainer;\r\n\t\t\t\t\tdataItem.bullets.setKey(bulletTemplate.uid, bullet);\r\n\r\n\t\t\t\t\t// pass max w/h so we'd know if we should show/hide somethings\r\n\t\t\t\t\tbullet.maxWidth = dataItem.itemWidth;\r\n\t\t\t\t\tbullet.maxHeight = dataItem.itemHeight;\r\n\t\t\t\t\tbullet.__disabled = false;\r\n\r\n\t\t\t\t\tthis.positionBullet(bullet);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (bullet) {\r\n\t\t\t\t\t\tbullet.__disabled = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.bulletsContainer.visible = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [handleDataItemWorkingValueChange description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleDataItemWorkingValueChange(dataItem?: this[\"_dataItem\"], name?: string): void {\r\n\t\tif (!this.dataRangeInvalid) {\r\n\t\t\tthis.invalidateProcessedData();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Should this series excluded from the axis scale calculations?\r\n\t *\r\n\t * @default false\r\n\t * @param value  Exclude from calculations?\r\n\t */\r\n\tpublic set ignoreMinMax(value: boolean) {\r\n\t\tthis._ignoreMinMax = value;\r\n\t\tthis.invalidateDataItems();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Exclude from calculations?\r\n\t */\r\n\tpublic get ignoreMinMax(): boolean {\r\n\t\treturn this._ignoreMinMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Create a mask for the series.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic createMask(): void {\r\n\r\n\t\t// A placeholder method for extending classes to override.\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Process axis range after it has been added to the list.\r\n\t *\r\n\t * @param event  Event\r\n\t */\r\n\tprotected processAxisRange(event: IListEvents<AxisDataItem>[\"inserted\"]): void {\r\n\t\t// create container if not existing\r\n\t\tif (!this.rangesContainer) {\r\n\t\t\tthis.rangesContainer = this.createChild(Container);\r\n\t\t\tthis.rangesContainer.shouldClone = false;\r\n\t\t\tthis.rangesContainer.isMeasured = false;\r\n\t\t}\r\n\r\n\t\tlet axisRange: AxisDataItem = event.newValue;\r\n\t\tif (axisRange) {\r\n\t\t\taxisRange.contents.parent = this.rangesContainer;\r\n\t\t\taxisRange.isRange = true;\r\n\t\t\taxisRange.events.on(\"valuechanged\", this.invalidateDataItems, this, false);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [getAxisField description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t * @param axis  [description]\r\n\t * @return [description]\r\n\t */\r\n\tpublic getAxisField(axis: Axis): string {\r\n\t\treturn;\r\n\t}\r\n\r\n\t/**\r\n\t * Shows the tooltip at specific position.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param xPosition  X\r\n\t * @param yPosition  Y\r\n\t */\r\n\tpublic showTooltipAtPosition(xPosition: number, yPosition: number): void {\r\n\r\n\t\t// Placeholder method for extending classes to override.\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Minimal distance between data points in pixels.\r\n\t *\r\n\t * If distance gets smaller than this, bullets are turned off to avoid\r\n\t * overlapping.\r\n\t *\r\n\t * `0` (zero) disables this behavior.\r\n\t *\r\n\t * IMPORTANT: This setting will work only when Series' base axis\r\n\t * is [[CategoryAxis]] or [[DateAxis]]. If base axis is [[ValueAxis]] the\r\n\t * setting will be ignored, because it would be a huge overhead to measure\r\n\t * distance between each and every bullet.\r\n\t *\r\n\t * @default 0\r\n\t * @param value  Distance (px)\r\n\t */\r\n\tpublic set minBulletDistance(value: number) {\r\n\t\tthis.setPropertyValue(\"minBulletDistance\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Distance (px)\r\n\t */\r\n\tpublic get minBulletDistance(): number {\r\n\t\treturn this.getPropertyValue(\"minBulletDistance\");\r\n\t}\r\n\r\n\t/**\r\n\t * A list of bullets that will be added to each and every items in the\r\n\t * series.\r\n\t *\r\n\t * You can push any object that is a descendant of a [[Sprite]] here. All\r\n\t * items added to this list will be copied and used as a bullet on all data\r\n\t * items, including their properties, events, etc.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/bullets/} for more info about the concept of Bullets\r\n\t * @return List of bullets.\r\n\t */\r\n\tpublic get bullets(): ListTemplate<Sprite> {\r\n\t\tif (!this._bullets) {\r\n\t\t\tthis._bullets = new ListTemplate<Sprite>(new Bullet());\r\n\t\t\tthis._bullets.template.virtualParent = this;\r\n\t\t\tthis._bullets.events.on(\"inserted\", this.processBullet, this, false);\r\n\t\t\tthis._bullets.events.on(\"removed\", this.removeBullet, this, false);\r\n\r\n\t\t\tthis._disposers.push(new ListDisposer(this._bullets));\r\n\t\t\tthis._disposers.push(this._bullets.template);\r\n\t\t}\r\n\t\treturn this._bullets;\r\n\t}\r\n\r\n\t/**\r\n\t * Binds related legend data item's visual settings to this series' visual\r\n\t * settings.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param marker  Legend item container\r\n\t */\r\n\tpublic createLegendMarker(marker: Container): void {\r\n\r\n\t\t// This is a placeholder method for extending classes to override.\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Should the series be hidden in legend?\r\n\t *\r\n\t * @param value Hidden in legend?\r\n\t */\r\n\tpublic set hiddenInLegend(value: boolean) {\r\n\t\tif (this.setPropertyValue(\"hiddenInLegend\", value)) {\r\n\t\t\tif (this.chart) {\r\n\t\t\t\tthis.chart.feedLegend();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Hidden in legend?\r\n\t */\r\n\tpublic get hiddenInLegend(): boolean {\r\n\t\treturn this.getPropertyValue(\"hiddenInLegend\");\r\n\t}\r\n\r\n\t/**\r\n\t * Series' name.\r\n\t *\r\n\t * @param value  Name\r\n\t */\r\n\tpublic set name(value: string) {\r\n\t\tthis.setPropertyValue(\"name\", value);\r\n\r\n\t\tlet legendDataItem = this.legendDataItem;\r\n\t\tif (legendDataItem) {\r\n\t\t\tlegendDataItem.component.invalidate();\r\n\t\t\tlegendDataItem.component.invalidateRawData();\r\n\t\t}\r\n\r\n\t\tthis.readerTitle = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Name\r\n\t */\r\n\tpublic get name(): string {\r\n\t\treturn this.getPropertyValue(\"name\");\r\n\t}\r\n\r\n\t/**\r\n\t * Screen reader text to be applied to each individual data item, such\r\n\t * as bullets, columns or slices.\r\n\t *\r\n\t * The template can contain field reference meta codes, i.e. `{dateX}`,\r\n\t * `{valueY}`, etc.\r\n\t *\r\n\t * Any text formatting options, e.g. `[bold]` will be ignored.\r\n\t *\r\n\t * @param value Screen reader text template\r\n\t */\r\n\tpublic set itemReaderText(value: string) {\r\n\t\tthis._itemReaderText = value;\r\n\t\tthis._itemReaderTextChanged = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Screen reader text template\r\n\t */\r\n\tpublic get itemReaderText(): string {\r\n\r\n\t\t// Get explicitly set reader text\r\n\t\tlet readerText = this._itemReaderText;\r\n\r\n\t\t// Not set? Let's try something else\r\n\t\tif (!readerText) {\r\n\r\n\t\t\t// Tooltip text?\r\n\t\t\tif (this.tooltipText) {\r\n\t\t\t\treaderText = $utils.plainText(this.tooltipText);\r\n\t\t\t}\r\n\t\t\telse if (this.tooltipHTML) {\r\n\t\t\t\treaderText = $utils.plainText(this.tooltipHTML);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn readerText;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"itemReaderText\", readerText);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns if number of data items in the series are beyond non-focusable\r\n\t * count and should not be available for TAB-through.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Items focusable?\r\n\t */\r\n\tpublic itemsFocusable(): boolean {\r\n\t\treturn this.dataItems.length >= this.skipFocusThreshold ? false : true;\r\n\t}\r\n\r\n\t/**\r\n\t * Legend data item that corresponds to this series.\r\n\t *\r\n\t * @param value  Data item\r\n\t */\r\n\tpublic set legendDataItem(value: LegendDataItem) {\r\n\t\tthis._legendDataItem = value;\r\n\t\tthis._legendDataItem.itemContainer.deepInvalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Data item\r\n\t */\r\n\tpublic get legendDataItem(): LegendDataItem {\r\n\t\treturn this._legendDataItem;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates corresponding legend data item with current values.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param dataItem  Data item\r\n\t */\r\n\tpublic updateLegendValue(dataItem?: this[\"_dataItem\"], notRange?: boolean) {\r\n\t\t// if this series has legend item\r\n\t\tif (this.legendDataItem) {\r\n\r\n\t\t\tlet legendSettings: LegendSettings = this.legendSettings;\r\n\t\t\tlet legendDataItem = this.legendDataItem;\r\n\t\t\tlet label: Label = legendDataItem.label;\r\n\t\t\tlet valueLabel: Label = legendDataItem.valueLabel;\r\n\r\n\t\t\t// update legend\r\n\t\t\tif ((dataItem && !dataItem.isDisposed())|| notRange) {\r\n\t\t\t\tif (valueLabel) {\r\n\t\t\t\t\tif (legendSettings.itemValueText) {\r\n\t\t\t\t\t\tvalueLabel.text = legendSettings.itemValueText;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvalueLabel.dataItem = dataItem;\r\n\t\t\t\t}\r\n\t\t\t\tif (label) {\r\n\t\t\t\t\tif (legendSettings.itemLabelText) {\r\n\t\t\t\t\t\tlabel.text = legendSettings.itemLabelText;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlabel.dataItem = dataItem;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (label) {\r\n\t\t\t\t\t// if itemLabelText is set, means we have to reset label even if labelText is not set\r\n\t\t\t\t\tif (legendSettings.labelText || legendSettings.itemLabelText != undefined) {\r\n\t\t\t\t\t\tlabel.text = legendSettings.labelText;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlabel.dataItem = this.dataItem;\r\n\t\t\t\t}\r\n\t\t\t\tif (valueLabel) {\r\n\t\t\t\t\tif (legendSettings.valueText || legendSettings.itemValueText != undefined) {\r\n\t\t\t\t\t\tvalueLabel.text = legendSettings.valueText;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvalueLabel.dataItem = this.dataItem;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all properties from another instance of [[Series]].\r\n\t *\r\n\t * @param source  Source series\r\n\t */\r\n\tpublic copyFrom(source: this) {\r\n\t\tthis.bullets.copyFrom(source.bullets);\r\n\t\tthis.bulletsContainer.copyFrom(source.bulletsContainer);\r\n\t\tthis.calculatePercent = source.calculatePercent;\r\n\t\tthis.usePercentHack = source.usePercentHack;\r\n\t\tthis.simplifiedProcessing = source.simplifiedProcessing;\r\n\t\tsuper.copyFrom(source);\r\n\t}\r\n\r\n\t/**\r\n\t * Displays a modal or console message with error, and halts any further\r\n\t * processing of this element.\r\n\t *\r\n\t * @param e Error\r\n\t */\r\n\tpublic raiseCriticalError(e: Error) {\r\n\t\tif (this._chart && this._chart.modal) {\r\n\t\t\tthis._chart.modal.content = this._chart.adapter.apply(\"criticalError\", e).message;\r\n\t\t\tthis._chart.modal.closable = false;\r\n\t\t\tif (!options.suppressErrors) {\r\n\t\t\t\tthis._chart.modal.open();\r\n\t\t\t}\r\n\t\t\tthis._chart.disabled = true;\r\n\t\t}\r\n\r\n\t\tif (options.verbose) {\r\n\t\t\tconsole.log(e);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Applies filters to the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected applyFilters() {\r\n\t\tsuper.applyFilters();\r\n\t\tthis.bulletsContainer.filters.clear();\r\n\r\n\t\t// copyFrom of a list copies, does not clone\r\n\t\t$iter.each(this.filters.iterator(), (filter) => {\r\n\t\t\tthis.bulletsContainer.filters.push(filter.clone());\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * A list of heat rules to apply to series' elements based on the value\r\n\t * of the data item.\r\n\t *\r\n\t * Heat rules can be any \"numeric\" (including `Color`) property, and can also\r\n\t * be applied to child objects of series, like columns, bullets, etc.\r\n\t *\r\n\t * E.g.:\r\n\t *\r\n\t * ```TypeScript\r\n\t * series.heatRules.push({\r\n\t *  \"target\": series.columns.template,\r\n\t *  \"property\": \"fill\",\r\n\t *  \"min\": am4core.color(\"#F5DBCB\"),\r\n\t *  \"max\": am4core.color(\"#ED7B84\"),\r\n\t *  \"dataField\": \"valueY\"\r\n\t *});\r\n\t *```\r\n\t * ```Javacript\r\n\t * series.heatRules.push({\r\n\t *  \"target\": series.columns.template,\r\n\t *  \"property\": \"fill\",\r\n\t *  \"min\": am4core.color(\"#F5DBCB\"),\r\n\t *  \"max\": am4core.color(\"#ED7B84\"),\r\n\t *  \"dataField\": \"valueY\"\r\n\t *});\r\n\t *```\r\n\t *```JSON\r\n\t *{\r\n\t *  // ...\r\n\t *  \"series\": [{\r\n\t *    \"type\": \"ColumnSeries\",\r\n\t *    \"heatRules\": [{\r\n\t *      \"target\": \"columns.template\",\r\n\t *      \"property\": \"fill\",\r\n\t *      \"min\": \"#F5DBCB\",\r\n\t *      \"max\": \"#ED7B84\",\r\n\t *      \"dataField\": \"valueY\"\r\n\t *    }]\r\n\t *  }]\r\n\t *}\r\n\t *```\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/series/#Heat_maps} for more about heat rules\r\n\t * @return  Heat rules\r\n\t */\r\n\r\n\tpublic get heatRules(): List<IHeatRule> {\r\n\t\tif (!this._heatRules) {\r\n\t\t\tthis._heatRules = new List<IHeatRule>();\r\n\t\t\tthis._heatRules.events.on(\"inserted\", (event) => {\r\n\t\t\t\tlet heatRule = event.newValue;\r\n\t\t\t\tlet target = heatRule.target;\r\n\r\n\t\t\t\tif (target) {\r\n\t\t\t\t\tlet dataField = heatRule.dataField;\r\n\r\n\t\t\t\t\tif (!$type.hasValue(dataField)) {\r\n\t\t\t\t\t\tdataField = \"value\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet seriesDataItem = this.dataItem;\r\n\t\t\t\t\tlet property = heatRule.property;\r\n\r\n\t\t\t\t\tlet minValue = $type.toNumber(heatRule.minValue);\r\n\t\t\t\t\tlet maxValue = $type.toNumber(heatRule.maxValue);\r\n\r\n\t\t\t\t\tif (!$type.isNumber(minValue) && !$type.isNumber(maxValue)) {\r\n\t\t\t\t\t\tthis.dataItem.events.on(\"calculatedvaluechanged\", (event) => {\r\n\t\t\t\t\t\t\tif (event.property == dataField) {\r\n\t\t\t\t\t\t\t\t$iter.each(this.dataItems.iterator(), (dataItem) => {\r\n\t\t\t\t\t\t\t\t\tlet foundSprite = false;\r\n\t\t\t\t\t\t\t\t\t$array.each(dataItem.sprites, (sprite) => {\r\n\t\t\t\t\t\t\t\t\t\tif (sprite.clonedFrom == target) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet anySprite = <any>sprite;\r\n\t\t\t\t\t\t\t\t\t\t\tanySprite[property] = anySprite[property];\r\n\t\t\t\t\t\t\t\t\t\t\tfoundSprite = true;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\tif (!foundSprite) {\r\n\t\t\t\t\t\t\t\t\t\t$array.each(dataItem.sprites, (sprite) => {\r\n\t\t\t\t\t\t\t\t\t\t\tif (sprite instanceof Container) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t$iter.each(sprite.children.iterator(), (child) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (child.className == target.className) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet anyChild = <any>child;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tanyChild[property] = anyChild[property];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// giveup here\r\n\t\t\t\t\t\t\t\t\t\t\t\t\telse if (child instanceof Container) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tchild.deepInvalidate();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.dataItems.template.events.on(\"workingvaluechanged\", (event) => {\r\n\t\t\t\t\t\tif (event.property == dataField) {\r\n\t\t\t\t\t\t\tlet dataItem = event.target;\r\n\t\t\t\t\t\t\tlet foundSprite = false;\r\n\t\t\t\t\t\t\t$array.each(dataItem.sprites, (sprite) => {\r\n\t\t\t\t\t\t\t\tif (sprite.clonedFrom == target) {\r\n\t\t\t\t\t\t\t\t\tlet anySprite = <any>sprite;\r\n\t\t\t\t\t\t\t\t\tanySprite[property] = anySprite[property];\r\n\t\t\t\t\t\t\t\t\tfoundSprite = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif (!foundSprite) {\r\n\t\t\t\t\t\t\t\t$array.each(dataItem.sprites, (sprite) => {\r\n\t\t\t\t\t\t\t\t\tif (sprite instanceof Container) {\r\n\t\t\t\t\t\t\t\t\t\t$iter.each(sprite.children.iterator(), (child) => {\r\n\t\t\t\t\t\t\t\t\t\t\tif (child.className == target.className) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tlet anyChild = <any>child;\r\n\t\t\t\t\t\t\t\t\t\t\t\tanyChild[property] = anyChild[property];\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t// givup here\r\n\t\t\t\t\t\t\t\t\t\t\telse if (child instanceof Container) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tchild.deepInvalidate();\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\r\n\r\n\t\t\t\t\ttarget.adapter.add(<any>property, (value, ruleTarget, property) => {\r\n\r\n\t\t\t\t\t\tlet minValue = $type.toNumber(heatRule.minValue);\r\n\t\t\t\t\t\tlet maxValue = $type.toNumber(heatRule.maxValue);\r\n\r\n\t\t\t\t\t\tlet min = heatRule.min;\r\n\t\t\t\t\t\tlet max = heatRule.max;\r\n\r\n\t\t\t\t\t\tif (ruleTarget instanceof Sprite) {\r\n\t\t\t\t\t\t\tlet anySprite = <any>ruleTarget;\r\n\t\t\t\t\t\t\tlet propertyField = anySprite.propertyFields[property];\r\n\t\t\t\t\t\t\tif (propertyField && ruleTarget.dataItem) {\r\n\t\t\t\t\t\t\t\tlet dataContext = <any>ruleTarget.dataItem.dataContext;\r\n\t\t\t\t\t\t\t\tif (dataContext && $type.hasValue(dataContext[propertyField])) {\r\n\t\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet dataItem: SeriesDataItem = <SeriesDataItem>ruleTarget.dataItem;\r\n\r\n\t\t\t\t\t\tif (!$type.isNumber(minValue)) {\r\n\t\t\t\t\t\t\tminValue = seriesDataItem.values[dataField].low;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!$type.isNumber(maxValue)) {\r\n\t\t\t\t\t\t\tmaxValue = seriesDataItem.values[dataField].high;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (dataItem) {\r\n\t\t\t\t\t\t\tlet fieldValues = dataItem.values[dataField];\r\n\t\t\t\t\t\t\tif (fieldValues) {\r\n\t\t\t\t\t\t\t\tlet workingValue = dataItem.getActualWorkingValue(dataField);\r\n\t\t\t\t\t\t\t\tif ($type.hasValue(min) && $type.hasValue(max) && $type.isNumber(minValue) && $type.isNumber(maxValue) && $type.isNumber(workingValue)) {\r\n\r\n\t\t\t\t\t\t\t\t\tlet percent: number;\r\n\t\t\t\t\t\t\t\t\tif (heatRule.logarithmic) {\r\n\t\t\t\t\t\t\t\t\t\tpercent = (Math.log(workingValue) * Math.LOG10E - Math.log(minValue) * Math.LOG10E) / ((Math.log(maxValue) * Math.LOG10E - Math.log(minValue) * Math.LOG10E));\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\tpercent = (workingValue - minValue) / (maxValue - minValue);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif ($type.isNumber(workingValue) && (!$type.isNumber(percent) || Math.abs(percent) == Infinity)) {\r\n\t\t\t\t\t\t\t\t\t\tpercent = 0.5;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// fixes problems if all values are the same\r\n\t\t\t\t\t\t\t\t\tif ($type.isNumber(min)) {\r\n\t\t\t\t\t\t\t\t\t\treturn min + (max - min) * percent;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse if (min instanceof Color) {\r\n\t\t\t\t\t\t\t\t\t\treturn new Color($colors.interpolate(min.rgb, max.rgb, percent));\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this._heatRules;\r\n\t}\r\n\r\n\t/**\r\n\t * Processes JSON-based config before it is applied to the object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param config  Config\r\n\t */\r\n\tpublic processConfig(config?: { [index: string]: any }): void {\r\n\r\n\t\tlet heatRules;\r\n\r\n\t\tif (config) {\r\n\r\n\t\t\t// Set up bullets\r\n\t\t\tif ($type.hasValue(config.bullets) && $type.isArray(config.bullets)) {\r\n\t\t\t\tfor (let i = 0, len = config.bullets.length; i < len; i++) {\r\n\t\t\t\t\tlet bullets = config.bullets[i];\r\n\t\t\t\t\tif (!$type.hasValue(bullets.type)) {\r\n\t\t\t\t\t\tbullets.type = \"Bullet\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Let's take heatRules out of the config, so that we can process\r\n\t\t\t// them later, when bullets are already there\r\n\t\t\tif ($type.hasValue(config.heatRules) && $type.isArray(config.heatRules)) {\r\n\t\t\t\theatRules = config.heatRules;\r\n\t\t\t\tdelete config.heatRules;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tsuper.processConfig(config);\r\n\r\n\t\t// Process heat rules again, when all other elements are ready\r\n\t\tif (heatRules) {\r\n\t\t\tfor (let i = 0, len = heatRules.length; i < len; i++) {\r\n\t\t\t\tlet rule = heatRules[i];\r\n\r\n\t\t\t\t// Resolve target\r\n\t\t\t\tlet target: any = this;\r\n\t\t\t\tif ($type.hasValue(rule.target) && $type.isString(rule.target)) {\r\n\r\n\r\n\t\t\t\t\t// Check if we can find this element by id\r\n\t\t\t\t\tif (this.map.hasKey(rule.target)) {\r\n\t\t\t\t\t\ttarget = this.map.getKey(rule.target);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet parts = rule.target.split(\".\");\r\n\t\t\t\t\t\tfor (let x = 0; x < parts.length; x++) {\r\n\t\t\t\t\t\t\tif (target instanceof List) {\r\n\t\t\t\t\t\t\t\tlet listitem = target.getIndex($type.toNumber(parts[x]));\r\n\t\t\t\t\t\t\t\tif (!listitem) {\r\n\t\t\t\t\t\t\t\t\ttarget = (<any>target)[parts[x]];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\ttarget = listitem;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tconst maybeIndex = parts[x].match(/^(.*)\\[([0-9]+)\\]/);\r\n\t\t\t\t\t\t\t\tif (maybeIndex) {\r\n\t\t\t\t\t\t\t\t\tif (target[maybeIndex[1]] instanceof List) {\r\n\t\t\t\t\t\t\t\t\t\ttarget = target[maybeIndex[1]].getIndex($type.toNumber(maybeIndex[2]));\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\ttarget = target[maybeIndex[1]][$type.toNumber(maybeIndex[2])];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\ttarget = target[parts[x]];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\trule.target = target;\r\n\r\n\t\t\t\t// Resolve colors and percents\r\n\t\t\t\tif ($type.hasValue(rule.min)) {\r\n\t\t\t\t\trule.min = this.maybeColorOrPercent(rule.min);\r\n\t\t\t\t}\r\n\t\t\t\tif ($type.hasValue(rule.max)) {\r\n\t\t\t\t\trule.max = this.maybeColorOrPercent(rule.max);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tsuper.processConfig({\r\n\t\t\t\theatRules: heatRules\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns visibility value\r\n\t * @ignore\r\n\t */\r\n\t/*\r\n\t\tprotected getVisibility(): boolean {\r\n\t\t\tlet hidden = this.getPropertyValue(\"hidden\");\r\n\t\t\tif (hidden) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn super.getVisibility();\r\n\t\t\t}\r\n\t\t}*/\r\n\r\n\t/**\r\n\t * This function is used to sort element's JSON config properties, so that\r\n\t * some properties that absolutely need to be processed last, can be put at\r\n\t * the end.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param a  Element 1\r\n\t * @param b  Element 2\r\n\t * @return Sorting number\r\n\t */\r\n\tprotected configOrder(a: string, b: string): Ordering {\r\n\t\tif (a == b) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\t// Must come last\r\n\t\telse if (a == \"heatRules\") {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\telse if (b == \"heatRules\") {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn super.configOrder(a, b);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets `visibility` property:\r\n\t *\r\n\t * * `true` - visible\r\n\t * * `false` - hidden\r\n\t *\r\n\t * @param value  true - visible, false - hidden\r\n\t * @return Current visibility\r\n\t */\r\n\tpublic setVisibility(value: boolean) {\r\n\t\tsuper.setVisibility(value);\r\n\t\tthis.bulletsContainer.visible = value;\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Series\"] = Series;\r\nregistry.registeredClasses[\"SeriesDataItem\"] = SeriesDataItem;\r\n"]},"metadata":{},"sourceType":"module"}